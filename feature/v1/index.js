import*as e from'https://testingcf.jsdelivr.net/npm/pinia/+esm';var t={348:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var o=a(9433),n=a.n(o),r=a(5378),l=a.n(r)()(n());l.push([e.id,'.config-container[data-v-3cf7ae52]{margin-top:15px;padding:12px;background:#f8f9fa;border-radius:6px}.collapsible-section[data-v-3cf7ae52]{margin-bottom:15px;border:1px solid #e5e7eb;border-radius:6px;overflow:hidden}.section-header[data-v-3cf7ae52]{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:#fff;cursor:pointer;-webkit-user-select:none;user-select:none;font-weight:500;color:#111827;font-size:14px}.header-actions[data-v-3cf7ae52]{display:flex;align-items:center;gap:8px}.refresh-btn[data-v-3cf7ae52]{background:#f3f4f6;border:1px solid #e5e7eb;border-radius:4px;padding:2px 6px;cursor:pointer;display:flex;align-items:center}.refresh-btn[data-v-3cf7ae52]:hover{background:#e5e7eb}.refresh-icon[data-v-3cf7ae52]{font-size:14px}.subsection-header[data-v-3cf7ae52]{display:flex;justify-content:space-between;align-items:center;padding:8px 0;cursor:pointer;-webkit-user-select:none;user-select:none;font-weight:500;color:#4b5563}.toggle-icon[data-v-3cf7ae52]{font-size:18px;font-weight:bold}.section-content[data-v-3cf7ae52]{padding:12px;background:#f9fafb}.config-section[data-v-3cf7ae52]{margin-bottom:15px}.config-section[data-v-3cf7ae52]:last-child{margin-bottom:0}.config-section h5[data-v-3cf7ae52]{margin:0 0 8px 0;font-size:13px;color:#4b5563}.entry-list .entry-item[data-v-3cf7ae52]{display:flex;gap:6px;margin-bottom:6px}.entry-list .entry-item[data-v-3cf7ae52]:last-child{margin-bottom:10px}.entry-list .entry-select[data-v-3cf7ae52],.entry-list .regex-input[data-v-3cf7ae52]{flex:1;padding:4px 8px;border:1px solid #e5e7eb;border-radius:4px;font-size:12px;background:#fff}.entry-list .entry-select.light-theme[data-v-3cf7ae52],.entry-list .regex-input.light-theme[data-v-3cf7ae52]{background:#fff !important;color:#000 !important}.entry-list .regex-input[data-v-3cf7ae52]{font-weight:600}.entry-list .btn[data-v-3cf7ae52]{padding:4px 8px;border:none;border-radius:4px;cursor:pointer;font-size:12px;transition:background .2s}.entry-list .btn.add-btn[data-v-3cf7ae52]{background:#6366f1;color:#fff}.entry-list .btn.add-btn[data-v-3cf7ae52]:hover{background:#4f46e5}.entry-list .btn.remove-btn[data-v-3cf7ae52]{background:#ef4444;color:#fff;width:24px;padding:0}.entry-list .btn.remove-btn[data-v-3cf7ae52]:hover{background:#dc2626}.actions[data-v-3cf7ae52]{display:flex;justify-content:flex-end;gap:6px;margin-top:15px}.actions .btn[data-v-3cf7ae52]{padding:4px 10px;border:none;border-radius:4px;font-size:11px;cursor:pointer;transition:all .2s;background:#f3f4f6;color:#111827;box-shadow:0 1px 2px 0 rgba(0,0,0,.05);font-weight:500;display:inline-flex;align-items:center;gap:3px}.actions .btn.primary[data-v-3cf7ae52]{background:#4f46e5;color:#fff;font-weight:500}.actions .btn.primary[data-v-3cf7ae52]:hover:not(:disabled){background:#4338ca;color:#fff}.actions .btn.danger[data-v-3cf7ae52]{background:#ef4444;color:#fff}.actions .btn.danger[data-v-3cf7ae52]:hover:not(:disabled){background:#dc2626}.actions .btn[data-v-3cf7ae52]:hover:not(.disabled){background:#e5e7eb;color:#000}.actions .btn.disabled[data-v-3cf7ae52]{opacity:.6;cursor:not-allowed}','']);const i=l},487:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var o=a(9433),n=a.n(o),r=a(5378),l=a.n(r)()(n());l.push([e.id,'.mask[data-v-7fa11198]{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:9999;height:100vh;overflow-y:auto;animation:fadeIn-7fa11198 .2s ease}.card[data-v-7fa11198]{position:relative;background:linear-gradient(135deg,#dcd8d8 0%,#f8fafc 100%);border-radius:20px;width:90%;max-width:680px;box-shadow:0 20px 60px rgba(0,0,0,.15),0 0 0 1px hsla(0,0%,100%,.1);animation:slideUp-7fa11198 .3s cubic-bezier(0.16,1,0.3,1);z-index:10000;min-height:750px;display:flex;flex-direction:column;max-height:90vh;overflow:hidden}.top-button-group[data-v-7fa11198]{position:absolute;top:0;left:0;right:0;display:flex;background:linear-gradient(135deg,#f1f5f9 0%,#e2e8f0 100%);border-radius:20px 20px 0 0;padding:10px 16px;gap:8px;border-bottom:1px solid rgba(203,213,225,.5);z-index:1;height:56px}.router-view-container[data-v-7fa11198]{flex:1;display:flex;flex-direction:column;margin-top:56px;padding:24px;overflow:hidden;background:hsla(0,0%,100%,.7);border-radius:0 0 20px 20px;border-top:1px solid hsla(0,0%,100%,.3)}.content[data-v-7fa11198]{flex:1;overflow-y:auto;padding:4px;background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.05),inset 0 1px 0 hsla(0,0%,100%,.8)}.content[data-v-7fa11198]>*{padding:0 8px}.content[data-v-7fa11198]::-webkit-scrollbar{width:6px}.content[data-v-7fa11198]::-webkit-scrollbar-track{background:#f1f5f9;border-radius:3px;margin:4px 0}.content[data-v-7fa11198]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}.content[data-v-7fa11198]::-webkit-scrollbar-thumb:hover{background:#94a3b8}.btn[data-v-7fa11198]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:8px 10px;border:none;border-radius:10px;background:linear-gradient(135deg,#dcd8d8 0%,#f8fafc 100%);color:#64748b;font-size:12px;cursor:pointer;transition:all .3s cubic-bezier(0.4,0,0.2,1);box-shadow:0 1px 4px rgba(0,0,0,.05),inset 0 1px 0 hsla(0,0%,100%,.8);min-height:48px}.btn[data-v-7fa11198]:hover{transform:translateY(-1px);box-shadow:0 2px 8px rgba(0,0,0,.08),inset 0 1px 0 hsla(0,0%,100%,.9);color:#475569}.btn.active[data-v-7fa11198]{background:linear-gradient(135deg,#6366f1 0%,#4f46e5 100%);color:#fff;box-shadow:0 2px 8px rgba(99,102,241,.3),inset 0 1px 0 hsla(0,0%,100%,.2)}.btn.active .btn-icon[data-v-7fa11198]{opacity:1;transform:scale(1.1)}.btn.active .btn-text[data-v-7fa11198]{font-weight:600}.btn-text[data-v-7fa11198]{font-size:11px;line-height:1.2;font-weight:500;transition:all .3s ease;margin-top:2px}.close-x[data-v-7fa11198]{position:absolute;top:62px;right:16px;width:28px;height:28px;border:none;background:#f8fafc;border-radius:50%;font-size:18px;line-height:1;color:#64748b;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 6px rgba(0,0,0,.1);z-index:2}.close-x[data-v-7fa11198]:hover{background:#ef4444;color:#fff;transform:rotate(90deg);box-shadow:0 3px 10px rgba(239,68,68,.3)}@keyframes fadeIn-7fa11198{from{opacity:0}to{opacity:1}}@keyframes slideUp-7fa11198{from{transform:translateY(30px) scale(0.95);opacity:0}to{transform:translateY(0) scale(1);opacity:1}}@media (max-width:480px){.card[data-v-7fa11198]{max-width:95%;min-height:360px}.router-view-container[data-v-7fa11198]{margin-top:52px;padding:16px}.top-button-group[data-v-7fa11198]{padding:8px 12px;gap:6px;height:52px}.btn[data-v-7fa11198]{padding:6px 8px;min-height:44px;font-size:11px}.btn-text[data-v-7fa11198]{font-size:12px}.close-x[data-v-7fa11198]{top:58px;right:12px;width:26px;height:26px;font-size:16px}.content[data-v-7fa11198]{border-radius:10px}}','']);const i=l},688:(e,t,a)=>{a.d(t,{n:()=>r});var o=a(3035),n=a(4061);const r=(0,o.defineStore)('KatUI',()=>({showUI:(0,n.ref)(!1),collectedPaths:(0,n.ref)([])}))},898:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var o=a(9433),n=a.n(o),r=a(5378),l=a.n(r)()(n());l.push([e.id,'.json-tree[data-v-98a82dee]{font-family:monospace;font-size:11px;overflow-x:auto;white-space:nowrap}\n','']);const i=l},1096:(e,t,a)=>{var o=a(348);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('495295dd',o,!1,{ssrId:!0})},1400:(e,t)=>{t.A=(e,t)=>{const a=e.__vccOpts||e;for(const[e,o]of t)a[e]=o;return a}},1581:(e,t,a)=>{var o=a(898);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('b09dea08',o,!1,{ssrId:!0})},1684:(e,t,a)=>{a.d(t,{default:()=>da}),a.r(t);var o=a(4061),n=a(6584),r=a(688);const l={class:'json-node'},i={key:0,class:'arrow-icon',viewBox:'0 0 16 16',fill:'currentColor'},s={key:1,class:'arrow-icon',viewBox:'0 0 16 16',fill:'currentColor'},d={key:1,class:'space'},c={class:'key'},p={key:2,class:'value-area'},u={key:3,class:'collapse-preview'},f={class:'ellipsis'},b=(0,o.defineComponent)({__name:'JsonNode',props:{node:{}},emits:['toggle','sendPath'],setup(e){function t(e){switch(typeof e){case'string':return`"${e}"`;case'number':case'boolean':return`${e}`;case'object':return null===e?'null':Array.isArray(e)?`[${e.length} items]`:`{${Object.keys(e).length} keys}`;default:return String(e)}}function a(e){switch(typeof e){case'string':return'type-string';case'number':return'type-number';case'boolean':return'type-boolean';case'object':return null===e?'type-null':Array.isArray(e)?'type-array':'type-object';default:return'type-other'}}function n(e){if(e.children){const t=e.children.length;return`{ ${e.children.slice(0,2).map(e=>e.key).join(', ')}${t>2?', ... +'+(t-2):''} }`}return'{ ... }'}return(r,b)=>{const m=(0,o.resolveComponent)('JsonNode',!0);return(0,o.openBlock)(),(0,o.createElementBlock)('div',l,[(0,o.createElementVNode)('div',{class:(0,o.normalizeClass)(['line',{'line-leaf':e.node.isLeaf,'line-parent':!e.node.isLeaf}]),style:(0,o.normalizeStyle)({paddingLeft:20*e.node.depth+'px'})},[(0,o.createCommentVNode)(' 折叠箭头 / 占位 '),e.node.isLeaf?((0,o.openBlock)(),(0,o.createElementBlock)('span',d)):((0,o.openBlock)(),(0,o.createElementBlock)('span',{key:0,class:(0,o.normalizeClass)(['arrow',{expanded:e.node.expanded}]),onClick:b[0]||(b[0]=t=>r.$emit('toggle',e.node))},[e.node.expanded?((0,o.openBlock)(),(0,o.createElementBlock)('svg',i,[...b[4]||(b[4]=[(0,o.createElementVNode)('path',{d:'M12 10L8 6L4 10H12Z'},null,-1)])])):((0,o.openBlock)(),(0,o.createElementBlock)('svg',s,[...b[5]||(b[5]=[(0,o.createElementVNode)('path',{d:'M6 4L10 8L6 12V4Z'},null,-1)])]))],2)),(0,o.createCommentVNode)(' 键值 '),(0,o.createElementVNode)('span',c,(0,o.toDisplayString)(e.node.key)+':',1),(0,o.createCommentVNode)(' 值显示区域 '),e.node.isLeaf?((0,o.openBlock)(),(0,o.createElementBlock)('div',p,[(0,o.createElementVNode)('span',{class:(0,o.normalizeClass)(['val',a(e.node.value)])},(0,o.toDisplayString)(t(e.node.value)),3),(0,o.createCommentVNode)(' 只有叶子节点出现添加规则按钮 '),(0,o.createElementVNode)('button',{class:'add-btn',title:'将此路径添加到规则',onClick:b[1]||(b[1]=t=>r.$emit('sendPath',e.node.path))},'+')])):e.node.expanded?(0,o.createCommentVNode)('v-if',!0):((0,o.openBlock)(),(0,o.createElementBlock)('div',u,[(0,o.createElementVNode)('span',f,(0,o.toDisplayString)(n(e.node)),1)]))],6),(0,o.createCommentVNode)(' 子节点 '),e.node.children&&e.node.expanded?((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,{key:0},(0,o.renderList)(e.node.children,e=>((0,o.openBlock)(),(0,o.createBlock)(m,{key:e.path,node:e,onToggle:b[2]||(b[2]=e=>r.$emit('toggle',e)),onSendPath:b[3]||(b[3]=e=>r.$emit('sendPath',e))},null,8,['node']))),128)):(0,o.createCommentVNode)('v-if',!0)])}}});a(3786);var m=a(1400);const v=(0,m.A)(b,[['__scopeId','data-v-2a743db4']]),h={class:'json-tree'},g=(0,o.defineComponent)({__name:'JsonTree',props:{data:{}},emits:['toggle','sendPath'],setup(e,{emit:t}){const a=e,n=t;function r(e,t=0,a='',o=!1){return null===e||'object'!=typeof e?[]:Object.keys(e).map(n=>{const l=a?`${a}.${n}`:n,i=e[n],s=null===i||'object'!=typeof i,d={key:n,value:i,depth:t,path:l,isLeaf:s,expanded:o};return s||(d.children=r(i,t+1,l,o)),d})}const l=(0,o.ref)([]);function i(e){e.expanded=!e.expanded,n('toggle',e)}return(0,o.watch)(()=>a.data,e=>l.value=r(e),{immediate:!0}),(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',h,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(l.value,(a,n)=>((0,o.openBlock)(),(0,o.createBlock)(v,{key:n,node:a,onToggle:i,onSendPath:t[0]||(t[0]=t=>e.$emit('sendPath',t))},null,8,['node']))),128))]))}});a(1581);const x=(0,m.A)(g,[['__scopeId','data-v-98a82dee']]);var y=a(9761);function k(e,t=!0){try{const a={rules:e};return t?JSON.stringify(a,null,2):JSON.stringify(a)}catch(e){throw y.j.error('导出规则失败:',e),new Error('导出规则失败')}}var w=a(6340),E=a(2393),N=a(5632),V=a.n(N);const C={class:'dsl-builder-content'},S={class:'dsl-header'},B={class:'dsl-builder-body'},j={class:'dsl-components'},A={class:'component-section'},D={class:'path-selection-row'},O={key:0,class:'path-dropdown-container'},T=['value'],M={key:0,class:'selected-path'},L={key:0,class:'component-section'},I={class:'operator-grid'},R={class:'component-section'},U={class:'operator-grid'},J={class:'operator-grid three-columns'},P={class:'component-section'},F={class:'operator-grid'},H={class:'component-section'},W={class:'value-input'},K={class:'component-section'},G={class:'value-input'},Y={class:'dsl-preview-area'},q={class:'expression-preview readable'},X={class:'expression-display readable-text'},Z={class:'expression-preview'},Q={class:'expression-raw'},ee={class:'expression-editor'},te=(0,o.defineComponent)({__name:'DSLBuilderModal',props:{visible:{type:Boolean},type:{},expression:{},selectedPath:{default:''}},emits:['update:visible','update:expression','close','apply'],setup(e,{emit:t}){const a=e,n=(0,o.ref)(a.expression),l=(0,o.ref)(''),i=(0,o.ref)('num'),s=(0,o.ref)(''),d=(0,o.ref)(null),c=(0,o.ref)(null),p=(0,o.ref)(!1),u=(0,o.ref)(''),f=(0,o.ref)('s'),b=t,m=(0,r.n)();(0,o.watch)(()=>a.expression,e=>{n.value=e}),(0,o.watch)(n,e=>{b('update:expression',e)});const v=(0,o.computed)(()=>'if'===a.type?'条件表达式构建器':'操作表达式构建器'),h=(0,o.computed)(()=>{if(n.value.trim()){const e='if'===a.type?'<<if>':'<<op>',t=n.value.trim();return t.startsWith('<<if>')||t.startsWith('<<op>')?t:`${e} ${t} >`}return n.value}),g=(0,o.computed)(()=>E.w.exprToHumanView(h.value));function x(){b('update:visible',!1),b('close'),l.value='',s.value=''}function k(){n.value.trim()&&(b('apply',h.value),x())}function w(e){p.value=!0;const t=n.value;let a=t.length,r=t.length;c.value&&(a=c.value.start,r=c.value.end);const l=t.substring(0,a),i=t.substring(r),s=l&&!l.endsWith(' ')?' ':'',u=i&&!i.startsWith(' ')?' ':'';n.value=l+s+e+u+i;const f=a+s.length+e.length+u.length;c.value={start:f,end:f},(0,o.nextTick)(()=>{const e=d.value;if(e)try{e.focus(),e.setSelectionRange(f,f)}catch(e){y.j.warn('Cursor restore failed',e)}setTimeout(()=>{p.value=!1},0)})}function N(){s.value&&(w(`$[${s.value}]`),s.value='')}function te(){w('()')}function ae(){if(!l.value.trim())return;let e='';switch(i.value){case'num':e=`&[{num}${l.value}]`;break;case'str':e=`&[{str}${l.value}]`;break;case'bool':e=`&[{bool}${l.value}]`}w(e),l.value=''}function oe(){const e=u.value.trim();if(!e)return;if(!/^\w+$/.test(e))return void V().error('变量名只能包含字母、数字和下划线');w(`@[{${f.value}}${e}]`),u.value=''}function ne(){n.value='',b('update:expression','')}function re(){if(n.value.trim())try{const e=E.w.validate(n.value);e.success?V().success(('if'===a.type?'条件':'操作')+'表达式语法验证通过'):V().error(`${'if'===a.type?'条件':'操作'}表达式语法验证失败: ${e.error}`)}catch(e){V().error(`表达式验证出错: ${e.message}`)}else V().error('表达式为空')}const le=()=>{if(p.value)return;const e=d.value;if(e){const t=e.selectionStart,a=e.selectionEnd;c.value={start:t,end:a}}};return(0,o.watch)(()=>a.visible,e=>{e||(l.value='',s.value='',c.value=null,u.value='')}),(t,a)=>e.visible?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:0,class:'dsl-builder-modal',onClick:(0,o.withModifiers)(x,['self'])},[(0,o.createElementVNode)('div',C,[(0,o.createElementVNode)('div',S,[(0,o.createElementVNode)('h3',null,(0,o.toDisplayString)(v.value),1),(0,o.createElementVNode)('button',{class:'btn small',onClick:x},'×')]),(0,o.createElementVNode)('div',B,[(0,o.createCommentVNode)(' 左侧：构建组件 '),(0,o.createElementVNode)('div',j,[(0,o.createElementVNode)('div',A,[a[33]||(a[33]=(0,o.createElementVNode)('h4',null,'路径选择',-1)),(0,o.createElementVNode)('div',D,[(0,o.createElementVNode)('button',{class:'btn small',onClick:a[0]||(a[0]=t=>w(`$[${e.selectedPath}]`))},'当前路径'),(0,o.unref)(m).collectedPaths.length>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',O,[(0,o.withDirectives)((0,o.createElementVNode)('select',{'onUpdate:modelValue':a[1]||(a[1]=e=>s.value=e),class:'path-dropdown light-theme',onChange:N},[a[32]||(a[32]=(0,o.createElementVNode)('option',{value:''},'选择已收集路径',-1)),((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)((0,o.unref)(m).collectedPaths,(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('option',{key:t,value:e},(0,o.toDisplayString)(e),9,T))),128))],544),[[o.vModelSelect,s.value]])])):(0,o.createCommentVNode)('v-if',!0)]),e.selectedPath?((0,o.openBlock)(),(0,o.createElementBlock)('div',M,' 已选择: '+(0,o.toDisplayString)(e.selectedPath),1)):(0,o.createCommentVNode)('v-if',!0)]),'if'===e.type?((0,o.openBlock)(),(0,o.createElementBlock)('div',L,[a[34]||(a[34]=(0,o.createElementVNode)('h4',null,'比较运算符',-1)),(0,o.createElementVNode)('div',I,[(0,o.createElementVNode)('button',{class:'btn small',onClick:a[2]||(a[2]=e=>w('?[==]'))},'等于 (==)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[3]||(a[3]=e=>w('?[>]'))},'大于 (>)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[4]||(a[4]=e=>w('?[<]'))},'小于 (<)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[5]||(a[5]=e=>w('?[>=]'))},'大于等于 (>=)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[6]||(a[6]=e=>w('?[<=]'))},'小于等于 (≥)')])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createElementVNode)('div',R,[a[35]||(a[35]=(0,o.createElementVNode)('h4',null,'算术运算符',-1)),(0,o.createElementVNode)('div',U,[(0,o.createElementVNode)('button',{class:'btn small',onClick:a[7]||(a[7]=e=>w('#[+]'))},'加 (+)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[8]||(a[8]=e=>w('#[-]'))},'减 (-)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[9]||(a[9]=e=>w('#[*]'))},'乘 (*)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[10]||(a[10]=e=>w('#[/]'))},'除 (/)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[11]||(a[11]=e=>w('#[%]'))},'取余 (%)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[12]||(a[12]=e=>w('#[**]'))},'幂 (**)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[13]||(a[13]=e=>w('#[=]'))},'赋值 (=)')]),a[36]||(a[36]=(0,o.createElementVNode)('h4',null,'函数运算符',-1)),(0,o.createCommentVNode)(' 修改：使用 three-columns 类 '),(0,o.createElementVNode)('div',J,[(0,o.createElementVNode)('button',{class:'btn small',onClick:a[14]||(a[14]=e=>w('#[{ln}]'))},'自然对数 (ln)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[15]||(a[15]=e=>w('#[{log2}]'))},'对数 (log2)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[16]||(a[16]=e=>w('#[{sqrt}]'))},'平方根 (sqrt)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[17]||(a[17]=e=>w('#[{abs}]'))},'绝对值 (abs)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[18]||(a[18]=e=>w('#[{floor}]'))},'向下取整 (floor)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[19]||(a[19]=e=>w('#[{ceil}]'))},'向上取整 (ceil)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[20]||(a[20]=e=>w('#[{max}]'))},'最大值 (max)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[21]||(a[21]=e=>w('#[{min}]'))},'最小值 (min)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[22]||(a[22]=e=>w('#[{neg}]'))},'取反 (neg)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[23]||(a[23]=e=>w('#[{avg}]'))},'平均值 (avg)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[24]||(a[24]=e=>w('#[{sum}]'))},'求和 (sum)')])]),(0,o.createElementVNode)('div',P,[a[37]||(a[37]=(0,o.createElementVNode)('h4',null,'逻辑运算符',-1)),(0,o.createElementVNode)('div',F,[(0,o.createElementVNode)('button',{class:'btn small',onClick:a[25]||(a[25]=e=>w('?[&&]'))},'与 (&&)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:a[26]||(a[26]=e=>w('?[||]'))},'或 (||)'),(0,o.createElementVNode)('button',{class:'btn small',onClick:te},'添加括号 ()')])]),(0,o.createElementVNode)('div',H,[a[39]||(a[39]=(0,o.createElementVNode)('h4',null,'值',-1)),(0,o.createElementVNode)('div',W,[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':a[27]||(a[27]=e=>l.value=e),placeholder:'输入值',class:'light-theme',onKeyup:(0,o.withKeys)(ae,['enter'])},null,544),[[o.vModelText,l.value]]),(0,o.withDirectives)((0,o.createElementVNode)('select',{'onUpdate:modelValue':a[28]||(a[28]=e=>i.value=e),class:'light-theme'},[...a[38]||(a[38]=[(0,o.createElementVNode)('option',{value:'num'},'数字',-1),(0,o.createElementVNode)('option',{value:'str'},'字符串',-1),(0,o.createElementVNode)('option',{value:'bool'},'布尔值',-1)])],512),[[o.vModelSelect,i.value]]),(0,o.createElementVNode)('button',{class:'btn small primary',onClick:ae},'添加值')])]),(0,o.createCommentVNode)(' 新增：临时变量 '),(0,o.createElementVNode)('div',K,[a[41]||(a[41]=(0,o.createElementVNode)('h4',null,'临时变量',-1)),(0,o.createElementVNode)('div',G,[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':a[29]||(a[29]=e=>u.value=e),placeholder:'变量名',class:'light-theme',onKeyup:(0,o.withKeys)(oe,['enter'])},null,544),[[o.vModelText,u.value]]),(0,o.withDirectives)((0,o.createElementVNode)('select',{'onUpdate:modelValue':a[30]||(a[30]=e=>f.value=e),class:'light-theme'},[...a[40]||(a[40]=[(0,o.createElementVNode)('option',{value:'s'},'局部 (s)',-1),(0,o.createElementVNode)('option',{value:'g'},'全局 (g)',-1)])],512),[[o.vModelSelect,f.value]]),(0,o.createElementVNode)('button',{class:'btn small primary',onClick:oe},'添加变量')])])]),(0,o.createCommentVNode)(' 右侧：表达式预览和编辑 '),(0,o.createElementVNode)('div',Y,[(0,o.createCommentVNode)(' 新增：可读预览 '),(0,o.createElementVNode)('div',q,[a[42]||(a[42]=(0,o.createElementVNode)('div',{class:'preview-header'},[(0,o.createElementVNode)('strong',null,'可读预览:'),(0,o.createElementVNode)('span',{class:'hint'},'（仅供参考，实际逻辑以原始表达式为准）')],-1)),(0,o.createElementVNode)('div',X,(0,o.toDisplayString)(g.value||'暂无内容'),1)]),(0,o.createElementVNode)('div',Z,[a[43]||(a[43]=(0,o.createElementVNode)('div',{class:'preview-header'},[(0,o.createElementVNode)('strong',null,'原始表达式:')],-1)),(0,o.createElementVNode)('div',Q,[(0,o.createElementVNode)('pre',null,(0,o.toDisplayString)(h.value),1)])]),(0,o.createElementVNode)('div',ee,[a[44]||(a[44]=(0,o.createElementVNode)('h4',null,'手动编辑',-1)),(0,o.withDirectives)((0,o.createElementVNode)('textarea',{ref_key:'expressionTextarea',ref:d,'onUpdate:modelValue':a[31]||(a[31]=e=>n.value=e),rows:'4',placeholder:'可以在此处手动编辑表达式...',class:'light-theme',onKeyup:le,onInput:le,onClick:le},null,544),[[o.vModelText,n.value]]),(0,o.createElementVNode)('div',{class:'editor-actions'},[(0,o.createElementVNode)('button',{class:'btn small danger',onClick:ne},'清空'),(0,o.createElementVNode)('button',{class:'btn small',onClick:re},'验证')])]),(0,o.createElementVNode)('div',{class:'dsl-actions'},[(0,o.createElementVNode)('button',{class:'btn primary',onClick:k},'应用表达式'),(0,o.createElementVNode)('button',{class:'btn',onClick:x},'取消')])])])])])):(0,o.createCommentVNode)('v-if',!0)}});a(5810);const ae=(0,m.A)(te,[['__scopeId','data-v-7bb5e448']]);var oe=a(4544);const ne={class:'path-collection-box'},re={class:'toggle-icon'},le={class:'path-collection-content'},ie=['title'],se=['onClick'],de=(0,o.defineComponent)({__name:'PathCollection',props:{isExpanded:{type:Boolean,default:!1}},emits:['update:isExpanded'],setup(e,{emit:t}){const a=e,n=t,l=(0,r.n)(),i=()=>{n('update:isExpanded',!a.isExpanded)},s=()=>{l.collectedPaths=[]};return(t,a)=>(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createElementBlock)('div',ne,[(0,o.createElementVNode)('div',{class:'path-collection-header',onClick:i},[(0,o.createElementVNode)('span',null,'已收集路径 ('+(0,o.toDisplayString)((0,o.unref)(l).collectedPaths.length)+')',1),(0,o.createElementVNode)('span',re,(0,o.toDisplayString)(e.isExpanded?'▲':'▼'),1)]),(0,o.withDirectives)((0,o.createElementVNode)('div',le,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)((0,o.unref)(l).collectedPaths,(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:t,class:'path-item'},[(0,o.createElementVNode)('span',{class:'path-text',title:e},(0,o.toDisplayString)(e),9,ie),(0,o.createElementVNode)('button',{class:'btn small danger remove-path-btn',onClick:e=>(e=>{l.collectedPaths.splice(e,1)})(t)},'×',8,se)]))),128)),(0,o.createElementVNode)('div',{class:'path-collection-actions'},[(0,o.createElementVNode)('button',{class:'btn small',onClick:s},'清空所有')])],512),[[o.vShow,e.isExpanded]])],512)),[[o.vShow,(0,o.unref)(l).collectedPaths.length>0]])}});a(9867);const ce=(0,m.A)(de,[['__scopeId','data-v-57295b1b']]);var pe=a(7021),ue=a(7664);const fe={key:0,class:'dsl-tester-modal'},be={class:'dsl-tester-content'},me={class:'tester-header'},ve={class:'header-left'},he={key:0,class:'data-badge',title:'当前使用的是导入的外部数据'},ge={class:'header-actions'},xe=['disabled'],ye={class:'tester-body'},ke={class:'panel-left'},we={class:'panel-header'},Ee={key:0,class:'count-badge'},Ne={class:'rules-container'},Ve={key:0,class:'rules-list'},Ce={class:'rule-header'},Se=['title'],Be={class:'rule-detail'},je=['title'],_e={key:1,class:'empty-state'},Ae={class:'panel-right'},ze={class:'panel-header'},De={class:'output-container'},Oe={key:0,class:'console-output'},$e={key:1,class:'empty-result'},Te=(0,o.defineComponent)({__name:'DSLTesterModal',props:{visible:{type:Boolean,default:!1},eraDataRule:{default:()=>({})},resultText:{default:''},statData:{default:()=>({})}},emits:['update:visible','close'],setup(e,{emit:t}){const a=(0,ue.l)(),n=e,r=t,l=(0,o.ref)(n.resultText),i=(0,o.ref)(n.eraDataRule),s=(0,o.ref)(n.statData),d=(0,o.ref)(!1),c=(0,o.ref)(null),p=(0,o.computed)(()=>i.value&&Object.keys(i.value).length>0),u=(0,o.computed)(()=>'EraDataRule 测试器');function f(e,t){try{s.value=JSON.parse(e),d.value=!0,'undefined'!=typeof toastr&&toastr.success(`成功导入: ${t.name}`,''),l.value=`// 数据已导入 (${t.name})\n// 请点击“运行测试”查看结果...`}catch(e){const t=`JSON解析失败: ${e}`;'undefined'!=typeof toastr&&toastr.error(t,'')}}function b(e){'undefined'!=typeof toastr?toastr.error(`导入失败: ${e}`,''):console.error(`导入失败: ${e}`)}function m(){d.value=!1,s.value=n.statData?JSON.parse(JSON.stringify(n.statData)):{},r('update:visible',!1),r('close')}async function v(){if(p.value){y.j.log('开始运行 DSL 测试...'),l.value='正在执行...';try{const e=await a.getStatData(),t=JSON.parse(JSON.stringify(s.value)),o=JSON.parse(JSON.stringify(e)),n=await pe.$.applyRule(t,o,i.value);let r=`=== 执行日志 ===\n${n.log}\n\n`;const d=n.data;Object.keys(d).length>0?r+=`=== 数据变更 ===\n${JSON.stringify(d,null,2)}`:r+='=== 数据变更 ===\n(无数据变化)',l.value=r}catch(e){console.error(e),l.value=`>> 执行异常:\n${e.message||e}`}}else l.value='>> 错误: 没有可测试的规则数据'}return(0,o.watch)(()=>n.resultText,e=>{l.value=e}),(0,o.watch)(()=>n.eraDataRule,e=>{i.value=e?{...e}:{}},{deep:!0}),(0,o.watch)(()=>n.statData,e=>{d.value||(s.value=e?JSON.parse(JSON.stringify(e)):{})},{deep:!0,immediate:!0}),(t,a)=>e.visible?((0,o.openBlock)(),(0,o.createElementBlock)('div',fe,[(0,o.createElementVNode)('div',be,[(0,o.createCommentVNode)(' 1. 顶部工具栏 (Header + Actions) '),(0,o.createElementVNode)('div',me,[(0,o.createElementVNode)('div',ve,[(0,o.createElementVNode)('h3',null,(0,o.toDisplayString)(u.value),1),(0,o.createCommentVNode)(' 状态徽标 '),d.value?((0,o.openBlock)(),(0,o.createElementBlock)('span',he,' 外部数据模式 ')):(0,o.createCommentVNode)('v-if',!0)]),(0,o.createElementVNode)('div',ge,[(0,o.createCommentVNode)(' 导入组件 '),(0,o.createVNode)(oe.A,{ref_key:'fileImportRef',ref:c,'import-text':'导入数据','require-confirm':!1,class:'action-item',onFileLoaded:f,onError:b},null,512),(0,o.createCommentVNode)(' 运行按钮 '),(0,o.createElementVNode)('button',{class:'btn primary',disabled:!p.value,title:'运行 DSL 测试',onClick:v},[...a[1]||(a[1]=[(0,o.createElementVNode)('svg',{width:'14',height:'14',viewBox:'0 0 24 24',fill:'currentColor'},[(0,o.createElementVNode)('path',{d:'M8 5v14l11-7z'})],-1),(0,o.createTextVNode)(' 运行测试 ',-1)])],8,xe),a[3]||(a[3]=(0,o.createElementVNode)('div',{class:'divider'},null,-1)),(0,o.createCommentVNode)(' 关闭按钮 (图标形式) '),(0,o.createElementVNode)('button',{class:'close-btn',title:'关闭',onClick:m},[...a[2]||(a[2]=[(0,o.createElementVNode)('svg',{width:'20',height:'20',viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2'},[(0,o.createElementVNode)('line',{x1:'18',y1:'6',x2:'6',y2:'18'}),(0,o.createElementVNode)('line',{x1:'6',y1:'6',x2:'18',y2:'18'})],-1)])])])]),(0,o.createCommentVNode)(' 2. 主体内容区域 (左右分栏) '),(0,o.createElementVNode)('div',ye,[(0,o.createCommentVNode)(' 左侧：规则列表 '),(0,o.createElementVNode)('div',ke,[(0,o.createElementVNode)('div',we,[a[4]||(a[4]=(0,o.createElementVNode)('span',null,'规则列表',-1)),p.value?((0,o.openBlock)(),(0,o.createElementBlock)('span',Ee,(0,o.toDisplayString)(Object.keys(i.value).length),1)):(0,o.createCommentVNode)('v-if',!0)]),(0,o.createElementVNode)('div',Ne,[p.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',Ve,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(i.value,(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:t,class:'rule-card'},[(0,o.createElementVNode)('div',Ce,[(0,o.createElementVNode)('span',{class:'rule-name',title:String(t)},(0,o.toDisplayString)(t),9,Se),(0,o.createElementVNode)('span',{class:(0,o.normalizeClass)(['status-dot',{active:e.enable}]),title:'启用状态'},null,2)]),(0,o.createElementVNode)('div',Be,[(0,o.createElementVNode)('code',{class:'path-code',title:e.path},(0,o.toDisplayString)(e.path),9,je)])]))),128))])):((0,o.openBlock)(),(0,o.createElementBlock)('div',_e,' 暂无规则数据 '))])]),(0,o.createCommentVNode)(' 右侧：输出结果 '),(0,o.createElementVNode)('div',Ae,[(0,o.createElementVNode)('div',ze,[a[5]||(a[5]=(0,o.createElementVNode)('span',null,'执行结果',-1)),l.value?((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:0,class:'clear-btn',onClick:a[0]||(a[0]=e=>l.value='')},'清空')):(0,o.createCommentVNode)('v-if',!0)]),(0,o.createElementVNode)('div',De,[l.value?((0,o.openBlock)(),(0,o.createElementBlock)('pre',Oe,(0,o.toDisplayString)(l.value),1)):((0,o.openBlock)(),(0,o.createElementBlock)('div',$e,[...a[6]||(a[6]=[(0,o.createElementVNode)('div',{class:'icon-placeholder'},'⌨️',-1),(0,o.createElementVNode)('span',null,'准备就绪',-1),(0,o.createElementVNode)('small',null,'点击顶部 "运行测试" 查看结果（更详细的日志请查看控制台）',-1)])]))])])])])])):(0,o.createCommentVNode)('v-if',!0)}});a(7507);const Me=(0,m.A)(Te,[['__scopeId','data-v-db47b546']]),Le={class:'simulation-test'},Ie=(0,o.defineComponent)({__name:'SimulationTest',props:{rules:{type:Object,required:!0},statData:{type:Object,required:!0}},emits:['update-stat-data'],setup(e,{expose:t,emit:a}){const n=e,r=((0,o.ref)(),(0,o.ref)(''),(0,o.ref)(!1),(0,o.ref)(!1)),l=(0,o.ref)(''),i=(0,o.ref)({});(0,o.watch)(()=>n.rules,e=>{r.value||(i.value=e)},{deep:!0,immediate:!0});const s=()=>{i.value=n.rules,r.value=!0,l.value=''},d=()=>{r.value=!1};return t({openDslTesterWithRules:e=>{i.value=e,r.value=!0,l.value=''}}),(t,a)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',Le,[a[1]||(a[1]=(0,o.createElementVNode)('div',{class:'section-header'},[(0,o.createElementVNode)('h2',null,'测试模拟')],-1)),(0,o.createElementVNode)('div',{class:'test-controls'},[(0,o.createCommentVNode)('      <button class="btn" @click="openSimulationTestModal">打开模拟测试</button>'),(0,o.createElementVNode)('button',{class:'btn',onClick:s},'打开 Rule 测试器 (所有规则)')]),(0,o.createCommentVNode)('TODO 目前功能上与DSL类似而且有bug,暂时弃用'),(0,o.createCommentVNode)('    &lt;!&ndash; 模拟测试模态框 &ndash;&gt;'),(0,o.createCommentVNode)('    <SimulationTestModal'),(0,o.createCommentVNode)('      :visible="showSimulationModal"'),(0,o.createCommentVNode)('      :imported-data="statData"'),(0,o.createCommentVNode)('      :result-data="testResultData"'),(0,o.createCommentVNode)('      :execution-log="executionLog"'),(0,o.createCommentVNode)('      @update:visible="showSimulationModal = $event"'),(0,o.createCommentVNode)('      @close="closeSimulationModal"'),(0,o.createCommentVNode)('      @run-test="handleRunTest"'),(0,o.createCommentVNode)('    />'),(0,o.createCommentVNode)(' DSL 测试器模态框 '),(0,o.createVNode)(Me,{visible:r.value,'era-data-rule':i.value,'stat-data':e.statData,'result-text':l.value,'onUpdate:visible':a[0]||(a[0]=e=>r.value=e),onClose:d},null,8,['visible','era-data-rule','stat-data','result-text'])]))}});a(2008);const Re=(0,m.A)(Ie,[['__scopeId','data-v-48676150']]);var Ue=a(3840);const Je={class:'era-rule-panel'},Pe={class:'sticky-tabs'},Fe={class:'tabs-container'},He=['onClick'],We={class:'content-wrapper'},Ke={class:'json-tree-box'},Ge={class:'rule-list-controls'},Ye={class:'import-export-buttons'},qe={key:0,class:'empty-state'},Xe=['onClick'],Ze={class:'rule-name-container'},Qe={class:'rule-name'},et={class:'rule-status'},tt={class:'rule-actions'},at=['onClick'],ot={class:'fold-indicator'},nt={class:'rule-body'},rt={class:'rule-content'},lt={class:'rule-details'},it={key:0},st={key:1},dt={key:2},ct={key:3},pt={key:0,class:'handle-list'},ut={class:'handle-header'},ft={key:0,class:'handle-expression'},bt={class:'handle-expression'},mt={class:'rule-operations'},vt=['onClick'],ht=['onClick'],gt=['onClick'],xt={class:'field'},yt={class:'field'},kt={class:'toggle-switch'},wt={class:'field'},Et={class:'field'},Nt={class:'field'},Vt={class:'field'},Ct={class:'range-limit-inputs'},St={class:'input-group'},Bt={class:'input-group'},jt={class:'field'},_t={class:'range-limit-inputs'},At={class:'input-group'},zt={class:'input-group'},Dt={class:'handle-area'},Ot={class:'rule-if-config',style:{'margin-bottom':'15px',padding:'10px',background:'rgba(0,0,0,0.03)','border-radius':'4px',border:'1px dashed #ccc'}},$t={class:'dsl-builder'},Tt={class:'dsl-header'},Mt={class:'dsl-actions'},Lt={class:'dsl-preview'},It=['onClick'],Rt=['onUpdate:modelValue'],Ut={class:'handle-actions'},Jt={class:'fold-indicator'},Pt=['onClick'],Ft={class:'field'},Ht=['onUpdate:modelValue'],Wt={class:'field'},Kt=['onUpdate:modelValue'],Gt={class:'dsl-builder'},Yt={class:'dsl-header'},qt={class:'dsl-actions'},Xt=['onClick'],Zt=['onClick'],Qt={class:'dsl-preview'},ea=['onUpdate:modelValue','onClick'],ta={class:'dsl-builder'},aa={class:'dsl-header'},oa={class:'dsl-actions'},na=['onClick'],ra=['onClick'],la={class:'dsl-preview'},ia=['onUpdate:modelValue','onClick'],sa=(0,o.defineComponent)({__name:'EraDataHandle',setup(e){const t=(0,o.ref)({}),a=(0,o.ref)({}),l=(0,o.ref)({}),i=(0,o.ref)({}),s=(0,o.ref)(''),d=(0,o.ref)(!1),c=(0,o.ref)({enable:!0,path:'',if:'',order:0,loop:1,handle:{},range:[],limit:[]}),p=(0,o.ref)({}),u=(0,r.n)(),f=(0,o.ref)(!1),b=(0,o.ref)(null),m=(0,o.ref)(null),v=(0,o.ref)(null),h=(0,o.ref)(null),g=(0,o.ref)('data'),N=(0,o.ref)(!1),V=(0,o.ref)(''),C=(0,o.ref)(!1),S=(0,o.ref)(!1),B=(0,o.ref)(null),j=(0,o.ref)(!1),A=(0,o.ref)('if'),D=(0,o.ref)(''),O=(0,o.ref)(''),T=(0,o.ref)(null),M=[{key:'data',label:'查看数据'},{key:'list',label:'查看规则'},{key:'rule',label:'编辑规则'},{key:'test',label:'测试模拟'}],L=(0,n.D)();function I(){if(!s.value)return void re('请输入规则名称','error');if((!d.value||d.value&&s.value!==V.value)&&a.value[s.value])return void(C.value=!0);const e=Object.values(p.value);if(e.length>0){if(new Set(e).size!==e.length)return void(S.value=!0)}U()}function R(){null!==b.value&&null!==m.value?c.value.range=[b.value,m.value]:c.value.range=[],null!==v.value&&null!==h.value?c.value.limit=[v.value,h.value]:c.value.limit=[];const e={};Object.keys(c.value.handle).forEach(t=>{const a=p.value[t]||t;e[a]=c.value.handle[t],t!==a&&(delete l.value[t],delete i.value[t],i.value[a]=i.value[t]??!0)}),c.value.handle=e,d.value&&s.value!==V.value&&(delete a.value[V.value],delete l.value[V.value]),a.value[s.value]=JSON.parse(JSON.stringify(c.value)),l.value[s.value]=!0,F(),re(`规则 "${s.value}" ${d.value?'更新':'添加'}成功`,'success')}function U(){R(),H()}function J(){C.value=!1,S.value=!1,U()}function P(){C.value=!1,S.value=!1}async function F(){try{L.eraDataRule={...a.value},await L.saveEraDataRules(),re('规则保存成功','success')}catch(e){re('保存失败: '+e,'error')}}function H(){s.value='',d.value=!1,c.value={enable:!0,path:'',if:'',order:0,loop:1,handle:{},range:[],limit:[]},p.value={},i.value={},b.value=null,m.value=null,v.value=null,h.value=null,g.value='list'}function W(){let e=`handle_${Date.now()}`;for(;p.value[e];)e=`handle_${Date.now()}_${Math.random().toString(36).substr(2,5)}`;c.value.handle||(c.value.handle={}),c.value.handle[e]={order:0,loop:1,if:'',op:''},p.value[e]=e,i.value[e]=!0}function K(e){u.collectedPaths.includes(e)?toastr.warning('路径已在收集箱中',''):(u.collectedPaths.push(e),toastr.success('路径已复制到收集箱',''))}function G(e,t){if(A.value=e,D.value=t,'__RULE_IF__'===t)O.value=c.value.if||'';else{const a=c.value.handle[t];a&&a[e]?O.value=a[e]:O.value=''}j.value=!0}function Y(){j.value=!1,O.value='',D.value=''}function q(e){if('__RULE_IF__'===D.value)return c.value.if=e,re('规则条件已应用','success'),Y(),void(s.value&&R());if(!D.value)return void re('未找到对应的handle','error');const t=c.value.handle[D.value];t&&(t[A.value]=e,re('表达式已应用','success'),s.value&&R()),Y()}function X(e,t){const a=c.value.handle[t];a&&(a[e]='')}function Z(){N.value=!1,V.value=''}async function Q(){if(V.value)try{delete a.value[V.value],delete l.value[V.value],await F(),re(`规则 "${V.value}" 删除成功`,'success')}catch(e){re('删除失败: '+e,'error')}finally{Z()}}function ee(){try{const e=k(a.value),t=new Blob([e],{type:'application/json'}),o=URL.createObjectURL(t),n=document.createElement('a');n.href=o,n.download=`era-rules-${(new Date).toISOString().slice(0,10)}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o),re('规则导出成功','success')}catch(e){re('导出失败: '+e,'error')}}function te(e,t){try{const t=function(e){try{const t=JSON.parse(e);if(!t||'object'!=typeof t)throw new Error('无效的JSON格式');let a;a=t.rules&&'object'==typeof t.rules?t.rules:t;for(const e of Object.keys(a)){const t=a[e];t&&'object'==typeof t&&(void 0===t.enable&&(t.enable=!0),void 0===t.order&&(t.order=0),void 0===t.loop&&(t.loop=1),void 0===t.handle&&(t.handle={}))}return a}catch(e){throw y.j.error('导入规则失败:',e),new Error('解析规则文件失败')}}(e);if(!t||'object'!=typeof t)return void re('导入失败：文件格式不正确','error');a.value=t,l.value={},Object.keys(a.value).forEach(e=>l.value[e]=!0),F(),re('规则导入成功','success')}catch(e){re('导入失败：'+e,'error')}}function ne(e){re(e,'error')}function re(e,t){B.value={text:e,type:t},setTimeout(()=>{B.value=null},3e3)}(0,o.onMounted)(async()=>{const{stat_data:e}=getVariables({type:'chat'});t.value=e||{},await async function(){try{await L.getEraDataRules(),a.value=L.eraDataRule||{},re('规则加载成功','success')}catch(e){re('规则加载失败: '+e,'error')}}(),Object.keys(a.value).forEach(e=>l.value[e]=!0)});const le=e=>{t.value=e};function ie(){const e={},t=Object.keys(a.value);t.sort((e,t)=>(a.value[e].order??Number.MAX_SAFE_INTEGER)-(a.value[t].order??Number.MAX_SAFE_INTEGER)),t.forEach(t=>{const o={...a.value[t]};if(o.handle&&Object.keys(o.handle).length>0){const e=Object.entries(o.handle);e.sort(([,e],[,t])=>(e.order??Number.MAX_SAFE_INTEGER)-(t.order??Number.MAX_SAFE_INTEGER)),o.handle={},e.forEach(([e,t])=>{o.handle[e]=t})}e[t]=o}),a.value=e,re('规则和Handle已按Order排序','success')}const se=(0,o.ref)(''),de=(0,o.computed)(()=>{if(!se.value)return t.value;const e=se.value.toLowerCase();const a=function t(a,o=''){if(null==a)return a;if('object'==typeof a&&!Array.isArray(a)){const n={};let r=!1;for(const[l,i]of Object.entries(a)){const a=o?`${o}.${l}`:l;if(l.toLowerCase().includes(e))n[l]=i,r=!0;else if('object'==typeof i&&null!==i){const e=t(i,a);void 0!==e&&(n[l]=e,r=!0)}else String(i).toLowerCase().includes(e)&&(n[l]=i,r=!0)}return r?n:void 0}if(Array.isArray(a)){const n=[];let r=!1;for(let l=0;l<a.length;l++){const i=o?`${o}[${l}]`:`[${l}]`,s=a[l];if(i.toLowerCase().includes(e))n.push(s),r=!0;else if('object'==typeof s&&null!==s){const a=t(s,i);void 0!==a?(n.push(a),r=!0):String(s).toLowerCase().includes(e)&&(n.push(s),r=!0)}else String(s).toLowerCase().includes(e)&&(n.push(s),r=!0)}return r?n:''===e?[]:void 0}return String(a).toLowerCase().includes(e)?a:void 0}(t.value);return void 0!==a?a:{}});return(e,n)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',Je,[(0,o.createCommentVNode)(' 页签导航 '),(0,o.createElementVNode)('div',Pe,[(0,o.createElementVNode)('div',Fe,[((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(M,e=>(0,o.createElementVNode)('button',{key:e.key,class:(0,o.normalizeClass)({active:g.value===e.key}),onClick:t=>g.value=e.key},(0,o.toDisplayString)(e.label),11,He)),64))])]),(0,o.createCommentVNode)(' 路径收集框 '),'rule'===g.value?((0,o.openBlock)(),(0,o.createBlock)(ce,{key:0,'is-expanded':f.value,'onUpdate:isExpanded':n[0]||(n[0]=e=>f.value=e)},null,8,['is-expanded'])):(0,o.createCommentVNode)('v-if',!0),(0,o.createElementVNode)('div',We,[(0,o.createCommentVNode)(' 1.查看数据 '),(0,o.withDirectives)((0,o.createElementVNode)('section',null,[n[20]||(n[20]=(0,o.createElementVNode)('h2',null,'当前 stat_data（只读）',-1)),(0,o.createCommentVNode)(' 添加搜索框 '),(0,o.createVNode)(Ue.A,{modelValue:se.value,'onUpdate:modelValue':n[1]||(n[1]=e=>se.value=e)},null,8,['modelValue']),(0,o.createElementVNode)('div',Ke,[(0,o.createCommentVNode)(' 修改为使用过滤后的数据 '),(0,o.createVNode)(x,{data:de.value,onSendPath:K},null,8,['data'])])],512),[[o.vShow,'data'===g.value]]),(0,o.createCommentVNode)(' 2. 查看规则（默认折叠） '),(0,o.withDirectives)((0,o.createElementVNode)('section',null,[n[30]||(n[30]=(0,o.createElementVNode)('h2',null,'规则列表',-1)),(0,o.createElementVNode)('div',Ge,[(0,o.createElementVNode)('div',Ye,[(0,o.createVNode)(oe.A,{'import-text':'导入规则','export-text':'导出规则','confirm-title':'导入规则','confirm-content':'导入新规则将覆盖当前所有规则，确定要继续吗？',onExportData:ee,onImportConfirmed:te,onError:ne})]),(0,o.createElementVNode)('div',{class:'sort-controls'},[(0,o.createElementVNode)('button',{class:'btn small',onClick:ie},'按优先级排序')])]),(0,o.createCommentVNode)(' 空状态提示 '),0===Object.keys(a.value).length?((0,o.openBlock)(),(0,o.createElementBlock)('div',qe,[...n[21]||(n[21]=[(0,o.createElementVNode)('svg',{xmlns:'http://www.w3.org/2000/svg',viewBox:'0 0 24 24',fill:'none',stroke:'currentColor','stroke-width':'2'},[(0,o.createElementVNode)('path',{d:'M9 12h6m-6 4h6m2 5H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5.586a1 1 0 0 1 .707.293l5.414 5.414a1 1 0 0 1 .293.707V19a2 2 0 0 1-2 2z'})],-1),(0,o.createElementVNode)('p',null,'暂无规则，从规则编辑添加或从数据面板中选择路径',-1)])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 规则列表 '),((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(a.value,(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:t,class:'rule-card'},[(0,o.createElementVNode)('div',{class:'rule-header',onClick:e=>function(e){l.value[e]=!l.value[e]}(t)},[(0,o.createElementVNode)('div',Ze,[(0,o.createElementVNode)('span',Qe,(0,o.toDisplayString)(t),1),(0,o.createElementVNode)('span',et,[(0,o.createElementVNode)('span',{class:(0,o.normalizeClass)(['status-indicator',{enabled:!1!==e.enable}])},null,2),(0,o.createTextVNode)(' '+(0,o.toDisplayString)(!1!==e.enable?'启用':'禁用'),1)])]),(0,o.createElementVNode)('div',tt,[(0,o.createCommentVNode)(' 恢复测试按钮 '),(0,o.createElementVNode)('button',{class:'btn small',onClick:(0,o.withModifiers)(e=>function(e){const t=a.value[e];if(!t)return void re('找不到指定的规则','warning');g.value='test';const n={[e]:t};(0,o.nextTick)(()=>{T.value?T.value.openDslTesterWithRules(n):re('测试组件尚未加载','error')})}(t),['stop'])},'测试 DSL',8,at),(0,o.createElementVNode)('span',ot,(0,o.toDisplayString)(l.value[t]?'›':'⌄'),1)])],8,Xe),(0,o.withDirectives)((0,o.createElementVNode)('div',nt,[(0,o.createElementVNode)('div',rt,[(0,o.createElementVNode)('div',lt,[(0,o.createElementVNode)('div',null,[n[22]||(n[22]=(0,o.createElementVNode)('strong',null,'路径:',-1)),(0,o.createTextVNode)(' '+(0,o.toDisplayString)(e.path),1)]),e.if?((0,o.openBlock)(),(0,o.createElementBlock)('div',it,[n[23]||(n[23]=(0,o.createElementVNode)('strong',null,'条件:',-1)),(0,o.createTextVNode)(' '+(0,o.toDisplayString)((0,o.unref)(E.w).exprToHumanView(e.if)),1)])):(0,o.createCommentVNode)('v-if',!0),(0,o.createElementVNode)('div',null,[n[24]||(n[24]=(0,o.createElementVNode)('strong',null,'顺序:',-1)),(0,o.createTextVNode)(' '+(0,o.toDisplayString)(e.order),1)]),e.loop?((0,o.openBlock)(),(0,o.createElementBlock)('div',st,[n[25]||(n[25]=(0,o.createElementVNode)('strong',null,'循环:',-1)),(0,o.createTextVNode)(' '+(0,o.toDisplayString)(e.loop),1)])):(0,o.createCommentVNode)('v-if',!0),e.range?((0,o.openBlock)(),(0,o.createElementBlock)('div',dt,[n[26]||(n[26]=(0,o.createElementVNode)('strong',null,'范围:',-1)),(0,o.createTextVNode)(' ['+(0,o.toDisplayString)(e.range[0])+', '+(0,o.toDisplayString)(e.range[1])+']',1)])):(0,o.createCommentVNode)('v-if',!0),e.limit?((0,o.openBlock)(),(0,o.createElementBlock)('div',ct,[n[27]||(n[27]=(0,o.createElementVNode)('strong',null,'限制:',-1)),(0,o.createTextVNode)(' ['+(0,o.toDisplayString)(e.limit[0])+', '+(0,o.toDisplayString)(e.limit[1])+']',1)])):(0,o.createCommentVNode)('v-if',!0)]),(0,o.createCommentVNode)(' handle 列表 '),e.handle&&Object.keys(e.handle).length>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',pt,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(e.handle,(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:t,class:'handle-item'},[(0,o.createElementVNode)('div',ut,[(0,o.createElementVNode)('strong',null,(0,o.toDisplayString)(t),1),(0,o.createTextVNode)(' (顺序: '+(0,o.toDisplayString)(e.order)+', 循环: '+(0,o.toDisplayString)(e.loop)+') ',1)]),e.if?((0,o.openBlock)(),(0,o.createElementBlock)('div',ft,[n[28]||(n[28]=(0,o.createElementVNode)('strong',null,'条件:',-1)),(0,o.createTextVNode)(' '+(0,o.toDisplayString)((0,o.unref)(E.w).exprToHumanView(e.if)),1)])):(0,o.createCommentVNode)('v-if',!0),(0,o.createElementVNode)('div',bt,[n[29]||(n[29]=(0,o.createElementVNode)('strong',null,'操作:',-1)),(0,o.createTextVNode)(' '+(0,o.toDisplayString)((0,o.unref)(E.w).exprToHumanView(e.op)),1)])]))),128))])):(0,o.createCommentVNode)('v-if',!0),(0,o.createElementVNode)('div',mt,[(0,o.createElementVNode)('button',{class:'btn primary',onClick:e=>function(e){s.value=e,d.value=!0,V.value=e,c.value=JSON.parse(JSON.stringify(a.value[e])),void 0===c.value.if&&(c.value.if=''),p.value={},c.value.handle&&Object.keys(c.value.handle).forEach(e=>{p.value[e]=e,i.value[e]=!0}),void 0===c.value.enable&&(c.value.enable=!0),c.value.range&&Array.isArray(c.value.range)&&c.value.range.length>=2?(b.value=c.value.range[0],m.value=c.value.range[1]):(b.value=null,m.value=null),c.value.limit&&Array.isArray(c.value.limit)&&c.value.limit.length>=2?(v.value=c.value.limit[0],h.value=c.value.limit[1]):(v.value=null,h.value=null),g.value='rule'}(t)},'编辑',8,vt),(0,o.createElementVNode)('button',{class:'btn',onClick:e=>function(e){const t=a.value[e],o=JSON.parse(JSON.stringify(t));let n=`${e}_copy`,r=1;for(;a.value[n];)n=`${e}_copy${r}`,r++;a.value[n]=o,l.value[n]=!0,F(),re(`规则 "${e}" 已复制为 "${n}"`,'success')}(t)},'复制',8,ht),(0,o.createElementVNode)('button',{class:'btn danger',onClick:e=>function(e){V.value=e,N.value=!0}(t)},'删除',8,gt)])])],512),[[o.vShow,!l.value[t]]])]))),128))],512),[[o.vShow,'list'===g.value]]),(0,o.createCommentVNode)(' 3. 编辑规则 '),(0,o.withDirectives)((0,o.createElementVNode)('section',null,[(0,o.createElementVNode)('h2',null,(0,o.toDisplayString)(s.value?'更新规则':'新增规则'),1),(0,o.createElementVNode)('div',xt,[n[31]||(n[31]=(0,o.createElementVNode)('label',null,'规则名称:',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':n[2]||(n[2]=e=>s.value=e),placeholder:'唯一标识，如: 好感度rule1'},null,512),[[o.vModelText,s.value]])]),(0,o.createElementVNode)('div',yt,[n[33]||(n[33]=(0,o.createElementVNode)('label',null,'启用:',-1)),(0,o.createElementVNode)('div',kt,[(0,o.withDirectives)((0,o.createElementVNode)('input',{id:'enableToggle','onUpdate:modelValue':n[3]||(n[3]=e=>c.value.enable=e),type:'checkbox','true-value':!0,'false-value':!1},null,512),[[o.vModelCheckbox,c.value.enable]]),n[32]||(n[32]=(0,o.createElementVNode)('label',{for:'enableToggle',class:'toggle-label'},null,-1))])]),(0,o.createElementVNode)('div',wt,[n[34]||(n[34]=(0,o.createElementVNode)('label',null,'路径:',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':n[4]||(n[4]=e=>c.value.path=e),placeholder:'角色.*.特殊状态.好感度'},null,512),[[o.vModelText,c.value.path]])]),(0,o.createElementVNode)('div',Et,[n[35]||(n[35]=(0,o.createElementVNode)('label',null,'排序:',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':n[5]||(n[5]=e=>c.value.order=e),type:'number',min:'0'},null,512),[[o.vModelText,c.value.order,void 0,{number:!0}]])]),(0,o.createElementVNode)('div',Nt,[n[36]||(n[36]=(0,o.createElementVNode)('label',null,'规则循环:',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':n[6]||(n[6]=e=>c.value.loop=e),type:'number',min:'1',max:'10000',placeholder:'1'},null,512),[[o.vModelText,c.value.loop,void 0,{number:!0}]])]),(0,o.createElementVNode)('div',Vt,[n[37]||(n[37]=(0,o.createElementVNode)('label',null,'范围限制:',-1)),(0,o.createElementVNode)('div',Ct,[(0,o.createElementVNode)('div',St,[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':n[7]||(n[7]=e=>b.value=e),type:'number',placeholder:'最小值'},null,512),[[o.vModelText,b.value,void 0,{number:!0}]])]),(0,o.createElementVNode)('div',Bt,[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':n[8]||(n[8]=e=>m.value=e),type:'number',placeholder:'最大值'},null,512),[[o.vModelText,m.value,void 0,{number:!0}]])])])]),(0,o.createElementVNode)('div',jt,[n[38]||(n[38]=(0,o.createElementVNode)('label',null,'变化值限制:',-1)),(0,o.createElementVNode)('div',_t,[(0,o.createElementVNode)('div',At,[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':n[9]||(n[9]=e=>v.value=e),type:'number',placeholder:'负向最大'},null,512),[[o.vModelText,v.value,void 0,{number:!0}]])]),(0,o.createElementVNode)('div',zt,[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':n[10]||(n[10]=e=>h.value=e),type:'number',placeholder:'正向最大'},null,512),[[o.vModelText,h.value,void 0,{number:!0}]])])])]),(0,o.createElementVNode)('div',Dt,[(0,o.createElementVNode)('div',{class:'handle-area-header'},[n[39]||(n[39]=(0,o.createElementVNode)('span',null,'handle 运算配置:',-1)),(0,o.createElementVNode)('button',{class:'btn small primary',onClick:W},'+ 添加 handle')]),(0,o.createCommentVNode)(' 规则级别的 IF 配置 '),(0,o.createElementVNode)('div',Ot,[(0,o.createElementVNode)('div',$t,[(0,o.createElementVNode)('div',Tt,[n[40]||(n[40]=(0,o.createElementVNode)('label',null,[(0,o.createTextVNode)('规则执行条件 (if): '),(0,o.createElementVNode)('span',{style:{'font-size':'0.85em',color:'#666','font-weight':'normal'}},'(控制所有Handle规则的执行)')],-1)),(0,o.createElementVNode)('div',Mt,[(0,o.createElementVNode)('button',{class:'btn small',onClick:n[11]||(n[11]=e=>G('if','__RULE_IF__'))},'构建'),c.value.if?((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:0,class:'btn small danger',onClick:n[12]||(n[12]=e=>c.value.if='')},'清空')):(0,o.createCommentVNode)('v-if',!0)])]),(0,o.createElementVNode)('div',Lt,[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':n[13]||(n[13]=e=>c.value.if=e),readonly:'',placeholder:'点击\'构建\'按钮创建规则条件表达式，为空则默认执行',onClick:n[14]||(n[14]=e=>G('if','__RULE_IF__'))},null,512),[[o.vModelText,c.value.if]])])])]),((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(c.value.handle,(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:t,class:'handle-editor'},[(0,o.createElementVNode)('div',{class:'handle-header',onClick:e=>i.value[t]=!i.value[t]},[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':e=>p.value[t]=e,placeholder:'handle名称',class:'handle-name-input'},null,8,Rt),[[o.vModelText,p.value[t]]]),(0,o.createElementVNode)('div',Ut,[(0,o.createElementVNode)('span',Jt,(0,o.toDisplayString)(i.value[t]?'›':'⌄'),1),(0,o.createElementVNode)('button',{class:'btn small danger',onClick:(0,o.withModifiers)(e=>{return a=t,delete c.value.handle[a],delete p.value[a],void delete i.value[a];var a},['stop'])},'删除',8,Pt)])],8,It),(0,o.withDirectives)((0,o.createElementVNode)('div',null,[(0,o.createElementVNode)('div',Ft,[n[41]||(n[41]=(0,o.createElementVNode)('label',null,'处理顺序:',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':t=>e.order=t,type:'number',min:'0',placeholder:'0'},null,8,Ht),[[o.vModelText,e.order,void 0,{number:!0}]])]),(0,o.createElementVNode)('div',Wt,[n[42]||(n[42]=(0,o.createElementVNode)('label',null,'循环次数:',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':t=>e.loop=t,type:'number',min:'1',max:'1000',placeholder:'1'},null,8,Kt),[[o.vModelText,e.loop,void 0,{number:!0}]])]),(0,o.createElementVNode)('div',Gt,[(0,o.createElementVNode)('div',Yt,[n[43]||(n[43]=(0,o.createElementVNode)('label',null,'条件表达式 (if):',-1)),(0,o.createElementVNode)('div',qt,[(0,o.createElementVNode)('button',{class:'btn small',onClick:e=>G('if',t)},'构建',8,Xt),e.if?((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:0,class:'btn small danger',onClick:e=>X('if',t)},'清空',8,Zt)):(0,o.createCommentVNode)('v-if',!0)])]),(0,o.createElementVNode)('div',Qt,[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':t=>e.if=t,readonly:'',placeholder:'点击\'构建\'按钮创建条件表达式',onClick:e=>G('if',t)},null,8,ea),[[o.vModelText,e.if]])])]),(0,o.createElementVNode)('div',ta,[(0,o.createElementVNode)('div',aa,[n[44]||(n[44]=(0,o.createElementVNode)('label',null,'操作表达式 (op):',-1)),(0,o.createElementVNode)('div',oa,[(0,o.createElementVNode)('button',{class:'btn small',onClick:e=>G('op',t)},'构建',8,na),e.op?((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:0,class:'btn small danger',onClick:e=>X('op',t)},'清空',8,ra)):(0,o.createCommentVNode)('v-if',!0)])]),(0,o.createElementVNode)('div',la,[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':t=>e.op=t,readonly:'',placeholder:'点击\'构建\'按钮创建操作表达式',onClick:e=>G('op',t)},null,8,ia),[[o.vModelText,e.op]])])])],512),[[o.vShow,!i.value[t]]])]))),128))]),n[45]||(n[45]=(0,o.createElementVNode)('hr',null,null,-1)),(0,o.createElementVNode)('div',{class:'button-group'},[(0,o.createElementVNode)('button',{class:'btn primary',onClick:I},'保存'),(0,o.createElementVNode)('button',{class:'btn',onClick:H},'取消')])],512),[[o.vShow,'rule'===g.value]]),(0,o.createCommentVNode)(' 4. 测试模拟 '),(0,o.withDirectives)((0,o.createElementVNode)('section',null,[(0,o.createCommentVNode)(' 添加 ref 引用 '),(0,o.createVNode)(Re,{ref_key:'simulationTestRef',ref:T,rules:a.value,'stat-data':t.value,onUpdateStatData:le},null,8,['rules','stat-data'])],512),[[o.vShow,'test'===g.value]])]),(0,o.createCommentVNode)(' DSL 构建器模态框 '),(0,o.createVNode)(ae,{visible:j.value,'onUpdate:visible':n[15]||(n[15]=e=>j.value=e),expression:O.value,'onUpdate:expression':n[16]||(n[16]=e=>O.value=e),type:A.value,'selected-path':c.value.path||'',onApply:q,onClose:Y},null,8,['visible','expression','type','selected-path']),(0,o.createCommentVNode)(' 自定义弹窗组件 '),(0,o.createVNode)(w.A,{visible:N.value,'onUpdate:visible':n[17]||(n[17]=e=>N.value=e),title:'确认删除',content:'确定要删除该规则吗？此操作不可恢复',type:'confirm','confirm-text':'确认删除','cancel-text':'取消',onConfirm:Q,onCancel:Z},null,8,['visible']),(0,o.createVNode)(w.A,{visible:C.value,'onUpdate:visible':n[18]||(n[18]=e=>C.value=e),title:'规则名称重复',content:'已存在同名规则，是否覆盖？',type:'confirm','confirm-text':'覆盖','cancel-text':'取消',onConfirm:J,onCancel:P},null,8,['visible']),(0,o.createVNode)(w.A,{visible:S.value,'onUpdate:visible':n[19]||(n[19]=e=>S.value=e),title:'Handle名称重复',content:'已存在同名Handle，是否覆盖？',type:'confirm','confirm-text':'覆盖','cancel-text':'取消',onConfirm:J,onCancel:P},null,8,['visible']),(0,o.createCommentVNode)(' 消息提示 '),B.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:1,class:(0,o.normalizeClass)(['status-message',B.value.type])},(0,o.toDisplayString)(B.value.text),3)):(0,o.createCommentVNode)('v-if',!0)]))}});a(5614);const da=(0,m.A)(sa,[['__scopeId','data-v-fba43b2c']])},1754:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var o=a(9433),n=a.n(o),r=a(5378),l=a.n(r)()(n());l.push([e.id,'.era-rule-panel[data-v-fba43b2c]{margin:8px 0 16px;display:flex;flex-direction:column;flex:1;background:#f5f6fa;font-size:12px;color:#111827;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.1);position:relative}.sticky-tabs[data-v-fba43b2c]{position:sticky;top:0;z-index:10;background:#f5f6fa;border-bottom:1px solid #e5e7eb}.tabs-container[data-v-fba43b2c]{display:flex;gap:8px;padding:12px 16px 8px;background:#f5f6fa}.tabs-container button[data-v-fba43b2c]{padding:8px 16px;border:none;background:none;font-size:13px;color:#111827;cursor:pointer;position:relative;transition:color .2s;border-radius:6px;font-weight:600}.tabs-container button[data-v-fba43b2c]::after{content:"";position:absolute;left:0;right:0;bottom:-9px;height:2px;background:#6366f1;transform:scaleX(0);transition:transform .2s}.tabs-container button.active[data-v-fba43b2c]{color:#4f46e5;font-weight:700}.tabs-container button.active[data-v-fba43b2c]::after{transform:scaleX(1)}.tabs-container button[data-v-fba43b2c]:hover{background:rgba(99,102,241,.08)}.content-wrapper[data-v-fba43b2c]{flex:1;min-height:0;overflow-y:auto;padding:0 16px 16px}section[data-v-fba43b2c]{min-height:0;display:flex;flex-direction:column;gap:12px;padding-top:12px}h2[data-v-fba43b2c]{margin:0 0 8px;font-size:15px;font-weight:600;color:#111827}.json-tree-box[data-v-fba43b2c]{flex:1;min-height:0;overflow:auto;background:#fff;border:1px solid #e5e7eb;border-radius:6px;padding:8px;box-shadow:0 1px 2px 0 rgba(0,0,0,.05)}.rule-card[data-v-fba43b2c]{background:#fff;border:1px solid #e5e7eb;border-radius:6px;overflow:hidden;box-shadow:0 1px 2px 0 rgba(0,0,0,.05)}.rule-header[data-v-fba43b2c]{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;background:#f9fafb;cursor:pointer;-webkit-user-select:none;user-select:none;font-weight:500}.rule-body[data-v-fba43b2c]{padding:10px;border-top:1px solid #e5e7eb}.field[data-v-fba43b2c]{display:flex;align-items:center;gap:8px;margin-bottom:8px}.field label[data-v-fba43b2c]{width:70px;font-size:12px;color:#111827;flex-shrink:0;font-weight:500}.field input[data-v-fba43b2c],.field select[data-v-fba43b2c]{flex:1;padding:5px 8px;border:1px solid #e5e7eb;border-radius:6px;font-size:12px;color:#111827;background:#fff;box-shadow:inset 0 1px 2px rgba(0,0,0,.03);transition:border-color .2s,box-shadow .2s}.field input[data-v-fba43b2c]:focus,.field select[data-v-fba43b2c]:focus{outline:none;border-color:#6366f1;box-shadow:0 0 0 3px rgba(99,102,241,.15),inset 0 1px 2px rgba(0,0,0,.03)}.handle-area[data-v-fba43b2c]{margin-top:10px;padding:10px;background:#f9fafb;border-radius:6px}.btn[data-v-fba43b2c]{padding:5px 12px;border:none;border-radius:6px;font-size:12px;cursor:pointer;transition:background .2s,color .2s,transform .15s;background:#f3f4f6;color:#111827;box-shadow:0 1px 2px 0 rgba(0,0,0,.05);font-weight:500}.btn[data-v-fba43b2c]:hover{background:#e5e7eb;color:#000}.btn.primary[data-v-fba43b2c]{background:#4f46e5;color:#fff;font-weight:500}.btn.primary[data-v-fba43b2c]:hover{background:#4338ca;color:#fff}.btn.danger[data-v-fba43b2c]{background:#dc2626;color:#fff;font-weight:500}.btn.danger[data-v-fba43b2c]:hover{background:#b91c1c;color:#fff}.button-group[data-v-fba43b2c]{display:flex;gap:8px;margin-top:12px;justify-content:flex-end}hr[data-v-fba43b2c]{border:none;border-top:1px solid #e5e7eb;margin:10px 0}.status-message[data-v-fba43b2c]{padding:6px 10px;border-radius:4px;font-size:11px;margin-bottom:8px}.status-message.success[data-v-fba43b2c]{background:#d1fae5;color:#065f46;border:1px solid #a7f3d0}.status-message.error[data-v-fba43b2c]{background:#fee2e2;color:#991b1b;border:1px solid #fecaca}.status-message.warning[data-v-fba43b2c]{background:#fef3c7;color:#92400e;border:1px solid #fde68a}.empty-state[data-v-fba43b2c]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;color:#6b7280;font-size:11px;text-align:center}.empty-state svg[data-v-fba43b2c]{width:24px;height:24px;margin-bottom:8px;opacity:.5}.content-wrapper[data-v-fba43b2c]::-webkit-scrollbar{width:8px}.content-wrapper[data-v-fba43b2c]::-webkit-scrollbar-track{background:rgba(0,0,0,0)}.content-wrapper[data-v-fba43b2c]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:4px}.content-wrapper[data-v-fba43b2c]::-webkit-scrollbar-thumb:hover{background:#94a3b8}.json-tree-box[data-v-fba43b2c]::-webkit-scrollbar{width:6px}.json-tree-box[data-v-fba43b2c]::-webkit-scrollbar-track{background:#f1f5f9;border-radius:3px}.json-tree-box[data-v-fba43b2c]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}.json-tree-box[data-v-fba43b2c]::-webkit-scrollbar-thumb:hover{background:#94a3b8}.rule-operations[data-v-fba43b2c]{display:flex;gap:8px;margin-top:8px}.rule-operations .btn[data-v-fba43b2c]{flex:1;min-width:60px}.rule-status[data-v-fba43b2c]{margin-left:8px;font-size:11px;color:#6b7280;display:flex;align-items:center;gap:4px}.status-indicator[data-v-fba43b2c]{width:8px;height:8px;border-radius:50%;background:#ef4444}.status-indicator.enabled[data-v-fba43b2c]{background:#10b981}.rule-name-container[data-v-fba43b2c]{display:flex;align-items:center}.toggle-switch[data-v-fba43b2c]{position:relative;width:44px;height:22px}.toggle-switch input[data-v-fba43b2c]{opacity:0;width:0;height:0}.toggle-label[data-v-fba43b2c]{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#e5e7eb;transition:.3s;border-radius:22px}.toggle-label[data-v-fba43b2c]:before{position:absolute;content:"";height:16px;width:16px;left:3px;bottom:3px;background-color:#fff;transition:.3s;border-radius:50%}input:checked+.toggle-label[data-v-fba43b2c]{background-color:#10b981}input:checked+.toggle-label[data-v-fba43b2c]:before{transform:translateX(40px)}.btn.small[data-v-fba43b2c]{padding:3px 8px;font-size:11px}.rule-list-controls[data-v-fba43b2c]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.import-export-buttons[data-v-fba43b2c]{display:flex;gap:8px}.sort-controls[data-v-fba43b2c]{display:flex;gap:8px}.range-limit-inputs[data-v-fba43b2c]{display:flex;gap:8px;flex:1}.input-group[data-v-fba43b2c]{display:flex;align-items:center;flex:1;gap:4px;min-width:0}.input-label[data-v-fba43b2c]{font-size:11px;color:#111827;min-width:28px;white-space:nowrap;font-weight:500}.range-limit-inputs input[data-v-fba43b2c]{flex:1;padding:4px 6px;border:1px solid #e5e7eb;border-radius:4px;font-size:11px;min-width:0}.handle-area[data-v-fba43b2c]{margin-top:16px}.handle-area-header[data-v-fba43b2c]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.handle-editor[data-v-fba43b2c]{margin-bottom:16px;padding:12px;background:#f9fafb;border:1px solid #e5e7eb;border-radius:6px}.handle-header[data-v-fba43b2c]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;padding-bottom:8px;border-bottom:1px solid #e5e7eb;cursor:pointer;-webkit-user-select:none;user-select:none}.handle-name-input[data-v-fba43b2c]{font-weight:bold;border:1px solid #d1d5db;border-radius:4px;padding:4px 8px;width:auto;min-width:120px;color:#111827;cursor:text}.handle-name-input[data-v-fba43b2c]:focus{outline:none;border-color:#6366f1;box-shadow:0 0 0 3px rgba(99,102,241,.15)}.handle-actions[data-v-fba43b2c]{display:flex;align-items:center;gap:8px}.fold-indicator[data-v-fba43b2c]{font-size:16px;font-weight:bold;color:#6b7280;transition:transform .2s;cursor:pointer}.dsl-builder[data-v-fba43b2c]{margin:8px 0}.dsl-header[data-v-fba43b2c]{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}.dsl-header label[data-v-fba43b2c]{font-size:12px;font-weight:600;color:#111827}.dsl-preview input[data-v-fba43b2c]{width:100%;padding:6px 8px;border:1px solid #e5e7eb;border-radius:4px;font-size:11px;background:#f8fafc;cursor:pointer;color:#111827;font-weight:500}.dsl-preview input[data-v-fba43b2c]:hover{background:#f1f5f9}.handle-list[data-v-fba43b2c]{margin:12px 0}.handle-list .handle-item[data-v-fba43b2c]{margin-bottom:8px;padding:8px;background:#f8fafc;border:1px solid #e2e8f0;border-radius:4px}.handle-expression[data-v-fba43b2c]{margin:4px 0;font-size:11px;color:#111827;overflow-x:auto;word-break:break-all}.handle-expression strong[data-v-fba43b2c]{color:#000;font-weight:600}.rule-details[data-v-fba43b2c]{margin-bottom:12px;font-size:12px;color:#111827}.rule-details div[data-v-fba43b2c]{margin:4px 0;color:#111827}@media (max-width:768px){.sticky-tabs[data-v-fba43b2c]{padding:0}.tabs-container[data-v-fba43b2c]{padding:10px 12px 6px;gap:4px}.tabs-container button[data-v-fba43b2c]{padding:6px 10px;font-size:12px}.content-wrapper[data-v-fba43b2c]{padding:0 12px 12px}.range-limit-inputs[data-v-fba43b2c]{flex-direction:column;gap:2px}.input-group[data-v-fba43b2c]{min-width:calc(50% - 4px)}}','']);const i=l},1857:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var o=a(9433),n=a.n(o),r=a(5378),l=a.n(r)()(n());l.push([e.id,'.json-tree[data-v-4a5d571c]{font-family:monospace;font-size:12px;overflow-x:auto;padding:10px;background-color:#fff}.empty-tree[data-v-4a5d571c]{padding:20px;color:#9ca3af;text-align:center}','']);const i=l},2008:(e,t,a)=>{var o=a(5452);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('075e405f',o,!1,{ssrId:!0})},2344:(e,t,a)=>{a.d(t,{default:()=>me}),a.r(t);var o=a(4061),n=a(688),r=a(5632),l=a(5114),i=a(9761),s=a(3035),d=a(4167),c=a(4544);const p={class:'config-container'},u={class:'collapsible-section'},f={class:'section-content'},b={class:'world-info-config'},m={class:'config-section'},v={class:'toggle-icon'},h={class:'entry-list'},g=['onUpdate:modelValue'],x=['value'],y=['onClick'],k={class:'config-section'},w={class:'toggle-icon'},E={class:'entry-list'},N=['onUpdate:modelValue'],V=['value'],C=['onClick'],S={class:'config-section'},B={class:'toggle-icon'},j={class:'entry-list'},A=['onUpdate:modelValue'],D=['value'],O=['onClick'],T={class:'collapsible-section'},M={class:'toggle-icon'},L={class:'section-content'},I={class:'regex-config'},R={class:'config-section'},U={class:'toggle-icon'},J={class:'entry-list'},P=['onUpdate:modelValue'],F=['onClick'],H={class:'actions'},W=(0,o.defineComponent)({__name:'WorldInfoAndRegexConfig',setup(e){const t=(0,l.$)(),{analyzeRores:a,updateRores:n,ignoreRores:i,regexList:W}=(0,s.storeToRefs)(t),K=(0,o.ref)(!1),G=(0,o.ref)(!1),Y=(0,o.ref)(!1),q=(0,o.ref)(!1),X=(0,o.ref)(!1),Z=(0,o.ref)(!1),Q=(0,o.ref)([]),ee=(0,o.ref)([]),te=(0,o.ref)([]),ae=(0,o.ref)([]),oe=(0,o.ref)([]),ne=()=>{K.value=!K.value},re=()=>{G.value=!G.value},le=()=>{Y.value=!Y.value},ie=()=>{q.value=!q.value},se=()=>{X.value=!X.value},de=()=>{Z.value=!Z.value},ce=async()=>{try{oe.value=await d.X.getAllWorldBookNames()}catch(e){console.error('获取世界书名称失败:',e),r.error('获取世界书名称失败')}},pe=async()=>{await ce(),r.info('世界书列表已刷新')},ue=()=>{Q.value.push('')},fe=()=>{ee.value.push('')},be=()=>{te.value.push('')},me=()=>{ae.value.push('<(variable(?:insert|edit|delete))>\\s*(?=[\\s\\S]*?\\S[\\s\\S]*?</\\1>)((?:(?!<(?:era_data|variable(?:think|insert|edit|delete))>|</\\1>)[\\s\\S])*?)\\s*</\\1>')},ve=async()=>{a.value=[...Q.value],n.value=[...ee.value],i.value=[...te.value],W.value=[...ae.value],await t.saveWorldInfoFilterConfig(),await t.saveRegexConfig(),r.success('配置已保存')},he=async()=>{confirm('确定要清空所有配置吗？')&&(Q.value=[],ee.value=[],te.value=[],ae.value=[],await t.clearWorldInfoFilterConfig(),await t.clearRegexConfig(),r.info('配置已清空'))},ge=()=>{try{const e={analyzeEntries:Q.value,updateEntries:ee.value,ignoreEntries:te.value,regexList:ae.value.map(e=>e)},t=new Blob([JSON.stringify(e,null,2)],{type:'application/json'}),a=URL.createObjectURL(t),o=document.createElement('a');o.href=a,o.download=`worldinfo-regex-config-${(new Date).toISOString().slice(0,10)}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a)}catch(e){console.error('导出配置失败:',e),r.error('导出配置失败')}},xe=e=>{try{const t=JSON.parse(e);if('object'!=typeof t||null===t)return void r.error('无效的配置文件格式');Array.isArray(t.analyzeEntries)&&(Q.value=[...t.analyzeEntries]),Array.isArray(t.updateEntries)&&(ee.value=[...t.updateEntries]),Array.isArray(t.ignoreEntries)&&(te.value=[...t.ignoreEntries]),Array.isArray(t.regexList)&&(ae.value=[...t.regexList]),r.success('配置导入成功')}catch(e){console.error('导入配置失败:',e),r.error('导入配置失败: '+(e instanceof Error?e.message:'无效的配置文件'))}};return(0,o.onMounted)(async()=>{await ce(),Q.value=[...a.value],ee.value=[...n.value],te.value=[...i.value],ae.value=[...W.value]}),(0,o.watch)(()=>[a.value,n.value,i.value,W.value],()=>{Q.value=[...a.value],ee.value=[...n.value],te.value=[...i.value],ae.value=[...W.value]}),(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',p,[(0,o.createCommentVNode)(' 世界书配置部分 '),(0,o.createElementVNode)('div',u,[(0,o.createElementVNode)('div',{class:'section-header',onClick:ne},[...t[0]||(t[0]=[(0,o.createElementVNode)('h4',null,'世界书配置',-1)])]),(0,o.withDirectives)((0,o.createElementVNode)('div',f,[(0,o.createElementVNode)('div',b,[(0,o.createElementVNode)('div',m,[(0,o.createElementVNode)('div',{class:'subsection-header',onClick:le},[t[1]||(t[1]=(0,o.createElementVNode)('h5',null,'AnalyzeList',-1)),(0,o.createElementVNode)('span',v,(0,o.toDisplayString)(Y.value?'−':'+'),1)]),(0,o.withDirectives)((0,o.createElementVNode)('div',h,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(Q.value,(e,a)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:a,class:'entry-item'},[(0,o.withDirectives)((0,o.createElementVNode)('select',{'onUpdate:modelValue':e=>Q.value[a]=e,class:'entry-select light-theme'},[t[2]||(t[2]=(0,o.createElementVNode)('option',{value:''},'请选择世界书条目',-1)),((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(oe.value,e=>((0,o.openBlock)(),(0,o.createElementBlock)('option',{key:e,value:e},(0,o.toDisplayString)(e),9,x))),128))],8,g),[[o.vModelSelect,Q.value[a]]]),(0,o.createElementVNode)('button',{class:'btn remove-btn',onClick:e=>(e=>{Q.value.splice(e,1)})(a)},'×',8,y)]))),128)),(0,o.createElementVNode)('button',{class:'btn add-btn',onClick:ue},'添加条目')],512),[[o.vShow,Y.value]])]),(0,o.createElementVNode)('div',k,[(0,o.createElementVNode)('div',{class:'subsection-header',onClick:ie},[t[3]||(t[3]=(0,o.createElementVNode)('h5',null,'UpdateList',-1)),(0,o.createElementVNode)('span',w,(0,o.toDisplayString)(q.value?'−':'+'),1)]),(0,o.withDirectives)((0,o.createElementVNode)('div',E,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(ee.value,(e,a)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:a,class:'entry-item'},[(0,o.withDirectives)((0,o.createElementVNode)('select',{'onUpdate:modelValue':e=>ee.value[a]=e,class:'entry-select light-theme'},[t[4]||(t[4]=(0,o.createElementVNode)('option',{value:''},'请选择世界书条目',-1)),((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(oe.value,e=>((0,o.openBlock)(),(0,o.createElementBlock)('option',{key:e,value:e},(0,o.toDisplayString)(e),9,V))),128))],8,N),[[o.vModelSelect,ee.value[a]]]),(0,o.createElementVNode)('button',{class:'btn remove-btn',onClick:e=>(e=>{ee.value.splice(e,1)})(a)},'×',8,C)]))),128)),(0,o.createElementVNode)('button',{class:'btn add-btn',onClick:fe},'添加条目')],512),[[o.vShow,q.value]])]),(0,o.createElementVNode)('div',S,[(0,o.createElementVNode)('div',{class:'subsection-header',onClick:se},[t[5]||(t[5]=(0,o.createElementVNode)('h5',null,'IgnoreList',-1)),(0,o.createElementVNode)('span',B,(0,o.toDisplayString)(X.value?'−':'+'),1)]),(0,o.withDirectives)((0,o.createElementVNode)('div',j,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(te.value,(e,a)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:a,class:'entry-item'},[(0,o.withDirectives)((0,o.createElementVNode)('select',{'onUpdate:modelValue':e=>te.value[a]=e,class:'entry-select light-theme'},[t[6]||(t[6]=(0,o.createElementVNode)('option',{value:''},'请选择世界书条目',-1)),((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(oe.value,e=>((0,o.openBlock)(),(0,o.createElementBlock)('option',{key:e,value:e},(0,o.toDisplayString)(e),9,D))),128))],8,A),[[o.vModelSelect,te.value[a]]]),(0,o.createElementVNode)('button',{class:'btn remove-btn',onClick:e=>(e=>{te.value.splice(e,1)})(a)},'×',8,O)]))),128)),(0,o.createElementVNode)('button',{class:'btn add-btn',onClick:be},'添加条目')],512),[[o.vShow,X.value]])])])],512),[[o.vShow,K.value]])]),(0,o.createCommentVNode)(' 正则表达式配置部分 '),(0,o.createElementVNode)('div',T,[(0,o.createElementVNode)('div',{class:'section-header',onClick:re},[t[7]||(t[7]=(0,o.createElementVNode)('h4',null,'正则表达式配置',-1)),(0,o.createElementVNode)('span',M,(0,o.toDisplayString)(G.value?'−':'+'),1)]),(0,o.withDirectives)((0,o.createElementVNode)('div',L,[(0,o.createElementVNode)('div',I,[(0,o.createElementVNode)('div',R,[(0,o.createElementVNode)('div',{class:'subsection-header',onClick:de},[t[8]||(t[8]=(0,o.createElementVNode)('h5',null,'正则表达式列表',-1)),(0,o.createElementVNode)('span',U,(0,o.toDisplayString)(Z.value?'−':'+'),1)]),(0,o.withDirectives)((0,o.createElementVNode)('div',J,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(ae.value,(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:t,class:'entry-item'},[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':e=>ae.value[t]=e,type:'text',class:'regex-input light-theme',placeholder:'请输入正则表达式'},null,8,P),[[o.vModelText,ae.value[t]]]),(0,o.createElementVNode)('button',{class:'btn remove-btn',onClick:e=>(e=>{ae.value.splice(e,1)})(t)},'×',8,F)]))),128)),(0,o.createElementVNode)('button',{class:'btn add-btn',onClick:me},'添加正则')],512),[[o.vShow,Z.value]]),t[9]||(t[9]=(0,o.createElementVNode)('h6',null,'（请不要导入来源未知的json，以避免遭到恶意攻击）',-1))])])],512),[[o.vShow,G.value]])]),(0,o.createCommentVNode)(' 操作按钮 '),(0,o.createElementVNode)('div',H,[(0,o.createElementVNode)('button',{class:'btn primary',onClick:pe},'刷新世界书列表'),(0,o.createElementVNode)('button',{class:'btn danger',onClick:he},'清空配置'),(0,o.createVNode)(c.A,{'import-text':'导入配置','export-text':'导出配置','confirm-title':'导入配置确认','confirm-content':'导入新配置将覆盖当前配置，确定要继续吗？',onImportConfirmed:xe,onExportData:ge}),(0,o.createElementVNode)('button',{class:'btn primary',onClick:ve},'保存配置')])]))}});a(1096);var K=a(1400);const G=(0,K.A)(W,[['__scopeId','data-v-3cf7ae52']]),Y={class:'page-tabs'},q={class:'switch-row'},X=['checked'],Z={class:'row'},Q={key:0,class:'row'},ee=['value','title'],te={key:1,class:'form'},ae={class:'row'},oe={class:'row'},ne={class:'row'},re={class:'row'},le=['value','title'],ie=['value'],se={class:'row'},de={class:'row'},ce={class:'row'},pe={class:'row'},ue={class:'row',style:{'justify-content':'flex-start',gap:'12px'}},fe={key:0,class:'footer'},be=(0,o.defineComponent)({__name:'AsyncAnalyze',setup(e){const t=(0,n.n)(),a=(0,l.$)(),s=(0,o.ref)('model'),d=(e,t=36)=>e.length>t?e.slice(0,t-1)+'…':e,c=(0,o.ref)('sample'),p=(0,o.ref)(''),u=(0,o.ref)([]),f=(0,o.reactive)({baseURL:'',apiKey:'',modelName:'',temperature:.7,frequencyPenalty:0,presencePenalty:0,maxTokens:2e4}),b=async()=>{'profile'===c.value&&await m()},m=async()=>{try{const e=await window.SillyTavern.executeSlashCommands('/profile-list');u.value=JSON.parse(e.pipe),i.j.log('预设名称列表:',u.value)}catch(e){r.error('获取预设列表失败'),i.j.error('刷新预设列表失败',e),u.value=[]}};(0,o.watch)(()=>t.showUI,async e=>{e&&(c.value=a.modelSource,p.value=a.profileSetting||'',Object.assign(f,a.customModelSettings),await m())},{immediate:!0});const v=async()=>{'model'===s.value&&(a.modelSource=c.value,a.profileSetting=p.value,a.customModelSettings={...f},await a.saveModelSettings(),r.success('设置已保存'))},h=async()=>{'model'===s.value&&(await a.clearModelSettings(),c.value=a.modelSource,p.value=a.profileSetting||'',Object.assign(f,a.customModelSettings),r.info('已清空设置'))},g=()=>{t.showUI=!1},x=async()=>{if(await v(),'sample'===c.value||'profile'===c.value){try{let e;'profile'===c.value&&(e=(await window.SillyTavern.executeSlashCommands('/profile')).pipe,i.j.log('当前预设名称:',e),await window.SillyTavern.executeSlashCommands(`/profile ${p.value}`));const t=await window.SillyTavern.executeSlashCommands('/model');t.error?r.error(`模型异常：${t.error}`):(r.success('模型连接正常 ✓'),'profile'===c.value&&await window.SillyTavern.executeSlashCommands(`/profile ${e}`))}catch(e){r.error(`检测失败：${e.message||'未知错误'}`)}return}if(!f.baseURL||!f.apiKey)return void r.warning('请先填写接口地址与 API 密钥');const e=new AbortController,t=setTimeout(()=>e.abort(),8e3);try{const a=await fetch(`${f.baseURL.replace(/\/$/,'')}/models`,{method:'GET',headers:{Authorization:`Bearer ${f.apiKey.trim()}`},signal:e.signal});if(clearTimeout(t),a.ok)r.success('连接成功，密钥可用 ✓');else{const e=await a.text().catch(()=>a.statusText);r.error(`连接失败：${a.status} ${e}`)}}catch(e){clearTimeout(t),r.error(`网络错误：${e.message||'无法到达服务器'}`)}},y=(0,o.ref)([]),k=async()=>{if(!f.baseURL||!f.apiKey)return void r.warning('请先填写接口地址与 API 密钥');const e=new AbortController,t=setTimeout(()=>e.abort(),8e3);try{const a=await fetch(`${f.baseURL.replace(/\/$/,'')}/models`,{method:'GET',headers:{Authorization:`Bearer ${f.apiKey.trim()}`},signal:e.signal});clearTimeout(t),a.ok||r.error(`获取失败：${a.status} ${await a.text().catch(()=>a.statusText)}`);const o=await a.json();y.value=(o.data||[]).map(e=>e.id).sort(),r.success(`共拉取 ${y.value.length} 个模型`)}finally{clearTimeout(t)}};return(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',null,[(0,o.createCommentVNode)(' 页面导航 '),(0,o.createElementVNode)('div',Y,[(0,o.createElementVNode)('button',{class:(0,o.normalizeClass)(['tab-button',{active:'model'===s.value}]),onClick:t[0]||(t[0]=e=>s.value='model')},' 模型配置 ',2),(0,o.createElementVNode)('button',{class:(0,o.normalizeClass)(['tab-button',{active:'worldinfo'===s.value}]),onClick:t[1]||(t[1]=e=>s.value='worldinfo')},' 世界书与正则配置 ',2)]),(0,o.createCommentVNode)(' 第一页：模型配置 '),(0,o.withDirectives)((0,o.createElementVNode)('div',null,[t[24]||(t[24]=(0,o.createElementVNode)('h3',{class:'title'},' ERA 分步分析设置 ',-1)),(0,o.createCommentVNode)(' 分步分析开关 '),(0,o.createElementVNode)('label',q,[t[12]||(t[12]=(0,o.createElementVNode)('span',null,'分步分析模式',-1)),(0,o.createElementVNode)('input',{type:'checkbox',checked:(0,o.unref)(a).isAsync,onChange:t[2]||(t[2]=()=>{(0,o.unref)(a).isAsync=!(0,o.unref)(a).isAsync})},null,40,X),t[13]||(t[13]=(0,o.createElementVNode)('span',{class:'switch'},null,-1))]),t[25]||(t[25]=(0,o.createElementVNode)('span',{class:'tip-card'},' ⚠️ 目前流式生成的分析的 ejs 替换有 bug，分步模式请不要打开流式 ',-1)),(0,o.createCommentVNode)(' 模型来源 '),(0,o.createElementVNode)('div',Z,[t[15]||(t[15]=(0,o.createElementVNode)('span',null,'模型来源',-1)),(0,o.withDirectives)((0,o.createElementVNode)('select',{'onUpdate:modelValue':t[3]||(t[3]=e=>c.value=e),onChange:b},[...t[14]||(t[14]=[(0,o.createElementVNode)('option',{value:'sample'},'当前模型',-1),(0,o.createElementVNode)('option',{value:'profile'},'预设模型',-1),(0,o.createElementVNode)('option',{value:'external'},'额外模型',-1)])],544),[[o.vModelSelect,c.value]])]),(0,o.createCommentVNode)('      <div v-if="modelSource === \'profile\'" class="row">'),(0,o.createCommentVNode)('        <span>预设模型</span>'),(0,o.createCommentVNode)('        因为ERA和提示词模板的替换问题，目前不可用😑'),(0,o.createCommentVNode)('      </div>'),(0,o.createCommentVNode)('       TODO 因为ERA的替换问题，目前不可用  预设模型选择（仅 profile 时显示） '),'profile'===c.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',Q,[t[16]||(t[16]=(0,o.createElementVNode)('span',null,'预设模型',-1)),(0,o.withDirectives)((0,o.createElementVNode)('select',{'onUpdate:modelValue':t[4]||(t[4]=e=>p.value=e)},[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(u.value,e=>((0,o.openBlock)(),(0,o.createElementBlock)('option',{key:e,value:e,title:e},(0,o.toDisplayString)(d(e)),9,ee))),128))],512),[[o.vModelSelect,p.value]])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 额外模型参数（仅 external 时显示） '),'external'===c.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',te,[(0,o.createElementVNode)('div',ae,[t[17]||(t[17]=(0,o.createElementVNode)('span',null,'接口地址',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':t[5]||(t[5]=e=>f.baseURL=e),placeholder:'https://api.openai.com/v1'},null,512),[[o.vModelText,f.baseURL]])]),(0,o.createElementVNode)('div',oe,[t[18]||(t[18]=(0,o.createElementVNode)('span',null,'API密钥（请注意好个人隐私）',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':t[6]||(t[6]=e=>f.apiKey=e),type:'password',placeholder:'sk-...'},null,512),[[o.vModelText,f.apiKey]])]),(0,o.createElementVNode)('div',ne,[(0,o.createCommentVNode)(' 模型名称 '),(0,o.createElementVNode)('div',re,[t[19]||(t[19]=(0,o.createElementVNode)('span',null,'模型名称',-1)),(0,o.withDirectives)((0,o.createElementVNode)('select',{'onUpdate:modelValue':t[7]||(t[7]=e=>f.modelName=e),style:{flex:'1'}},[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(y.value,e=>((0,o.openBlock)(),(0,o.createElementBlock)('option',{key:e,value:e,title:e},(0,o.toDisplayString)(d(e)),9,le))),128)),(0,o.createCommentVNode)(' 允许手动输入，兜底 '),f.modelName&&!y.value.includes(f.modelName)?((0,o.openBlock)(),(0,o.createElementBlock)('option',{key:0,value:f.modelName},(0,o.toDisplayString)(f.modelName),9,ie)):(0,o.createCommentVNode)('v-if',!0)],512),[[o.vModelSelect,f.modelName]])])]),(0,o.createElementVNode)('div',se,[t[20]||(t[20]=(0,o.createElementVNode)('span',null,'温度',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':t[8]||(t[8]=e=>f.temperature=e),type:'number',step:'0.1',min:'0',max:'2'},null,512),[[o.vModelText,f.temperature]])]),(0,o.createElementVNode)('div',de,[t[21]||(t[21]=(0,o.createElementVNode)('span',null,'频率惩罚',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':t[9]||(t[9]=e=>f.frequencyPenalty=e),type:'number',step:'0.1',min:'-2',max:'2'},null,512),[[o.vModelText,f.frequencyPenalty]])]),(0,o.createElementVNode)('div',ce,[t[22]||(t[22]=(0,o.createElementVNode)('span',null,'存在惩罚',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':t[10]||(t[10]=e=>f.presencePenalty=e),type:'number',step:'0.1',min:'-2',max:'2'},null,512),[[o.vModelText,f.presencePenalty]])]),(0,o.createElementVNode)('div',pe,[t[23]||(t[23]=(0,o.createElementVNode)('span',null,'最大Token数',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':t[11]||(t[11]=e=>f.maxTokens=e),type:'number',min:'1'},null,512),[[o.vModelText,f.maxTokens]])])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createElementVNode)('div',ue,[(0,o.createElementVNode)('button',{class:'btn small',onClick:x},'测试连接'),'external'===c.value?((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:0,class:'btn small',onClick:k},' 获取模型列表 ')):(0,o.createCommentVNode)('v-if',!0)])],512),[[o.vShow,'model'===s.value]]),(0,o.createCommentVNode)(' 第二页：世界书与正则配置 '),(0,o.withDirectives)((0,o.createElementVNode)('div',null,[t[26]||(t[26]=(0,o.createElementVNode)('h3',{class:'title'},'世界书与正则配置',-1)),(0,o.createVNode)(G)],512),[[o.vShow,'worldinfo'===s.value]]),t[27]||(t[27]=(0,o.createElementVNode)('br',null,null,-1)),(0,o.createCommentVNode)(' 底部按钮 '),'model'===s.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',fe,[(0,o.createElementVNode)('button',{class:'btn',onClick:g},'取消'),(0,o.createElementVNode)('button',{class:'btn danger',onClick:h},'清空'),(0,o.createElementVNode)('button',{class:'btn primary',onClick:v},'保存')])):(0,o.createCommentVNode)('v-if',!0)]))}});a(5894);const me=(0,K.A)(be,[['__scopeId','data-v-51c0384a']])},2393:(e,t,a)=>{a.d(t,{w:()=>f});class o{input;position=0;tokens=[];constructor(e){this.input=e}tokenize(){for(this.position=0,this.tokens=[],this.skipWrapperHeader();this.position<this.input.length;){const e=this.input[this.position];if(this.isWhitespace(e))this.position++;else if('>'!==e)if('('!==e)if(')'!==e)if('$'!==e)if('@'!==e)if('&'!==e)if('?'!==e)if('#'!==e){if(']'!==e)throw new Error(`意外的字符: ${e} 位于位置 ${this.position}`);this.addToken('RBRACKET',']')}else this.tokenizeHash();else this.tokenizeQuestion();else this.tokenizeAmpersand();else this.tokenizeAt();else this.tokenizeDollar();else this.addToken('RPAREN',')');else this.addToken('LPAREN','(');else this.position++}return this.addToken('EOF',''),this.tokens}skipWrapperHeader(){const e=this.input.slice(this.position).match(/^<<(if|op)>\s*/);e&&(this.position+=e[0].length)}tokenizeDollar(){const e=this.position;if(this.position++,'['!==this.peek())throw new Error('在 "$" 后面需要 "["');this.position++;const t=this.position;for(;this.position<this.input.length&&']'!==this.peek();)this.position++;const a=this.input.slice(t,this.position);if(']'!==this.peek())throw new Error('未闭合的标识符');this.position++,this.tokens.push({type:'IDENTIFIER',value:a,start:e,end:this.position})}tokenizeAt(){const e=this.position;if(this.position++,'['!==this.peek())throw new Error('在 "@" 后面需要 "["');this.position++;const t=this.position;for(;this.position<this.input.length&&']'!==this.peek();)this.position++;const a=this.input.slice(t,this.position);if(']'!==this.peek())throw new Error('未闭合的临时变量');if(this.position++,!/^\{(g|s)\}\w+$/.test(a))throw new Error(`无效的临时变量格式: @[${a}]`);this.tokens.push({type:'TEMP_VARIABLE',value:a,start:e,end:this.position})}tokenizeAmpersand(){const e=this.position;if(this.position++,'['!==this.peek())throw new Error('在 "&" 后面需要 "["');this.position++;const t=this.position;for(;this.position<this.input.length&&']'!==this.peek();)this.position++;const a=this.input.slice(t,this.position);if(']'!==this.peek())throw new Error('未闭合的字面量');this.position++,this.tokens.push({type:'LITERAL',value:a,start:e,end:this.position})}tokenizeQuestion(){const e=this.position;if(this.position++,'['!==this.peek())throw new Error('在 "?" 后面需要 "["');this.position++;const t=this.position;for(;this.position<this.input.length&&']'!==this.peek();)this.position++;const a=this.input.slice(t,this.position);if(']'!==this.peek())throw new Error('Unclosed operator');this.position++,this.tokens.push({type:'OP_LOGIC',value:a,start:e,end:this.position})}tokenizeHash(){const e=this.position;if(this.position++,'['!==this.peek())throw new Error('在 "#" 后面需要 "["');if(this.position++,'{'===this.peek()){this.position++;const t=this.position;for(;this.position<this.input.length&&'}'!==this.peek();)this.position++;const a=this.input.slice(t,this.position);if('}'!==this.peek())throw new Error('未闭合的函数名');this.position++,this.tokens.push({type:'FUNC_START',value:a,start:e,end:this.position})}else{const t=this.position;for(;this.position<this.input.length&&']'!==this.peek();)this.position++;const a=this.input.slice(t,this.position);if(']'!==this.peek())throw new Error('未闭合的操作符');this.position++,this.tokens.push({type:'OP_MATH',value:a,start:e,end:this.position})}}addToken(e,t){this.tokens.push({type:e,value:t,start:this.position,end:this.position+t.length}),this.position+=t.length}peek(){return this.position<this.input.length?this.input[this.position]:'\0'}isWhitespace(e){return/\s/.test(e)}}function n(e){const t=e.match(/^\{(\w+)\}(.*)$/s);if(!t){const t=parseFloat(e);return isNaN(t)?{type:'string',value:e}:{type:'number',value:t}}const[,a,o]=t;switch(a){case'num':return{type:'number',value:parseFloat(o)};case'str':default:return{type:'string',value:o};case'bool':return{type:'boolean',value:'true'===o};case'null':return{type:'null',value:null}}}class r{tokens;position=0;constructor(e){this.tokens=e.tokenize()}parse(){if(0===this.tokens.length||'EOF'===this.tokens[0].type)throw new Error('表达式为空');const e=this.parseExpression();if(!this.isAtEnd()){const e=this.peek();throw new Error(`表达式后面有意外的标记: ${e.type} ('${e.value}') 位于位置 ${e.start}`)}return e}parseExpression(){return this.parseAssignment()}parseAssignment(){let e=this.parseLogicalOr();if(this.match('OP_MATH','=')){const t=this.previous().value,a=this.parseAssignment();if('Identifier'!==e.type&&'TempVariable'!==e.type)throw new Error(`无效的赋值目标: ${e.type}。必须是一个路径或临时变量。`);e={type:'BinaryOp',operator:t,left:e,right:a}}return e}parseLogicalOr(){let e=this.parseLogicalAnd();for(;this.match('OP_LOGIC','||');){e={type:'BinaryOp',operator:this.previous().value,left:e,right:this.parseLogicalAnd()}}return e}parseLogicalAnd(){let e=this.parseComparison();for(;this.match('OP_LOGIC','&&');){e={type:'BinaryOp',operator:this.previous().value,left:e,right:this.parseComparison()}}return e}parseComparison(){let e=this.parseAdditive();for(;this.matchOp(['==','!=','<','>','<=','>=']);){e={type:'BinaryOp',operator:this.previous().value,left:e,right:this.parseAdditive()}}return e}parseAdditive(){let e=this.parseMultiplicative();for(;this.matchOp(['+','-'],'OP_MATH');){e={type:'BinaryOp',operator:this.previous().value,left:e,right:this.parseMultiplicative()}}return e}parseMultiplicative(){let e=this.parsePower();for(;this.matchOp(['*','/','%'],'OP_MATH');){e={type:'BinaryOp',operator:this.previous().value,left:e,right:this.parsePower()}}return e}parsePower(){let e=this.parsePrimary();if(this.matchOp(['**'],'OP_MATH')){e={type:'BinaryOp',operator:this.previous().value,left:e,right:this.parsePower()}}return e}parsePrimary(){if(this.match('LPAREN')){const e=this.parseExpression();return this.consume('RPAREN','表达式后面需要 ")"'),e}if(this.match('IDENTIFIER'))return{type:'Identifier',path:this.previous().value};if(this.match('TEMP_VARIABLE')){const e=this.previous().value,t=e.match(/^\{(g|s)\}(.+)$/);if(!t)throw new Error(`解析器内部错误: 无效的临时变量格式 ${e}`);const[,a,o]=t;return{type:'TempVariable',scope:a,name:o}}if(this.match('LITERAL'))return{type:'Literal',value:n(this.previous().value)};if(this.match('FUNC_START')){const e=this.previous().value,t=[];for(;!this.check('RBRACKET')&&!this.isAtEnd();)t.push(this.parsePrimary());return this.consume('RBRACKET',`函数参数 ${e} 后面需要 "]"`),{type:'FunctionCall',name:e,args:t}}throw new Error(`意外的标记: ${this.peek().type} (${this.peek().value}) 位于 ${this.peek().start}`)}match(e,t){return!!this.check(e,t)&&(this.advance(),!0)}matchOp(e,t){if(this.isAtEnd())return!1;const a=this.peek();return!(!(t?a.type===t:'OP_LOGIC'===a.type||'OP_MATH'===a.type)||!e.includes(a.value))&&(this.advance(),!0)}consume(e,t){if(this.check(e))return this.advance();const a=this.peek();throw new Error(`${t} (位于位置 ${a.start})`)}check(e,t){if(this.isAtEnd())return!1;const a=this.peek();return a.type===e&&(void 0===t||a.value===t)}advance(){return this.isAtEnd()||this.position++,this.previous()}isAtEnd(){return'EOF'===this.peek().type}peek(){return this.tokens[this.position]}previous(){return this.tokens[this.position-1]}}var l=a(5241);class i{data;globalVars;localVars;constructor(e,t,a){this.data=e,this.globalVars=t,this.localVars=a}evaluate(e){switch(e.type){case'BinaryOp':return this.evaluateBinaryOp(e);case'FunctionCall':return this.evaluateFunctionCall(e);case'Identifier':return this.evaluateIdentifier(e);case'Literal':return e.value.value;case'TempVariable':return this.evaluateTempVariable(e);default:throw new Error(`未知的节点类型: ${e.type}`)}}evaluateBinaryOp(e){if('='===e.operator)return this.performAssignment(e.left,e.right);const t=this.evaluate(e.left),a=this.evaluate(e.right),o=['+','-','*','/','%','**'].includes(e.operator),n=['<','>','<=','>='].includes(e.operator);if(o&&('number'!=typeof t||'number'!=typeof a)){const o=JSON.stringify(t),n=JSON.stringify(a);throw new Error(`算术运算符 '${e.operator}' 类型不匹配。两个操作数都必须是数字，但得到了 ${typeof t} (${o}) 和 ${typeof a} (${n})。`)}if(n){const o=typeof t,n=typeof a;if(o!==n){const r=JSON.stringify(t),l=JSON.stringify(a);throw new Error(`比较运算符 '${e.operator}' 类型不匹配。操作数必须是相同类型，但得到了 ${o} (${r}) 和 ${n} (${l})。`)}if('object'===o&&null!==t)throw new Error(`不能在对象上使用运算符 '${e.operator}'。`)}switch(e.operator){case'&&':return t&&a;case'||':return t||a;case'==':return t==a;case'!=':return t!=a;case'<':return t<a;case'>':return t>a;case'<=':return t<=a;case'>=':return t>=a;case'+':return t+a;case'-':return t-a;case'*':return t*a;case'/':return t/a;case'%':return t%a;case'**':return Math.pow(t,a);default:throw new Error(`未知的运算符: ${e.operator}`)}}performAssignment(e,t){const a=this.evaluate(t);if('TempVariable'===e.type){('g'===e.scope?this.globalVars:this.localVars).set(e.name,a)}return a}evaluateTempVariable(e){const t='g'===e.scope?this.globalVars:this.localVars;if(!t.has(e.name))throw new Error(`临时变量 '@[${e.scope}]${e.name}' 尚未定义。`);return t.get(e.name)}evaluateFunctionCall(e){const t=e.args.map(e=>this.evaluate(e));switch(e.name){case'neg':return-Number(t[0]);case'sum':return t.reduce((e,t)=>e+Number(t),0);case'avg':return 0===t.length?0:t.reduce((e,t)=>e+Number(t),0)/t.length;case'ln':return Math.log(Number(t[0]));case'log2':return Math.log2(Number(t[0]));case'sqrt':return Math.sqrt(Number(t[0]));case'abs':return Math.abs(Number(t[0]));case'floor':return Math.floor(Number(t[0]));case'ceil':return Math.ceil(Number(t[0]));case'max':return Math.max(...t.map(Number));case'min':return Math.min(...t.map(Number));default:throw new Error(`未知的函数: ${e.name}`)}}evaluateIdentifier(e){const t=e.path.split('.'),a=(0,l.Em)(this.data,t);if(void 0===a)throw new Error(`路径 '${e.path}' 不存在或其值未定义。`);return a}}var s=a(8840);class d{static process(e){if(!e)return'';let t='',a=0;const o=e.length;for(;a<o;){const n=e[a];if('&'===n){let n=a+1;for(;n<o&&/\s/.test(e[n]);)n++;if(n<o&&'['===e[n]){for(t+='&[',a=n+1;a<o;){const o=e[a];if(t+=o,a++,']'===o)break}continue}}/\s/.test(n)||(t+=n),a++}return t}}class c{static astCache=new Map;static MAX_CACHE_SIZE=1e4;static evaluate(e,t,a,n){try{const l=d.process(e),c=new s.G(t).expand(l),p=[];for(const e of c){let l;if(this.astCache.has(e))l=this.astCache.get(e);else{const t=new o(e);if(l=new r(t).parse(),this.astCache.size>=this.MAX_CACHE_SIZE){const e=this.astCache.keys().next().value;e&&this.astCache.delete(e)}this.astCache.set(e,l)}const s=new i(t,a,n).evaluate(l);let d,c;'BinaryOp'===l.type&&'='===l.operator&&('Identifier'===l.left.type?(d=l.left.path,c='data'):'TempVariable'===l.left.type&&(d=`@(${l.left.scope})${l.left.name}`,c='temp')),p.push({path:d,targetType:c,value:s})}return{success:!0,value:p}}catch(e){return{success:!1,error:e.message||'DSL执行过程中发生未知错误'}}}static clearCache(){this.astCache.clear()}}const p={'||':1,'&&':2,'==':3,'!=':3,'<':3,'>':3,'<=':3,'>=':3,'+':4,'-':4,'*':5,'/':5,'%':5,'**':6,neg:7,ln:7,log2:7,sqrt:7,abs:7,floor:7,ceil:7,sum:7,avg:7,max:7,min:7},u=(e,t=0)=>{switch(e.type){case'Identifier':return`$${e.path}`;case'TempVariable':return`@(${e.scope})${e.name}`;case'Literal':return'string'===e.value.type?`"${e.value.value}"`:String(e.value.value);case'FunctionCall':{const t=e.args.map(e=>u(e,0)).join(', ');return`${e.name.replace(/[{}]/g,'')}(${t})`}case'BinaryOp':{const a=p[e.operator]||0,o=u(e.left,a),n=u(e.right,a),r=`${o} ${e.operator} ${n}`;return a<t?`(${r})`:r}}},f={execute:(e,t,a,o)=>c.evaluate(e,t,a,o),validate(e){try{const t=d.process(e),a=new o(t);return new r(a).parse(),{success:!0}}catch(e){return{success:!1,error:e.message}}},getValue(e,t){const a=(0,l.Rr)(t);return(0,l.Em)(e,a)},setValue(e,t,a){const o=(0,l.Rr)(t);(0,l.Wp)(e,o,a)},exprToHumanView:e=>(e=>{if(!e)return'';try{const t=d.process(e),a=new o(t),n=new r(a).parse();return u(n)}catch(e){return`[无效表达式: ${e.message}]`}})(e),clearCache(){c.clearCache()}}},3035:(t,a,o)=>{t.exports=(e=>{var t={};return o.d(t,e),t})({createPinia:()=>e.createPinia,defineStore:()=>e.defineStore,storeToRefs:()=>e.storeToRefs})},3786:(e,t,a)=>{var o=a(8726);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('1cda50f0',o,!1,{ssrId:!0})},3840:(e,t,a)=>{a.d(t,{A:()=>i});var o=a(4061);const n={class:'search-box'},r=['value'],l=(0,o.defineComponent)({__name:'PathSearch',props:{modelValue:{}},emits:['update:modelValue'],setup:e=>(t,a)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',n,[a[2]||(a[2]=(0,o.createElementVNode)('svg',{class:'search-icon',viewBox:'0 0 16 16',fill:'currentColor'},[(0,o.createElementVNode)('path',{d:'M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z'})],-1)),(0,o.createElementVNode)('input',{value:e.modelValue,type:'text',placeholder:'搜索路径或值...',class:'search-input',onInput:a[0]||(a[0]=e=>t.$emit('update:modelValue',e.target.value))},null,40,r),e.modelValue?((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:0,class:'search-clear',onClick:a[1]||(a[1]=e=>t.$emit('update:modelValue',''))},' × ')):(0,o.createCommentVNode)('v-if',!0)]))});a(7691);const i=(0,a(1400).A)(l,[['__scopeId','data-v-5fdcabb6']])},4061:e=>{e.exports=Vue},4167:(e,t,a)=>{a.d(t,{X:()=>n});const o=async()=>{const{primary:e}=getCharWorldbookNames('current');if(!e)throw new Error('未能找到当前角色的世界书。');return e},n={getCurrentCharWorldBookPrimary:o,getWorldBookContent:async e=>{const t=await o(),a=await getWorldbook(t);let n='';return a.filter(t=>e.includes(t.name)).sort((e,t)=>e.position.order-t.position.order).forEach(e=>{n+=e.content}),n},getAllWorldBookNames:async()=>{const e=await o();return(await getWorldbook(e)).map(e=>e.name)},filterWorldBookNamesRegex:(e,t)=>t.filter(t=>e.test(t)),enabledEntry:async e=>{const t=await o(),a=await getWorldbook(t);return!e.find(e=>!a.some(t=>t.name===e.name))&&(await updateWorldbookWith(t,t=>t.map(t=>{const a=e.find(e=>e.name===t.name);return a?{...t,enabled:a.enabled}:t})),!0)},removeLoresByRegex:async(e,t,a)=>{console.info('removeLoresByRegex: ','开始过滤',t,a);const o=e=>_.remove(e,e=>a?!e.comment.match(t):e.comment.match(t));o(e.globalLore),o(e.characterLore),o(e.chatLore),o(e.personaLore),console.log('removeLoresByRegex过滤完成: ',e)},removeLoresByArray:async(e,t,a)=>{console.info('removeLoresByArray: ','开始过滤',t,a);const o=e=>_.remove(e,e=>a?!t.includes(e.comment):t.includes(e.comment));o(e.globalLore),o(e.characterLore),o(e.chatLore),o(e.personaLore),console.log('removeLoresByArray过滤完成: ',e)}}},4203:(e,t,a)=>{a.d(t,{default:()=>ue}),a.r(t);var o=a(4061),n=a(7664);const r=_;var l=a(6340),i=a(4544),s=a(3840),d=a(9761);const c={key:1,class:'space'},p={key:2,class:'editor-container'},u={key:3,class:'null-value'},f={key:1,class:'preview'},b={key:4,class:'actions'},m={key:0,class:'children-container'},v=(0,o.defineComponent)({__name:'JsonNodeEdit',props:{node:{},editingNodePath:{}},emits:['toggleExpand','startEdit','cancelEdit','saveEdit','addChild','removeNode'],setup(e,{emit:t}){const a=e,n=t,r=(0,o.ref)(null),l=(0,o.computed)(()=>a.node.path===a.editingNodePath),i=(0,o.ref)('string'),s=(0,o.ref)(''),d=(0,o.computed)(()=>{const e=a.node.value;return'string'==typeof e?`"${e}"`:String(e)}),v=(0,o.computed)(()=>{const e=a.node.value;return null===e?'type-null':'type-'+typeof e});function h(){a.node.isLeaf&&(i.value=function(e){if(null===e)return'null';const t=typeof e;return['string','number','boolean'].includes(t)?t:'string'}(a.node.value),s.value=a.node.value,n('startEdit',a.node.path))}function g(){h()}function x(){n('cancelEdit')}function y(){let e=s.value;'boolean'===i.value?e=Boolean(s.value):'null'===i.value&&(e=null),n('saveEdit',{path:a.node.path,value:e})}return(0,o.watch)(l,e=>{e&&(0,o.nextTick)(()=>{r.value?.focus(),r.value?.select()})}),(t,a)=>{const k=(0,o.resolveComponent)('JsonNodeEdit',!0);return(0,o.openBlock)(),(0,o.createElementBlock)('div',{class:'json-node',style:(0,o.normalizeStyle)({marginLeft:20*e.node.depth+'px'})},[(0,o.createElementVNode)('div',{class:(0,o.normalizeClass)(['line',{'is-editing':l.value}])},[(0,o.createCommentVNode)(' 折叠/展开箭头 '),e.node.isLeaf?((0,o.openBlock)(),(0,o.createElementBlock)('span',c)):((0,o.openBlock)(),(0,o.createElementBlock)('span',{key:0,class:(0,o.normalizeClass)(['arrow',{expanded:e.node.expanded}]),onClick:a[0]||(a[0]=t=>n('toggleExpand',e.node))},' ▶ ',2)),(0,o.createCommentVNode)(' Key '),(0,o.createElementVNode)('span',{class:'key',onDblclick:g},(0,o.toDisplayString)(e.node.key)+':',33),(0,o.createCommentVNode)(' 编辑器 '),l.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',p,[(0,o.withDirectives)((0,o.createElementVNode)('select',{'onUpdate:modelValue':a[1]||(a[1]=e=>i.value=e),class:'edit-select'},[...a[13]||(a[13]=[(0,o.createElementVNode)('option',{value:'string'},'String',-1),(0,o.createElementVNode)('option',{value:'number'},'Number',-1),(0,o.createElementVNode)('option',{value:'boolean'},'Boolean',-1),(0,o.createElementVNode)('option',{value:'null'},'Null',-1)])],512),[[o.vModelSelect,i.value]]),'string'===i.value?(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createElementBlock)('input',{key:0,ref_key:'inputRef',ref:r,'onUpdate:modelValue':a[2]||(a[2]=e=>s.value=e),type:'text',class:'edit-input',onKeydown:[(0,o.withKeys)(y,['enter']),(0,o.withKeys)(x,['esc'])]},null,544)),[[o.vModelText,s.value]]):'number'===i.value?(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createElementBlock)('input',{key:1,ref_key:'inputRef',ref:r,'onUpdate:modelValue':a[3]||(a[3]=e=>s.value=e),type:'number',class:'edit-input',onKeydown:[(0,o.withKeys)(y,['enter']),(0,o.withKeys)(x,['esc'])]},null,544)),[[o.vModelText,s.value,void 0,{number:!0}]]):'boolean'===i.value?(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createElementBlock)('select',{key:2,ref_key:'inputRef',ref:r,'onUpdate:modelValue':a[4]||(a[4]=e=>s.value=e),class:'edit-input',onKeydown:[(0,o.withKeys)(y,['enter']),(0,o.withKeys)(x,['esc'])]},[...a[14]||(a[14]=[(0,o.createElementVNode)('option',{value:!0},'true',-1),(0,o.createElementVNode)('option',{value:!1},'false',-1)])],544)),[[o.vModelSelect,s.value]]):((0,o.openBlock)(),(0,o.createElementBlock)('span',u,'null')),(0,o.createElementVNode)('button',{class:'btn-action save',title:'保存',onClick:y},'✓'),(0,o.createElementVNode)('button',{class:'btn-action cancel',title:'取消',onClick:x},'✗')])):((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:3},[(0,o.createCommentVNode)(' 值 / 折叠预览 '),e.node.isLeaf?((0,o.openBlock)(),(0,o.createElementBlock)('span',{key:0,class:(0,o.normalizeClass)(['value',v.value]),onDblclick:g},(0,o.toDisplayString)(d.value),35)):e.node.expanded?(0,o.createCommentVNode)('v-if',!0):((0,o.openBlock)(),(0,o.createElementBlock)('span',f,(0,o.toDisplayString)(Array.isArray(e.node.value)?'[...]':'{...}'),1))],64)),(0,o.createCommentVNode)(' 操作按钮 (Flexbox布局) '),l.value?(0,o.createCommentVNode)('v-if',!0):((0,o.openBlock)(),(0,o.createElementBlock)('div',b,[e.node.isLeaf?(0,o.createCommentVNode)('v-if',!0):((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:0,class:'btn-action',title:'添加子节点',onClick:a[5]||(a[5]=t=>n('addChild',{path:e.node.path,isObject:!Array.isArray(e.node.value)}))},'+')),(0,o.createElementVNode)('button',{class:'btn-action',title:'编辑值',onClick:h},'✎'),(0,o.createElementVNode)('button',{class:'btn-action danger',title:'删除节点',onClick:a[6]||(a[6]=t=>n('removeNode',e.node.path))},'🗑')]))],2),(0,o.createCommentVNode)(' 子节点 '),e.node.expanded&&e.node.children?((0,o.openBlock)(),(0,o.createElementBlock)('div',m,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(e.node.children,t=>((0,o.openBlock)(),(0,o.createBlock)(k,{key:t.path,node:t,'editing-node-path':e.editingNodePath,onToggleExpand:a[7]||(a[7]=e=>n('toggleExpand',e)),onStartEdit:a[8]||(a[8]=e=>n('startEdit',e)),onCancelEdit:a[9]||(a[9]=e=>n('cancelEdit')),onSaveEdit:a[10]||(a[10]=e=>n('saveEdit',e)),onAddChild:a[11]||(a[11]=e=>n('addChild',e)),onRemoveNode:a[12]||(a[12]=e=>n('removeNode',e))},null,8,['node','editing-node-path']))),128))])):(0,o.createCommentVNode)('v-if',!0)],4)}}});a(5697);var h=a(1400);const g=(0,h.A)(v,[['__scopeId','data-v-e6d9f3e8']]),x={class:'json-tree'},y={key:0,class:'empty-tree'},k=(0,o.defineComponent)({__name:'JsonTreeEdit',props:{data:{},searchQuery:{}},emits:['update:data'],setup(e,{emit:t}){const a=e,n=t,l=(0,o.ref)([]),i=(0,o.ref)(null);function s(e){const t=new Set;for(const a of e)a.expanded&&(t.add(a.path),a.children&&s(a.children).forEach(e=>t.add(e)));return t}function d(e,t){for(const a of e)t.has(a.path)&&(a.expanded=!0),a.children&&d(a.children,t)}function c(e,t=0,a=''){return null===e||'object'!=typeof e?[]:Object.keys(e).map(n=>{const r=e[n],l=a?Array.isArray(e)?`${a}[${n}]`:`${a}.${n}`:n,i=null===r||'object'!=typeof r;return(0,o.reactive)({key:n,value:r,depth:t,path:l,isLeaf:i,expanded:!1,children:i?void 0:c(r,t+1,l)})})}(0,o.watch)(()=>a.data,(e,t)=>{const a=s(l.value);l.value=c(e),d(l.value,a)},{immediate:!0});const p=(0,o.computed)(()=>{const e=(a.searchQuery||'').trim().toLowerCase();if(!e)return l.value;return function t(a){const o=[];for(const n of a){const a=String(n.key).toLowerCase().includes(e),r=n.isLeaf&&String(n.value).toLowerCase().includes(e),l=n.children?t(n.children):[];(a||r||l.length>0)&&(n.expanded=l.length>0,n.children=l,o.push(n))}return o}((0,r.cloneDeep)(l.value))});function u(e,t){for(const a of e){if(a.path===t)return a;if(t.startsWith(a.path)&&a.children){const e=u(a.children,t);if(e)return e}}return null}function f(e){const t=u(l.value,e.path);t&&(t.expanded=!t.expanded)}function b(e){i.value=e}function m(){i.value=null}function v({path:e,value:t}){const o=(0,r.cloneDeep)(a.data);(0,r.set)(o,e,t),n('update:data',o),i.value=null}function h({path:e,isObject:t}){const o=(0,r.cloneDeep)(a.data),s=(0,r.get)(o,e);if(void 0===s||'object'!=typeof s)return void console.warn(`Cannot add child to non-object path: ${e}`);const d=t?'newKey':s.length,c=t?`${e}.newKey`:`${e}[${d}]`;(0,r.set)(o,c,'newValue'),n('update:data',o);const p=u(l.value,e);p&&(p.expanded=!0),setTimeout(()=>{i.value=c},100)}function k(e){const t=(0,r.cloneDeep)(a.data);(0,r.unset)(t,e);const o=e.substring(0,e.lastIndexOf('.'))||e.substring(0,e.lastIndexOf('['));if(o){const e=(0,r.get)(t,o);if(Array.isArray(e)){const a=e.filter(e=>null!=e);(0,r.set)(t,o,a)}}n('update:data',t)}return(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',x,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(p.value,e=>((0,o.openBlock)(),(0,o.createBlock)(g,{key:e.path,node:e,'editing-node-path':i.value,onToggleExpand:f,onStartEdit:b,onCancelEdit:m,onSaveEdit:v,onAddChild:h,onRemoveNode:k},null,8,['node','editing-node-path']))),128)),0===p.value.length&&l.value.length>0?((0,o.openBlock)(),(0,o.createElementBlock)('div',y,' 没有匹配的搜索结果。 ')):(0,o.createCommentVNode)('v-if',!0)]))}});a(7389);const w=(0,h.A)(k,[['__scopeId','data-v-4a5d571c']]),E={class:'stat-data-editor'},N={class:'editor-toolbar'},V={class:'toolbar-left'},C=['disabled'],S=['disabled'],B={class:'toolbar-right'},j={key:0,class:'change-indicator'},A={class:'data-container'},D={key:0,class:'loading-container'},O={key:1,class:'empty-container'},T={key:2,class:'json-editor-wrapper'},M={class:'edit-tools'},L={class:'mode-buttons'},I=['disabled'],R=['disabled'],U={key:0,class:'tree-editor'},J={class:'raw-editor'},P={class:'editor-header'},F={class:'editor-size'},H={key:0,class:'json-error'},W={key:0,class:'modal-overlay'},K={class:'modal'},G={class:'modal-body'},Y={class:'form-group'},q={class:'form-group'},X={key:0,class:'form-group'},Z={class:'form-group'},Q={class:'form-group'},ee={class:'boolean-options'},te={class:'boolean-option'},ae={class:'boolean-option'},oe={class:'form-group'},ne={class:'json-editor-container'},re={class:'json-editor-header'},le=['placeholder'],ie={key:0,class:'json-error'},se={key:1,class:'json-success'},de={class:'modal-actions'},ce=['disabled'],pe=(0,o.defineComponent)({__name:'EraDataEditor',setup(e){const t=(0,n.l)(),a=(0,o.ref)(!1),c=(0,o.ref)(!1),p=(0,o.ref)(null),u=(0,o.ref)(null),f=(0,o.ref)(''),b=(0,o.ref)('tree'),m=(0,o.ref)(''),v=(0,o.ref)(''),h=(0,o.ref)(null);function g(){if(v.value)alert('JSON格式无效，无法切换到树形视图。请先修正错误。');else try{p.value=JSON.parse(m.value||'{}'),b.value='tree'}catch(e){v.value=e.message,alert('JSON格式无效，无法切换到树形视图。请先修正错误。')}}function x(){try{JSON.parse(m.value),v.value=''}catch(e){v.value=e.message}}(0,o.watch)(b,(e,t)=>{if('raw'===e)try{m.value=JSON.stringify(p.value,null,2),v.value=''}catch(e){m.value='无法序列化当前数据。',v.value=e instanceof Error?e.message:String(e)}});const y=(0,o.ref)('就绪'),k=(0,o.ref)(!1),pe=(0,o.ref)(''),ue=(0,o.ref)(''),fe=(0,o.ref)('confirm'),be=(0,o.ref)(()=>{});function me(e,t,a='confirm',o){pe.value=e,ue.value=t,fe.value=a,k.value=!0,be.value=o||(()=>{})}function ve(){be.value(),be.value=()=>{}}function he(){be.value=()=>{}}function ge(e){try{p.value=JSON.parse(e),y.value='成功导入数据'}catch(e){d.j.error('导入数据失败:',e),y.value='导入失败，请检查文件格式',alert(`导入失败：${e instanceof Error?e.message:'未知错误'}`)}}const xe=(0,o.computed)(()=>{if('raw'===b.value){if(v.value)return!0;try{return m.value!==JSON.stringify(u.value,null,2)}catch{return!0}}try{return JSON.stringify(p.value)!==JSON.stringify(u.value)}catch{return!1}});function ye(){if(p.value)try{const e=`era-stat-data-${(new Date).toISOString().replace(/[:.]/g,'-').replace('T','_').slice(0,-5)}.json`,t=JSON.stringify(p.value,null,2),a=new Blob([t],{type:'application/json'}),o=URL.createObjectURL(a),n=document.createElement('a');n.href=o,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o),y.value='草稿导出成功'}catch(e){d.j.error('导出草稿失败:',e),y.value='导出草稿失败'}}async function ke(){try{a.value=!0,y.value='正在加载数据...';const e=await t.getStatData();p.value=e,u.value=(0,r.cloneDeep)(e),y.value='数据已加载'}catch(e){d.j.error('加载数据失败:',e),y.value='加载失败',p.value=null}finally{a.value=!1}}async function we(){if(xe.value)return'raw'===b.value&&v.value?(y.value='JSON格式错误，无法保存',void alert('JSON格式错误，请修正后再保存！')):void me('保存确认','是否保存所有更改？','confirm',async()=>{try{c.value=!0,y.value='正在保存...';const e='raw'===b.value?JSON.parse(m.value):p.value;await t.saveEraEdit(e),u.value=(0,r.cloneDeep)(e),p.value=e,y.value='保存成功',setTimeout(()=>{y.value='就绪'},3e3)}catch(e){d.j.error('保存失败:',e),y.value='保存失败'}finally{c.value=!1}});me('提示','没有需要保存的更改','alert')}function Ee(){if('raw'===b.value&&!v.value)try{const e=JSON.parse(m.value);m.value=JSON.stringify(e,null,2)}catch(e){d.j.error('格式化JSON失败:',e)}}const Ne=(0,o.ref)(!1),Ve=(0,o.ref)(''),Ce=(0,o.ref)(!1),Se=(0,o.ref)({path:'',type:'string',value:'',jsonValue:''}),Be=(0,o.computed)(()=>{const{path:e,type:t}=Se.value;if(!e.trim())return!1;switch(t){case'string':return'string'==typeof Se.value.value;case'number':return'number'==typeof Se.value.value||''!==String(Se.value.value).trim();case'boolean':return'boolean'==typeof Se.value.value;case'null':return!0;case'object':case'array':return Ce.value&&''!==Se.value.jsonValue.trim();default:return!1}});function je(){switch(Se.value.type){case'string':Se.value.value='';break;case'number':Se.value.value=0;break;case'boolean':Se.value.value=!0;break;case'null':Se.value.value=null;break;case'object':Se.value.jsonValue='{}',_e();break;case'array':Se.value.jsonValue='[]',_e()}}function _e(){const e=Se.value.jsonValue.trim();if(!e)return Ve.value='',void(Ce.value=!1);try{const t=JSON.parse(e);'object'!==Se.value.type||'object'==typeof t&&!Array.isArray(t)&&null!==t?'array'!==Se.value.type||Array.isArray(t)?(Ve.value='',Ce.value=!0):(Ve.value='必须是有效的JSON数组',Ce.value=!1):(Ve.value='必须是有效的JSON对象',Ce.value=!1)}catch(e){Ve.value=e instanceof Error?e.message:'无效的JSON格式',Ce.value=!1}}function Ae(){if(Ce.value)try{const e=JSON.parse(Se.value.jsonValue);Se.value.jsonValue=JSON.stringify(e,null,2)}catch(e){Ve.value=e instanceof Error?e.message:'无效的JSON格式'}}function ze(){Se.value={path:'',type:'string',value:'',jsonValue:''},Ve.value='',Ce.value=!1,Ne.value=!0}function De(){Ne.value=!1}function Oe(){if(Be.value)try{let e;switch(Se.value.type){case'string':case'boolean':e=Se.value.value;break;case'number':if(e=Number(Se.value.value),isNaN(e))return void alert('请输入有效的数字');break;case'null':e=null;break;case'object':case'array':e=JSON.parse(Se.value.jsonValue)}(0,r.set)(p.value,Se.value.path,e),y.value='已添加新字段',Ne.value=!1}catch(e){d.j.error('添加字段失败:',e),alert(`添加字段失败：${e instanceof Error?e.message:'未知错误'}`)}else alert('请输入有效的字段路径和值')}return(0,o.onMounted)(()=>{ke()}),(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',E,[(0,o.createCommentVNode)(' 顶部工具栏 '),(0,o.createElementVNode)('div',N,[(0,o.createElementVNode)('div',V,[(0,o.createElementVNode)('button',{class:'toolbar-btn',disabled:a.value,onClick:ke},[...t[12]||(t[12]=[(0,o.createElementVNode)('svg',{class:'icon',viewBox:'0 0 16 16',fill:'currentColor'},[(0,o.createElementVNode)('path',{d:'M13.5 8C13.5 11.0376 11.0376 13.5 8 13.5C4.96243 13.5 2.5 11.0376 2.5 8C2.5 4.96243 4.96243 2.5 8 2.5C9.37676 2.5 10.6396 3.01285 11.596 3.85652L12.5 2.5H14V6H10.5V4.5H11.7906C11.0431 3.53528 9.8382 3 8.5 3C6.01472 3 4 5.01472 4 7.5C4 9.98528 6.01472 12 8.5 12C10.9853 12 13 9.98528 13 7.5H14.5C14.5 11.0376 11.0376 14.5 8 14.5C4.96243 14.5 2.5 12.0376 2.5 9C2.5 5.96243 4.96243 3.5 8 3.5C9.4619 3.5 10.7872 4.11611 11.7227 5.12644L12.5 6H14V2.5H12.5L11.596 3.85652Z'})],-1),(0,o.createTextVNode)(' 刷新数据 ',-1)])],8,C),(0,o.createElementVNode)('button',{class:'toolbar-btn',disabled:c.value||!xe.value,onClick:we},[...t[13]||(t[13]=[(0,o.createElementVNode)('svg',{class:'icon',viewBox:'0 0 16 16',fill:'currentColor'},[(0,o.createElementVNode)('path',{d:'M13.3536 2.64645C13.5488 2.84171 13.5488 3.15829 13.3536 3.35355L6.35355 10.3536C6.15829 10.5488 5.84171 10.5488 5.64645 10.3536L3.64645 8.35355C3.45118 8.15829 3.45118 7.84171 3.64645 7.64645C3.84171 7.45118 4.15829 7.45118 4.35355 7.64645L6 9.29289L12.6464 2.64645C12.8417 2.45118 13.1583 2.45118 13.3536 2.64645Z'})],-1),(0,o.createTextVNode)(' 保存更改 ',-1)])],8,S),(0,o.createCommentVNode)(' 使用 FileImportExport 组件替换原来的导入/导出按钮 '),(0,o.createVNode)(i.A,{ref_key:'fileImportExportRef',ref:h,'import-text':'导入JSON','export-text':'导出草稿','require-confirm':!0,onImportConfirmed:ge,onExportData:ye},null,512)]),(0,o.createElementVNode)('div',B,[xe.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',j,[...t[14]||(t[14]=[(0,o.createElementVNode)('span',{class:'dot'},null,-1),(0,o.createTextVNode)(' 有未保存的更改 ',-1)])])):(0,o.createCommentVNode)('v-if',!0),(0,o.createElementVNode)('div',{class:(0,o.normalizeClass)(['status-text',{'status-loading':a.value}])},(0,o.toDisplayString)(y.value),3)])]),(0,o.createCommentVNode)(' 搜索框 '),(0,o.createVNode)(s.A,{modelValue:f.value,'onUpdate:modelValue':t[0]||(t[0]=e=>f.value=e)},null,8,['modelValue']),(0,o.createCommentVNode)(' 数据展示区域 '),(0,o.createElementVNode)('div',A,[a.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',D,[...t[15]||(t[15]=[(0,o.createElementVNode)('div',{class:'spinner'},null,-1),(0,o.createElementVNode)('div',null,'正在加载数据...',-1)])])):p.value&&0!==Object.keys(p.value).length?((0,o.openBlock)(),(0,o.createElementBlock)('div',T,[(0,o.createCommentVNode)(' 工具按钮区 '),(0,o.createElementVNode)('div',M,[(0,o.createElementVNode)('div',L,[(0,o.createElementVNode)('button',{class:(0,o.normalizeClass)(['mode-btn',{active:'tree'===b.value}]),onClick:g},[...t[18]||(t[18]=[(0,o.createElementVNode)('svg',{class:'mode-icon',viewBox:'0 0 16 16',fill:'currentColor'},[(0,o.createElementVNode)('path',{d:'M14 2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2zm0 5a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V7zm0 5a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1v-2z'})],-1),(0,o.createTextVNode)(' 树形视图 ',-1)])],2),(0,o.createElementVNode)('button',{class:'tool-btn',disabled:'tree'!==b.value,onClick:ze},[...t[19]||(t[19]=[(0,o.createElementVNode)('svg',{class:'tool-icon',viewBox:'0 0 16 16',fill:'currentColor'},[(0,o.createElementVNode)('path',{d:'M8 0a1 1 0 0 1 1 1v6h6a1 1 0 0 1 0 2H9v6a1 1 0 0 1-2 0V9H1a1 1 0 0 1 0-2h6V1a1 1 0 0 1 1-1z'})],-1),(0,o.createTextVNode)(' 添加字段 ',-1)])],8,I),(0,o.createElementVNode)('button',{class:(0,o.normalizeClass)(['mode-btn',{active:'raw'===b.value}]),onClick:t[1]||(t[1]=e=>b.value='raw')},[...t[20]||(t[20]=[(0,o.createElementVNode)('svg',{class:'mode-icon',viewBox:'0 0 16 16',fill:'currentColor'},[(0,o.createElementVNode)('path',{d:'M13.5 2h-11C1.67 2 1 2.67 1 3.5v9c0 .83.67 1.5 1.5 1.5h11c.83 0 1.5-.67 1.5-1.5v-9c0-.83-.67-1.5-1.5-1.5zM4 4h8v1H4V4zm0 3h8v1H4V7zm0 3h8v1H4v-1z'})],-1),(0,o.createTextVNode)(' 原始JSON ',-1)])],2),(0,o.createElementVNode)('button',{class:(0,o.normalizeClass)(['tool-btn',{danger:'raw'===b.value}]),disabled:'raw'!==b.value,onClick:Ee},[...t[21]||(t[21]=[(0,o.createElementVNode)('svg',{class:'tool-icon',viewBox:'0 0 16 16',fill:'currentColor'},[(0,o.createElementVNode)('path',{d:'M5 1h6v2H5V1zm0 12h6v2H5v-2zM1 5h2v6H1V5zm12 0h2v6h-2V5z'})],-1),(0,o.createTextVNode)(' 格式化 ',-1)])],10,R)])]),(0,o.createCommentVNode)(' 树形编辑视图 '),'tree'===b.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',U,[(0,o.createCommentVNode)(' 使用重构后的 JsonTree 组件 '),(0,o.createVNode)(w,{data:p.value,'onUpdate:data':t[2]||(t[2]=e=>p.value=e),'search-query':f.value},null,8,['data','search-query'])])):((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:1},[(0,o.createCommentVNode)(' 原始JSON编辑视图 '),(0,o.createElementVNode)('div',J,[(0,o.createElementVNode)('div',P,[t[22]||(t[22]=(0,o.createElementVNode)('span',{class:'editor-info'},'编辑原始JSON数据',-1)),(0,o.createCommentVNode)(' v-model 改为 rawJsonString '),(0,o.createElementVNode)('span',F,'字符数：'+(0,o.toDisplayString)(m.value.length),1)]),(0,o.createCommentVNode)(' v-model 改为 rawJsonString，并添加 @input 事件 '),(0,o.withDirectives)((0,o.createElementVNode)('textarea',{'onUpdate:modelValue':t[3]||(t[3]=e=>m.value=e),class:'json-editor',placeholder:'在此输入或编辑JSON数据...',onInput:x},null,544),[[o.vModelText,m.value]]),(0,o.createCommentVNode)(' jsonParseError 的来源也变了 '),v.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',H,[t[23]||(t[23]=(0,o.createElementVNode)('svg',{class:'error-icon',viewBox:'0 0 16 16',fill:'currentColor'},[(0,o.createElementVNode)('path',{d:'M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0zM7 3h2v7H7V3zm0 9h2v2H7v-2z'})],-1)),(0,o.createTextVNode)(' JSON语法错误：'+(0,o.toDisplayString)(v.value),1)])):(0,o.createCommentVNode)('v-if',!0)])],2112))])):((0,o.openBlock)(),(0,o.createElementBlock)('div',O,[t[16]||(t[16]=(0,o.createElementVNode)('svg',{class:'empty-icon',viewBox:'0 0 24 24',fill:'currentColor'},[(0,o.createElementVNode)('path',{d:'M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z'}),(0,o.createElementVNode)('path',{d:'M7 7h10v2H7zm0 4h10v2H7zm0 4h7v2H7z'})],-1)),t[17]||(t[17]=(0,o.createElementVNode)('div',{class:'empty-text'},'暂无数据',-1)),(0,o.createElementVNode)('button',{class:'empty-btn',onClick:ke},'点击加载数据')]))]),(0,o.createVNode)(l.A,{visible:k.value,'onUpdate:visible':t[4]||(t[4]=e=>k.value=e),title:pe.value,content:ue.value,type:fe.value,onConfirm:ve,onCancel:he},null,8,['visible','title','content','type']),(0,o.createCommentVNode)(' 添加字段模态框 '),Ne.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',W,[(0,o.createElementVNode)('div',K,[t[38]||(t[38]=(0,o.createElementVNode)('h3',null,'添加新字段',-1)),(0,o.createElementVNode)('div',G,[(0,o.createElementVNode)('div',Y,[t[24]||(t[24]=(0,o.createElementVNode)('label',null,'字段路径：',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':t[5]||(t[5]=e=>Se.value.path=e),type:'text',placeholder:'例如：user.info.name',class:'form-input'},null,512),[[o.vModelText,Se.value.path]]),t[25]||(t[25]=(0,o.createElementVNode)('div',{class:'form-hint'},'支持多层路径，用点分隔。如果父路径不存在会自动创建对象。',-1))]),(0,o.createElementVNode)('div',q,[t[27]||(t[27]=(0,o.createElementVNode)('label',null,'值类型：',-1)),(0,o.withDirectives)((0,o.createElementVNode)('select',{'onUpdate:modelValue':t[6]||(t[6]=e=>Se.value.type=e),class:'form-select',onChange:je},[...t[26]||(t[26]=[(0,o.createStaticVNode)('<option value="string" data-v-b68a7220>字符串</option><option value="number" data-v-b68a7220>数字</option><option value="boolean" data-v-b68a7220>布尔值</option><option value="null" data-v-b68a7220>空值 (null)</option><option value="object" data-v-b68a7220>对象 (JSON)</option><option value="array" data-v-b68a7220>数组</option>',6)])],544),[[o.vModelSelect,Se.value.type]])]),(0,o.createCommentVNode)(' 字符串输入 '),'string'===Se.value.type?((0,o.openBlock)(),(0,o.createElementBlock)('div',X,[t[28]||(t[28]=(0,o.createElementVNode)('label',null,'字符串值：',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':t[7]||(t[7]=e=>Se.value.value=e),type:'text',placeholder:'输入字符串值',class:'form-input'},null,512),[[o.vModelText,Se.value.value]])])):'number'===Se.value.type?((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:1},[(0,o.createCommentVNode)(' 数字输入 '),(0,o.createElementVNode)('div',Z,[t[29]||(t[29]=(0,o.createElementVNode)('label',null,'数字值：',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':t[8]||(t[8]=e=>Se.value.value=e),type:'number',placeholder:'输入数字值',class:'form-input',step:'any'},null,512),[[o.vModelText,Se.value.value,void 0,{number:!0}]])])],2112)):'boolean'===Se.value.type?((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:2},[(0,o.createCommentVNode)(' 布尔值选择 '),(0,o.createElementVNode)('div',Q,[t[32]||(t[32]=(0,o.createElementVNode)('label',null,'布尔值：',-1)),(0,o.createElementVNode)('div',ee,[(0,o.createElementVNode)('label',te,[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':t[9]||(t[9]=e=>Se.value.value=e),type:'radio',value:!0},null,512),[[o.vModelRadio,Se.value.value]]),t[30]||(t[30]=(0,o.createElementVNode)('span',null,'true',-1))]),(0,o.createElementVNode)('label',ae,[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':t[10]||(t[10]=e=>Se.value.value=e),type:'radio',value:!1},null,512),[[o.vModelRadio,Se.value.value]]),t[31]||(t[31]=(0,o.createElementVNode)('span',null,'false',-1))])])])],2112)):'null'===Se.value.type?((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:3},[(0,o.createCommentVNode)(' 空值显示 '),t[33]||(t[33]=(0,o.createElementVNode)('div',{class:'form-group'},[(0,o.createElementVNode)('div',{class:'null-info'},[(0,o.createElementVNode)('svg',{class:'null-icon',viewBox:'0 0 16 16',fill:'currentColor'},[(0,o.createElementVNode)('path',{d:'M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zM1.5 8a6.5 6.5 0 1 1 13 0 6.5 6.5 0 0 1-13 0z'})]),(0,o.createElementVNode)('span',null,'该字段将被设置为 null')])],-1))],2112)):'object'===Se.value.type||'array'===Se.value.type?((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:4},[(0,o.createCommentVNode)(' JSON对象/数组编辑器 '),(0,o.createElementVNode)('div',oe,[(0,o.createElementVNode)('label',null,(0,o.toDisplayString)('object'===Se.value.type?'对象值 (JSON)':'数组值')+'：',1),(0,o.createElementVNode)('div',ne,[(0,o.createElementVNode)('div',re,[t[35]||(t[35]=(0,o.createElementVNode)('span',null,'JSON编辑器',-1)),Ce.value?((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:0,class:'btn-small',title:'格式化JSON',onClick:Ae},[...t[34]||(t[34]=[(0,o.createElementVNode)('svg',{class:'format-icon',viewBox:'0 0 16 16',fill:'currentColor'},[(0,o.createElementVNode)('path',{d:'M5 1h6v2H5V1zm0 12h6v2H5v-2zM1 5h2v6H1V5zm12 0h2v6h-2V5z'})],-1)])])):(0,o.createCommentVNode)('v-if',!0)]),(0,o.withDirectives)((0,o.createElementVNode)('textarea',{'onUpdate:modelValue':t[11]||(t[11]=e=>Se.value.jsonValue=e),class:'json-editor-input',placeholder:'object'===Se.value.type?'{\n  "key": "value"\n}':'[\n  "item1", 123\n]',rows:'6',onInput:_e},null,40,le),[[o.vModelText,Se.value.jsonValue]]),Ve.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',ie,[t[36]||(t[36]=(0,o.createElementVNode)('svg',{class:'error-icon',viewBox:'0 0 16 16',fill:'currentColor'},[(0,o.createElementVNode)('path',{d:'M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0zM7 3h2v7H7V3zm0 9h2v2H7v-2z'})],-1)),(0,o.createElementVNode)('span',null,'JSON错误：'+(0,o.toDisplayString)(Ve.value),1)])):Se.value.jsonValue.trim()?((0,o.openBlock)(),(0,o.createElementBlock)('div',se,[...t[37]||(t[37]=[(0,o.createElementVNode)('svg',{class:'success-icon',viewBox:'0 0 16 16',fill:'currentColor'},[(0,o.createElementVNode)('path',{d:'M13.3536 2.64645C13.5488 2.84171 13.5488 3.15829 13.3536 3.35355L6.35355 10.3536C6.15829 10.5488 5.84171 10.5488 5.64645 10.3536L3.64645 8.35355C3.45118 8.15829 3.45118 7.84171 3.64645 7.64645C3.84171 7.45118 4.15829 7.45118 4.35355 7.64645L6 9.29289L12.6464 2.64645C12.8417 2.45118 13.1583 2.45118 13.3536 2.64645Z'})],-1),(0,o.createElementVNode)('span',null,'有效的JSON格式',-1)])])):(0,o.createCommentVNode)('v-if',!0)])])],2112)):(0,o.createCommentVNode)('v-if',!0)]),(0,o.createElementVNode)('div',de,[(0,o.createElementVNode)('button',{class:'btn primary',disabled:!Be.value,onClick:Oe},'添加',8,ce),(0,o.createElementVNode)('button',{class:'btn',onClick:De},'取消')])])])):(0,o.createCommentVNode)('v-if',!0)]))}});a(6104);const ue=(0,h.A)(pe,[['__scopeId','data-v-b68a7220']])},4208:(e,t,a)=>{a.d(t,{default:()=>n}),a.r(t);var o=a(4061);const n=(0,o.defineComponent)({__name:'MyTempTest',setup(e){const t=()=>{};return(e,a)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',null,[(0,o.createElementVNode)('button',{onClick:t},'测试DSL')]))}})},4308:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var o=a(9433),n=a.n(o),r=a(5378),l=a.n(r)()(n());l.push([e.id,'.stat-data-editor[data-v-b68a7220]{display:flex;flex-direction:column;height:100%;background:#fff;border-radius:12px;overflow:hidden}input[data-v-b68a7220],select[data-v-b68a7220],textarea[data-v-b68a7220],option[data-v-b68a7220]{background:#f8fafc !important;color:#1e293b !important;border-color:#e2e8f0 !important}select option[data-v-b68a7220]{background:#f8fafc !important;color:#1e293b !important}input[data-v-b68a7220]:focus,select[data-v-b68a7220]:focus,textarea[data-v-b68a7220]:focus{border-color:#6366f1 !important;box-shadow:0 0 0 3px rgba(99,102,241,.1) !important}input[data-v-b68a7220]:disabled,select[data-v-b68a7220]:disabled,textarea[data-v-b68a7220]:disabled{background:#f1f5f9 !important;color:#94a3b8 !important;cursor:not-allowed}input[data-v-b68a7220]::placeholder,textarea[data-v-b68a7220]::placeholder{color:#94a3b8 !important;opacity:1}.editor-toolbar[data-v-b68a7220]{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:linear-gradient(135deg,#f8fafc 0%,#f1f5f9 100%);border-bottom:1px solid #e2e8f0}.toolbar-left[data-v-b68a7220]{display:flex;gap:8px}.toolbar-btn[data-v-b68a7220]{display:flex;align-items:center;gap:4px;padding:6px 10px;border:none;border-radius:6px;background:#fff;color:#475569;font-size:12px;font-weight:500;cursor:pointer;transition:all .2s ease;box-shadow:0 1px 2px rgba(0,0,0,.1)}.toolbar-btn[data-v-b68a7220]:hover:not(:disabled){background:#f1f5f9;transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,.15)}.toolbar-btn[data-v-b68a7220]:disabled{opacity:.5;cursor:not-allowed}.toolbar-btn .icon[data-v-b68a7220]{width:12px;height:12px}.toolbar-right[data-v-b68a7220]{display:flex;align-items:center;gap:12px}.change-indicator[data-v-b68a7220]{display:flex;align-items:center;gap:6px;padding:4px 8px;background:#fef3c7;border:1px solid #f59e0b;border-radius:6px;font-size:12px;color:#92400e}.change-indicator .dot[data-v-b68a7220]{width:6px;height:6px;background:#f59e0b;border-radius:50%;animation:pulse-b68a7220 2s infinite}@keyframes pulse-b68a7220{0%,100%{opacity:1}50%{opacity:.5}}.status-text[data-v-b68a7220]{font-size:12px;color:#64748b}.status-text.status-loading[data-v-b68a7220]{color:#6366f1}.data-container[data-v-b68a7220]{flex:1;overflow:hidden;position:relative}.loading-container[data-v-b68a7220],.empty-container[data-v-b68a7220]{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;color:#64748b}.loading-container .spinner[data-v-b68a7220]{width:40px;height:40px;border:3px solid #e2e8f0;border-top-color:#6366f1;border-radius:50%;animation:spin-b68a7220 1s linear infinite}@keyframes spin-b68a7220{to{transform:rotate(360deg)}}.empty-container .empty-icon[data-v-b68a7220]{width:64px;height:64px;opacity:.5}.empty-text[data-v-b68a7220]{font-size:14px}.empty-btn[data-v-b68a7220]{padding:8px 16px;background:#6366f1;color:#fff;border:none;border-radius:6px;font-size:14px;cursor:pointer;transition:all .2s ease}.empty-btn[data-v-b68a7220]:hover{background:#4f46e5;transform:translateY(-1px)}.json-editor-wrapper[data-v-b68a7220]{height:100%;display:flex;flex-direction:column;overflow-x:auto}.json-tree[data-v-b68a7220]{padding:16px;min-width:100%}.edit-mode-selector[data-v-b68a7220]{padding:12px 16px;background:#f8fafc;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px}.mode-buttons[data-v-b68a7220]{display:flex;gap:8px}.mode-btn[data-v-b68a7220]{display:flex;align-items:center;gap:4px;padding:4px 8px;border:1px solid #e2e8f0;background:#fff;border-radius:6px;font-size:11px;color:#475569;cursor:pointer;transition:all .2s ease}.mode-btn[data-v-b68a7220]:hover{background:#f1f5f9;border-color:#cbd5e1}.mode-btn.active[data-v-b68a7220]{background:#6366f1;border-color:#6366f1;color:#fff}.mode-btn .mode-icon[data-v-b68a7220]{width:14px;height:14px}.tool-btn[data-v-b68a7220]{display:flex;align-items:center;gap:4px;padding:4px 8px;border:1px solid #e2e8f0;background:#fff;border-radius:6px;font-size:11px;color:#475569;cursor:pointer;transition:all .2s ease}.tool-btn[data-v-b68a7220]:hover:not(:disabled){background:#f1f5f9;border-color:#cbd5e1}.tool-btn[data-v-b68a7220]:disabled{opacity:.5;cursor:not-allowed}.tool-btn.danger[data-v-b68a7220]{color:#dc2626;border-color:#fecaca}.tool-btn.danger[data-v-b68a7220]:hover{background:#fef2f2;border-color:#fca5a5}.tool-btn .tool-icon[data-v-b68a7220]{width:12px;height:12px}.edit-tools[data-v-b68a7220]{display:flex;margin-top:5px;margin-bottom:5px;gap:6px}.tree-editor[data-v-b68a7220]{flex:1;overflow-y:auto;overflow-x:auto;width:100%;padding-top:10px}.tree-editor[data-v-b68a7220]::-webkit-scrollbar{width:8px;height:8px}.tree-editor[data-v-b68a7220]::-webkit-scrollbar-track{background:#f1f5f9}.tree-editor[data-v-b68a7220]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:4px}.tree-editor[data-v-b68a7220]::-webkit-scrollbar-thumb:hover{background:#94a3b8}.json-tree[data-v-b68a7220]{padding:16px;width:100%;min-width:-moz-fit-content;min-width:fit-content}.raw-editor[data-v-b68a7220]{flex:1;display:flex;flex-direction:column;overflow:hidden;background:#f8fafc !important;color:#1e293b !important;min-height:350px}.editor-header[data-v-b68a7220]{padding:12px 16px;background:#f1f5f9 !important;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center;color:#1e293b !important}.editor-info[data-v-b68a7220]{font-size:14px;color:#64748b !important}.editor-size[data-v-b68a7220]{font-size:13px;color:#94a3b8 !important;font-family:monospace}.json-editor[data-v-b68a7220]{flex:1;padding:16px;outline:none;resize:none;font-family:"SF Mono",Monaco,"Cascadia Code",monospace;font-size:14px;line-height:1.5;background:#fff !important;color:#1e293b !important;border:1px solid #e2e8f0 !important;border-radius:6px;margin:16px;box-shadow:inset 0 1px 3px rgba(0,0,0,.1);overflow:auto;white-space:pre;min-width:min-content}.json-editor[data-v-b68a7220]:focus{border-color:#6366f1 !important;box-shadow:0 0 0 3px rgba(99,102,241,.1) !important}.json-editor[data-v-b68a7220]::-webkit-scrollbar{width:8px}.json-editor[data-v-b68a7220]::-webkit-scrollbar-track{background:#f1f5f9}.json-editor[data-v-b68a7220]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:4px}.json-editor[data-v-b68a7220]::-webkit-scrollbar-thumb:hover{background:#94a3b8}.json-editor[data-v-b68a7220]::placeholder{color:#94a3b8 !important}.json-error[data-v-b68a7220]{padding:12px 16px;background:#fef2f2;border-top:1px solid #fecaca;color:#dc2626;font-size:14px;display:flex;align-items:center;gap:8px}.json-error .error-icon[data-v-b68a7220]{width:16px;height:16px;flex-shrink:0}.modal-overlay[data-v-b68a7220]{position:absolute;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000;backdrop-filter:blur(2px)}.modal[data-v-b68a7220]{background:#fff;border-radius:12px;width:90%;max-width:450px;max-height:80vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.3);animation:modalSlideIn-b68a7220 .3s ease}@keyframes modalSlideIn-b68a7220{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}.modal h3[data-v-b68a7220]{margin:0;padding:24px 24px 16px;font-size:18px;font-weight:600;color:#1e293b;border-bottom:1px solid #e2e8f0}.modal-body[data-v-b68a7220]{padding:24px}.form-group[data-v-b68a7220]{margin-bottom:20px}.form-group label[data-v-b68a7220]{display:block;margin-bottom:6px;font-size:14px;font-weight:500;color:#475569}.form-input[data-v-b68a7220],.form-select[data-v-b68a7220],.form-textarea[data-v-b68a7220]{width:100%;padding:10px 12px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;color:#1e293b !important;background:#f8fafc !important;transition:all .2s ease}.form-input[data-v-b68a7220]:focus,.form-select[data-v-b68a7220]:focus,.form-textarea[data-v-b68a7220]:focus{outline:none;border-color:#6366f1;box-shadow:0 0 0 3px rgba(99,102,241,.1)}.form-input[data-v-b68a7220]::placeholder,.form-select[data-v-b68a7220]::placeholder,.form-textarea[data-v-b68a7220]::placeholder{color:#94a3b8 !important}.form-select option[data-v-b68a7220]{background:#f8fafc !important;color:#1e293b !important}.boolean-options[data-v-b68a7220]{display:flex;gap:16px}.boolean-option[data-v-b68a7220]{display:flex;align-items:center;gap:6px;cursor:pointer;padding:8px 12px;border-radius:6px;border:1px solid #e2e8f0;background:#f8fafc !important;color:#1e293b !important;transition:all .2s ease}.boolean-option[data-v-b68a7220]:hover{background:#f1f5f9 !important;border-color:#cbd5e1}.boolean-option input[data-v-b68a7220]{margin:0}.boolean-option span[data-v-b68a7220]{font-size:14px;color:#1e293b !important}.null-info[data-v-b68a7220]{display:flex;align-items:center;gap:8px;padding:12px;background:#f8fafc;border-radius:8px;border:1px dashed #cbd5e1}.null-info .null-icon[data-v-b68a7220]{width:16px;height:16px;color:#64748b}.null-info span[data-v-b68a7220]{font-size:14px;color:#64748b}.json-editor-container[data-v-b68a7220]{border:1px solid #e2e8f0;border-radius:8px;overflow:hidden;background:#f8fafc !important}.json-editor-header[data-v-b68a7220]{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:#f1f5f9 !important;border-bottom:1px solid #e2e8f0}.json-editor-header span[data-v-b68a7220]{font-size:12px;font-weight:500;color:#1e293b !important}.btn-small[data-v-b68a7220]{padding:4px 8px;border:1px solid #e2e8f0;border-radius:4px;background:#fff;cursor:pointer;transition:all .2s ease}.btn-small[data-v-b68a7220]:hover{background:#f1f5f9;border-color:#cbd5e1}.btn-small .format-icon[data-v-b68a7220]{width:12px;height:12px;color:#64748b}.json-editor-input[data-v-b68a7220]{width:100%;padding:12px;border:none;outline:none;resize:vertical;font-family:"SF Mono",Monaco,"Cascadia Code",monospace;font-size:13px;line-height:1.5;background:#fff !important;color:#1e293b !important;min-height:120px;background:#fff !important;color:#1e293b !important}.json-editor-input[data-v-b68a7220]:focus{outline:none}.json-editor-input[data-v-b68a7220]::placeholder{color:#94a3b8 !important}.json-error[data-v-b68a7220],.json-success[data-v-b68a7220]{display:flex;align-items:center;gap:6px;padding:8px 12px;font-size:12px;border-top:1px solid #fecaca}.json-error[data-v-b68a7220]{background:#fef2f2;color:#dc2626}.json-error .error-icon[data-v-b68a7220]{width:12px;height:12px;flex-shrink:0}.json-success[data-v-b68a7220]{background:#f0fdf4;color:#16a34a;border-color:#bbf7d0}.json-success .success-icon[data-v-b68a7220]{width:12px;height:12px;flex-shrink:0}.modal-actions[data-v-b68a7220]{padding:16px 24px 24px;border-top:1px solid #e2e8f0;display:flex;justify-content:flex-end;gap:12px}.btn[data-v-b68a7220]{padding:10px 20px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s ease;background:#fff;color:#475569}.btn[data-v-b68a7220]:hover{background:#f8fafc;border-color:#cbd5e1}.btn[data-v-b68a7220]:disabled{opacity:.5;cursor:not-allowed}.btn.primary[data-v-b68a7220]{background:#6366f1;border-color:#6366f1;color:#fff}.btn.primary[data-v-b68a7220]:hover:not(:disabled){background:#4f46e5;border-color:#4f46e5}@media (prefers-color-scheme:dark){.stat-data-editor[data-v-b68a7220],.stat-data-editor[data-v-b68a7220] *{background:#f8fafc !important;color:#1e293b !important}input[data-v-b68a7220],select[data-v-b68a7220],textarea[data-v-b68a7220],option[data-v-b68a7220],.form-input[data-v-b68a7220],.form-select[data-v-b68a7220],.form-textarea[data-v-b68a7220],.boolean-option[data-v-b68a7220]{background:#f8fafc !important;color:#1e293b !important;border-color:#e2e8f0 !important}select option[data-v-b68a7220],.form-select option[data-v-b68a7220]{background:#f8fafc !important;color:#1e293b !important}.modal[data-v-b68a7220]{background:#fff !important;color:#1e293b !important}[data-v-b68a7220] select option{background:#f8fafc !important;color:#1e293b !important}.json-editor[data-v-b68a7220],.json-editor-input[data-v-b68a7220],.raw-editor[data-v-b68a7220],.tree-editor[data-v-b68a7220]{background:#fff !important;color:#1e293b !important}.btn[data-v-b68a7220],.toolbar-btn[data-v-b68a7220],.mode-btn[data-v-b68a7220],.tool-btn[data-v-b68a7220]{background:#fff !important;color:#1e293b !important;border-color:#e2e8f0 !important}.btn.primary[data-v-b68a7220]{background:#6366f1 !important;color:#fff !important;border-color:#6366f1 !important}.mode-btn.active[data-v-b68a7220]{background:#6366f1 !important;color:#fff !important}}[data-v-b68a7220] .json-node-editor input,[data-v-b68a7220] .json-node-editor select,[data-v-b68a7220] .json-node-editor textarea,[data-v-b68a7220] .json-node-editor option{background:#f8fafc !important;color:#1e293b !important;border-color:#e2e8f0 !important}[data-v-b68a7220] .json-node-editor select option{background:#f8fafc !important;color:#1e293b !important}@media (max-width:640px){.editor-toolbar[data-v-b68a7220]{flex-direction:column;gap:12px;align-items:stretch}.toolbar-right[data-v-b68a7220]{justify-content:space-between}.edit-mode-selector[data-v-b68a7220]{flex-direction:column;align-items:stretch}.mode-buttons[data-v-b68a7220],.edit-tools[data-v-b68a7220]{flex-wrap:wrap}.editor-header[data-v-b68a7220]{flex-direction:column;gap:8px;align-items:flex-start}.modal[data-v-b68a7220]{width:95%;margin:10px}.modal-actions[data-v-b68a7220]{flex-direction:column}.btn[data-v-b68a7220]{width:100%}}','']);const i=l},4424:(e,t,a)=>{function o(e,t){for(var a=[],o={},n=0;n<t.length;n++){var r=t[n],l=r[0],i={id:e+':'+n,css:r[1],media:r[2],sourceMap:r[3]};o[l]?o[l].parts.push(i):a.push(o[l]={id:l,parts:[i]})}return a}a.d(t,{A:()=>b});var n='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!n)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \'node\' } in your Webpack config to indicate a server-rendering environment.');var r={},l=n&&(document.head||document.getElementsByTagName('head')[0]),i=null,s=0,d=!1,c=function(){},p=null,u='data-vue-ssr-id',f='undefined'!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function b(e,t,a,n){d=a,p=n||{};var l=o(e,t);return m(l),function(t){for(var a=[],n=0;n<l.length;n++){var i=l[n];(s=r[i.id]).refs--,a.push(s)}t?m(l=o(e,t)):l=[];for(n=0;n<a.length;n++){var s;if(0===(s=a[n]).refs){for(var d=0;d<s.parts.length;d++)s.parts[d]();delete r[s.id]}}}}function m(e){for(var t=0;t<e.length;t++){var a=e[t],o=r[a.id];if(o){o.refs++;for(var n=0;n<o.parts.length;n++)o.parts[n](a.parts[n]);for(;n<a.parts.length;n++)o.parts.push(h(a.parts[n]));o.parts.length>a.parts.length&&(o.parts.length=a.parts.length)}else{var l=[];for(n=0;n<a.parts.length;n++)l.push(h(a.parts[n]));r[a.id]={id:a.id,refs:1,parts:l}}}}function v(){var e=document.createElement('style');return e.type='text/css',l.appendChild(e),e}function h(e){var t,a,o=document.querySelector('style['+u+'~="'+e.id+'"]');if(o){if(d)return c;o.parentNode.removeChild(o)}if(f){var n=s++;o=i||(i=v()),t=y.bind(null,o,n,!1),a=y.bind(null,o,n,!0)}else o=v(),t=k.bind(null,o),a=function(){o.parentNode.removeChild(o)};return t(e),function(o){if(o){if(o.css===e.css&&o.media===e.media&&o.sourceMap===e.sourceMap)return;t(e=o)}else a()}}var g,x=(g=[],function(e,t){return g[e]=t,g.filter(Boolean).join('\n')});function y(e,t,a,o){var n=a?'':o.css;if(e.styleSheet)e.styleSheet.cssText=x(t,n);else{var r=document.createTextNode(n),l=e.childNodes;l[t]&&e.removeChild(l[t]),l.length?e.insertBefore(r,l[t]):e.appendChild(r)}}function k(e,t){var a=t.css,o=t.media,n=t.sourceMap;if(o&&e.setAttribute('media',o),p.ssrId&&e.setAttribute(u,t.id),n&&(a+='\n/*# sourceURL='+n.sources[0]+' */',a+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+' */'),e.styleSheet)e.styleSheet.cssText=a;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(a))}}},4456:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var o=a(9433),n=a.n(o),r=a(5378),l=a.n(r)()(n());l.push([e.id,'.modal-overlay[data-v-88525b64]{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000;padding:20px;backdrop-filter:blur(2px)}.modal-content[data-v-88525b64]{background:#fff;border-radius:12px;width:100%;max-width:400px;max-height:80vh;display:flex;flex-direction:column;box-shadow:0 20px 60px rgba(0,0,0,.3);animation:modal-appear-88525b64 .2s ease-out}.modal-header[data-v-88525b64]{padding:20px 24px 12px;border-bottom:1px solid #f0f0f0;display:flex;justify-content:space-between;align-items:center;flex-shrink:0}.modal-header h3[data-v-88525b64]{margin:0;font-size:16px;font-weight:600;color:#111827}.modal-close[data-v-88525b64]{background:none;border:none;font-size:24px;line-height:1;color:#9ca3af;cursor:pointer;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center;border-radius:4px;transition:all .2s}.modal-close[data-v-88525b64]:hover{background:#f3f4f6;color:#6b7280}.modal-body[data-v-88525b64]{padding:20px 24px;flex:1;overflow-y:auto}.modal-body p[data-v-88525b64]{margin:0;font-size:14px;line-height:1.5;color:#4b5563}.modal-footer[data-v-88525b64]{padding:12px 24px 20px;border-top:1px solid #f0f0f0;display:flex;gap:12px;justify-content:flex-end;flex-shrink:0}.btn[data-v-88525b64]{padding:8px 16px;border:none;border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s;min-width:70px}.btn.primary[data-v-88525b64]{background:#6366f1;color:#fff}.btn.primary[data-v-88525b64]:hover{background:#4f46e5}.btn.primary[data-v-88525b64]:active{background:#4338ca}.btn[data-v-88525b64]{background:#f3f4f6;color:#374151}.btn[data-v-88525b64]:hover{background:#e5e7eb}.btn[data-v-88525b64]:active{background:#d1d5db}@keyframes modal-appear-88525b64{from{opacity:0;transform:translateY(20px) scale(0.95)}to{opacity:1;transform:translateY(0) scale(1)}}.modal-enter-active[data-v-88525b64],.modal-leave-active[data-v-88525b64]{transition:opacity .2s ease}.modal-enter-from[data-v-88525b64],.modal-leave-to[data-v-88525b64]{opacity:0}@media (max-width:480px){.modal-content[data-v-88525b64]{margin:0 16px}.modal-header[data-v-88525b64],.modal-body[data-v-88525b64],.modal-footer[data-v-88525b64]{padding-left:20px;padding-right:20px}}','']);const i=l},4544:(e,t,a)=>{a.d(t,{A:()=>p});var o=a(4061),n=a(6340);const r={class:'file-import-export'},l=['accept'],i={key:0,class:'button-group'},s={key:0,class:'loading-spinner'},d={key:0,class:'loading-spinner'},c=(0,o.defineComponent)({__name:'FileImportExport',props:{accept:{default:'.json'},importText:{default:'导入'},exportText:{default:'导出'},confirmTitle:{default:'导入确认'},confirmContent:{default:'导入新数据将覆盖当前数据，确定要继续吗？'},confirmText:{default:'确认导入'},cancelText:{default:'取消'},showButtons:{type:Boolean,default:!0},requireConfirm:{type:Boolean,default:!0}},emits:['file-selected','file-loaded','export-data','import-confirmed','error','message'],setup(e,{emit:t}){const a=e,c=t,p=(0,o.ref)(null),u=(0,o.ref)(!1),f=(0,o.ref)(!1),b=(0,o.ref)(!1),m=(0,o.ref)(null),v=(0,o.ref)(null);function h(){f.value||p.value&&p.value.click()}function g(e){const t=e.target;if(!t.files||0===t.files.length)return;const o=t.files[0];c('file-selected',o);const n=new FileReader;n.onload=e=>{try{const t=e.target?.result;a.requireConfirm?(v.value={content:t,file:o},u.value=!0):c('import-confirmed',t,o),c('file-loaded',t,o)}catch(e){const t=`文件读取失败: ${e}`;w(t,'error'),c('error',t)}finally{p.value&&(p.value.value='')}},n.onerror=()=>{const e='文件读取错误';w(e,'error'),c('error',e),p.value&&(p.value.value='')},n.readAsText(o)}function x(){if(u.value=!1,v.value){f.value=!0;try{c('import-confirmed',v.value.content,v.value.file),w('导入成功','success')}catch(e){const t=`导入失败: ${e}`;w(t,'error'),c('error',t)}finally{v.value=null,f.value=!1}}}function y(){u.value=!1,v.value=null,p.value&&(p.value.value='')}function k(){if(!b.value){b.value=!0;try{c('export-data'),w('导出成功','success')}catch(e){const t=`导出失败: ${e}`;w(t,'error'),c('error',t)}finally{b.value=!1}}}function w(e,t){m.value={text:e,type:t},c('message',e,t),setTimeout(()=>{m.value=null},3e3)}return(t,a)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',r,[(0,o.createElementVNode)('input',{ref_key:'fileInputRef',ref:p,type:'file',accept:e.accept,style:{display:'none'},onChange:g},null,40,l),e.showButtons?((0,o.openBlock)(),(0,o.createElementBlock)('div',i,[(0,o.createElementVNode)('button',{class:(0,o.normalizeClass)(['btn small',{disabled:f.value}]),onClick:h},[f.value?((0,o.openBlock)(),(0,o.createElementBlock)('span',s)):(0,o.createCommentVNode)('v-if',!0),(0,o.createTextVNode)(' '+(0,o.toDisplayString)(e.importText),1)],2),(0,o.createElementVNode)('button',{class:(0,o.normalizeClass)(['btn small primary',{disabled:b.value}]),onClick:k},[b.value?((0,o.openBlock)(),(0,o.createElementBlock)('span',d)):(0,o.createCommentVNode)('v-if',!0),(0,o.createTextVNode)(' '+(0,o.toDisplayString)(e.exportText),1)],2),(0,o.renderSlot)(t.$slots,'extra-buttons')])):(0,o.createCommentVNode)('v-if',!0),(0,o.createCommentVNode)(' 确认对话框 '),(0,o.createVNode)(n.A,{visible:u.value,'onUpdate:visible':a[0]||(a[0]=e=>u.value=e),title:e.confirmTitle,content:e.confirmContent,type:'confirm','confirm-text':e.confirmText,'cancel-text':e.cancelText,onConfirm:x,onCancel:y},null,8,['visible','title','content','confirm-text','cancel-text']),(0,o.createCommentVNode)(' 消息提示 '),m.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:1,class:(0,o.normalizeClass)(['status-message',m.value.type])},(0,o.toDisplayString)(m.value.text),3)):(0,o.createCommentVNode)('v-if',!0)]))}});a(5929);const p=(0,a(1400).A)(c,[['__scopeId','data-v-7475ba07']])},4604:(e,t,a)=>{var o=a(4456);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('7fe780ce',o,!1,{ssrId:!0})},4941:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var o=a(9433),n=a.n(o),r=a(5378),l=a.n(r)()(n());l.push([e.id,'.json-node[data-v-e6d9f3e8]{position:relative}.line[data-v-e6d9f3e8]{display:flex;align-items:center;gap:6px;padding:4px;border-radius:4px;transition:background-color .2s}.line[data-v-e6d9f3e8]:hover{background-color:#f1f5f9}.line:hover .actions[data-v-e6d9f3e8]{opacity:1}.arrow[data-v-e6d9f3e8]{cursor:pointer;width:16px;text-align:center;font-size:10px;color:#94a3b8;transition:transform .2s}.arrow.expanded[data-v-e6d9f3e8]{transform:rotate(90deg)}.space[data-v-e6d9f3e8]{width:16px}.key[data-v-e6d9f3e8]{color:#1e293b;font-weight:600}.value[data-v-e6d9f3e8]{cursor:pointer}.value.type-string[data-v-e6d9f3e8]{color:#059669}.value.type-number[data-v-e6d9f3e8]{color:#dc2626}.value.type-boolean[data-v-e6d9f3e8]{color:#7c3aed}.value.type-null[data-v-e6d9f3e8]{color:#64748b;font-style:italic}.preview[data-v-e6d9f3e8]{color:#94a3b8;font-style:italic}.editor-container[data-v-e6d9f3e8]{display:flex;gap:6px;align-items:center}.edit-select[data-v-e6d9f3e8],.edit-input[data-v-e6d9f3e8]{padding:2px 6px;font-size:12px;border:1px solid #cbd5e1;border-radius:4px;background-color:#fff !important;color:#1e293b !important;font-family:monospace}.edit-select option[data-v-e6d9f3e8]{background:#fff !important;color:#1e293b !important}.actions[data-v-e6d9f3e8]{margin-left:auto;display:flex;gap:4px;opacity:0;transition:opacity .2s}.btn-action[data-v-e6d9f3e8]{border:none;background:rgba(0,0,0,0);cursor:pointer;color:#64748b;font-size:14px;width:24px;height:24px;border-radius:4px;display:flex;align-items:center;justify-content:center}.btn-action[data-v-e6d9f3e8]:hover{background-color:#e2e8f0;color:#1e293b}.btn-action.danger[data-v-e6d9f3e8]:hover{background-color:#fee2e2;color:#ef4444}.btn-action.save[data-v-e6d9f3e8]{color:#10b981}.btn-action.cancel[data-v-e6d9f3e8]{color:#ef4444}.children-container[data-v-e6d9f3e8]{padding-left:10px;border-left:1px dashed #e2e8f0}','']);const i=l},5023:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var o=a(9433),n=a.n(o),r=a(5378),l=a.n(r)()(n());l.push([e.id,'.search-box[data-v-5fdcabb6]{position:relative;padding:12px 16px;border-bottom:1px solid #e2e8f0}.search-icon[data-v-5fdcabb6]{position:absolute;left:28px;top:50%;transform:translateY(-50%);width:16px;height:16px;color:#94a3b8}.search-input[data-v-5fdcabb6]{width:100%;padding:10px 12px 10px 36px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;transition:all .2s ease;background:#f8fafc !important;color:#1e293b !important}.search-input[data-v-5fdcabb6]:focus{outline:none;border-color:#6366f1;box-shadow:0 0 0 3px rgba(99,102,241,.1)}.search-input[data-v-5fdcabb6]::placeholder{color:#94a3b8 !important}.search-clear[data-v-5fdcabb6]{position:absolute;right:28px;top:50%;transform:translateY(-50%);background:none;border:none;font-size:20px;color:#94a3b8;cursor:pointer;padding:0;width:20px;height:20px;display:flex;align-items:center;justify-content:center}.search-clear[data-v-5fdcabb6]:hover{color:#64748b}@media (prefers-color-scheme:dark){.search-input[data-v-5fdcabb6]{background:#f8fafc !important;color:#1e293b !important;border-color:#e2e8f0 !important}.search-input[data-v-5fdcabb6]::placeholder{color:#94a3b8 !important}}','']);const i=l},5114:(e,t,a)=>{a.d(t,{$:()=>l});var o=a(3035),n=a(9761),r=a(4061);const l=(0,o.defineStore)('KatAsyncAnalyze',()=>{const e=(0,r.ref)(!1),t=(0,r.ref)(!1),a=(0,r.ref)('sample'),o=(0,r.ref)({baseURL:'',apiKey:'',modelName:'',temperature:.7,frequencyPenalty:0,presencePenalty:0,maxTokens:2e4}),l=(0,r.ref)(''),i=async()=>{const t={isAsync:e.value,modelSource:a.value,customModelSettings:o.value,profileSetting:l.value},n=JSON.parse(JSON.stringify(t));await updateVariablesWith(e=>({...e,era_api_config:n}),{type:'script',script_id:getScriptId()})},s=(0,r.ref)([]),d=(0,r.ref)([]),c=(0,r.ref)([]),p=async()=>{const e={analyzeRores:s.value,updateRores:d.value,ignoreRores:c.value},t=JSON.parse(JSON.stringify(e));await updateVariablesWith(e=>({...e,era_world_info_filter_config:t}),{type:'script',script_id:getScriptId()})},u=(0,r.ref)([]),f=async()=>{const e={regexList:u.value},t=JSON.parse(JSON.stringify(e));await updateVariablesWith(e=>({...e,era_regex_config:t}),{type:'script',script_id:getScriptId()})};return{isAsync:e,isUpdateEra:t,modelSource:a,customModelSettings:o,profileSetting:l,getModelSettings:async()=>{const t=getVariables({type:'script',script_id:getScriptId()}).era_api_config;t&&(a.value=t.modelSource,o.value=t.customModelSettings,e.value=t.isAsync,l.value=t.profileSetting),n.j.log('获取异步分析设置: ',t)},saveModelSettings:i,clearModelSettings:async()=>{a.value='sample',o.value={baseURL:'',apiKey:'',modelName:'',temperature:.7,frequencyPenalty:0,presencePenalty:0,maxTokens:2e4},l.value='',await i()},analyzeRores:s,updateRores:d,ignoreRores:c,getWorldInfoFilterConfig:async()=>{const e=getVariables({type:'script',script_id:getScriptId()}).era_world_info_filter_config;e&&(s.value=e.analyzeRores,d.value=e.updateRores,c.value=e.ignoreRores),n.j.log('获取世界书过滤设置: ',e)},saveWorldInfoFilterConfig:p,clearWorldInfoFilterConfig:async()=>{s.value=[],d.value=[],c.value=[],await p()},regexList:u,getRegexConfig:async()=>{const e=getVariables({type:'script',script_id:getScriptId()}).era_regex_config;e&&(u.value=e.regexList),n.j.log('获取正则配置: ',e)},saveRegexConfig:f,clearRegexConfig:async()=>{u.value=[],await f()}}})},5241:(e,t,a)=>{function o(e){return e?e.split('.').map(e=>e.trim()):[]}function n(e,t){let a=e;for(const e of t){if(null==a||'object'!=typeof a)return;a=a[e]}return a}function r(e,t,a){if(!e||'object'!=typeof e||0===t.length)return;let o=e;for(let e=0;e<t.length-1;e++){const a=t[e];a in o&&null!==o[a]&&'object'==typeof o[a]||(o[a]={}),o=o[a]}o[t[t.length-1]]=a}a.d(t,{Em:()=>n,Rr:()=>o,Wp:()=>r})},5270:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var o=a(9433),n=a.n(o),r=a(5378),l=a.n(r)()(n());l.push([e.id,'.dsl-builder-modal[data-v-7bb5e448]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000}.dsl-builder-content[data-v-7bb5e448]{background:#fff;width:90%;max-width:1000px;height:85vh;border-radius:8px;display:flex;flex-direction:column;overflow:hidden}.dsl-header[data-v-7bb5e448]{display:flex;justify-content:space-between;align-items:center;padding:16px;background:#f8fafc;border-bottom:1px solid #e2e8f0}.dsl-builder-body[data-v-7bb5e448]{display:flex;flex:1;min-height:0;overflow:hidden}.dsl-components[data-v-7bb5e448]{flex:0 0 40%;padding:16px;overflow-y:auto;border-right:1px solid #e2e8f0;background:#f9fafb}.component-section[data-v-7bb5e448]{margin-bottom:20px}.component-section h4[data-v-7bb5e448]{margin:0 0 8px 0;font-size:13px;color:#111827;font-weight:600}.path-selection-row[data-v-7bb5e448]{display:flex;gap:8px;align-items:center;margin-bottom:8px}.path-dropdown-container[data-v-7bb5e448]{flex:1}.path-dropdown[data-v-7bb5e448]{width:100%;padding:4px 6px;border:1px solid #e5e7eb;border-radius:4px;font-size:12px;color:#111827;background:#fff !important;-webkit-text-fill-color:#111827 !important}.operator-grid[data-v-7bb5e448]{display:grid;grid-template-columns:repeat(2,1fr);gap:6px;margin-bottom:8px}.operator-grid.three-columns[data-v-7bb5e448]{grid-template-columns:repeat(3,1fr)}.value-input[data-v-7bb5e448]{display:flex;gap:6px;align-items:center}.value-input input[data-v-7bb5e448],.value-input select[data-v-7bb5e448]{flex:1;padding:4px 6px;border:1px solid #e5e7eb;border-radius:4px;font-size:12px;color:#111827;background:#fff !important;-webkit-text-fill-color:#111827 !important}.selected-path[data-v-7bb5e448]{margin-top:8px;padding:6px;background:#e8f4fd;border:1px solid #b3d4fc;border-radius:4px;font-size:11px;color:#0369a1;font-weight:500}.dsl-preview-area[data-v-7bb5e448]{flex:0 0 60%;padding:16px;display:flex;flex-direction:column;gap:16px;overflow-y:auto}.expression-preview[data-v-7bb5e448],.expression-editor[data-v-7bb5e448]{font-size:15px;background:#fff;border:1px solid #e2e8f0;border-radius:6px;padding:12px}.expression-preview.readable[data-v-7bb5e448]{background:#f0fdf4;border-color:#bbf7d0}.preview-header[data-v-7bb5e448]{display:flex;align-items:center;gap:8px;margin-bottom:8px;font-size:13px;color:#374151}.preview-header .hint[data-v-7bb5e448]{font-size:11px;color:#6b7280;font-weight:normal}.expression-display[data-v-7bb5e448]{padding:10px;background:#f8fafc;border-radius:4px;font-family:"Monaco","Menlo","Ubuntu Mono",monospace;font-size:12px;overflow-x:auto;white-space:pre-wrap;word-break:break-all}.readable-text[data-v-7bb5e448]{background:rgba(0,0,0,0);color:#15803d;font-weight:600;font-size:14px;line-height:1.5}.expression-raw[data-v-7bb5e448]{font-size:11px;color:#111827}.expression-raw pre[data-v-7bb5e448]{margin:0;padding:8px;background:#f3f4f6;border-radius:4px;overflow-x:auto;white-space:pre-wrap;word-break:break-all;color:#4b5563;font-weight:500}.expression-editor textarea[data-v-7bb5e448]{width:100%;padding:8px;border:1px solid #e5e7eb;border-radius:4px;font-family:"Monaco","Menlo","Ubuntu Mono",monospace;font-size:12px;resize:vertical;background:#fff !important;color:#111827 !important;-webkit-text-fill-color:#111827 !important}.editor-actions[data-v-7bb5e448]{display:flex;gap:8px;margin-top:8px}.dsl-actions[data-v-7bb5e448]{display:flex;gap:8px;margin-top:16px;justify-content:flex-end}.btn[data-v-7bb5e448]{padding:5px 12px;border:none;border-radius:6px;font-size:12px;cursor:pointer;transition:all .2s;background:#f3f4f6;color:#111827;box-shadow:0 1px 2px 0 rgba(0,0,0,.05);font-weight:500}.btn[data-v-7bb5e448]:hover{background:#e5e7eb;color:#000}.btn.small[data-v-7bb5e448]{padding:3px 8px;font-size:11px}.btn.primary[data-v-7bb5e448]{background:#4f46e5;color:#fff;font-weight:500}.btn.primary[data-v-7bb5e448]:hover{background:#4338ca;color:#fff}.btn.danger[data-v-7bb5e448]{background:#dc2626;color:#fff;font-weight:500}.btn.danger[data-v-7bb5e448]:hover{background:#b91c1c;color:#fff}@media (max-width:768px){.dsl-builder-body[data-v-7bb5e448]{flex-direction:column}.dsl-components[data-v-7bb5e448],.dsl-preview-area[data-v-7bb5e448]{flex:none;width:100%;height:auto;max-height:50%;overflow-y:auto}.dsl-components[data-v-7bb5e448]{border-right:none;border-bottom:1px solid #e2e8f0}.operator-grid[data-v-7bb5e448]{grid-template-columns:repeat(3,1fr)}.path-selection-row[data-v-7bb5e448]{flex-direction:column;align-items:stretch}}.light-theme[data-v-7bb5e448]{background:#fff !important;color:#111827 !important;-webkit-text-fill-color:#111827 !important}','']);const i=l},5378:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var a='',o=void 0!==t[5];return t[4]&&(a+='@supports ('.concat(t[4],') {')),t[2]&&(a+='@media '.concat(t[2],' {')),o&&(a+='@layer'.concat(t[5].length>0?' '.concat(t[5]):'',' {')),a+=e(t),o&&(a+='}'),t[2]&&(a+='}'),t[4]&&(a+='}'),a}).join('')},t.i=function(e,a,o,n,r){'string'==typeof e&&(e=[[null,e,void 0]]);var l={};if(o)for(var i=0;i<this.length;i++){var s=this[i][0];null!=s&&(l[s]=!0)}for(var d=0;d<e.length;d++){var c=[].concat(e[d]);o&&l[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]='@layer'.concat(c[5].length>0?' '.concat(c[5]):'',' {').concat(c[1],'}')),c[5]=r),a&&(c[2]?(c[1]='@media '.concat(c[2],' {').concat(c[1],'}'),c[2]=a):c[2]=a),n&&(c[4]?(c[1]='@supports ('.concat(c[4],') {').concat(c[1],'}'),c[4]=n):c[4]=''.concat(n)),t.push(c))}},t}},5452:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var o=a(9433),n=a.n(o),r=a(5378),l=a.n(r)()(n());l.push([e.id,'.simulation-test[data-v-48676150]{display:flex;flex-direction:column;gap:12px;height:100%}.section-header[data-v-48676150]{display:flex;justify-content:space-between;align-items:center;margin:0 0 12px 0}.test-controls[data-v-48676150]{display:flex;flex-direction:column;gap:12px;margin-bottom:12px}.test-controls .btn[data-v-48676150]{padding:8px 16px;font-size:14px}.btn[data-v-48676150]{padding:5px 12px;border:none;border-radius:6px;font-size:12px;cursor:pointer;transition:background .2s,color .2s,transform .15s;background:#f3f4f6;color:#111827;box-shadow:0 1px 2px 0 rgba(0,0,0,.05);font-weight:500}.btn[data-v-48676150]:hover{background:#e5e7eb;color:#000}.btn.primary[data-v-48676150]{background:#4f46e5;color:#fff;font-weight:500}.btn.primary[data-v-48676150]:hover{background:#4338ca;color:#fff}.btn.small[data-v-48676150]{padding:3px 8px;font-size:11px}','']);const i=l},5614:(e,t,a)=>{var o=a(1754);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('9d58e6b2',o,!1,{ssrId:!0})},5632:e=>{e.exports=toastr},5697:(e,t,a)=>{var o=a(4941);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('a62178b6',o,!1,{ssrId:!0})},5810:(e,t,a)=>{var o=a(5270);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('d10fe81a',o,!1,{ssrId:!0})},5821:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var o=a(9433),n=a.n(o),r=a(5378),l=a.n(r)()(n());l.push([e.id,'.version-container[data-v-95b93420]{padding:8px 16px;font-family:"Inter",sans-serif;color:#334155;line-height:1.6}.section[data-v-95b93420]{margin-bottom:2.5rem}.section-title[data-v-95b93420]{font-size:1.25rem;font-weight:600;color:#334155;margin-bottom:1rem;padding-bottom:.5rem;border-bottom:1px solid #e2e8f0}.author-info[data-v-95b93420]{font-size:.9rem}.author-info a[data-v-95b93420]{color:#4f46e5;text-decoration:none;transition:color .2s ease}.author-info a[data-v-95b93420]:hover{color:rgb(41.1374407583,30.5592417062,217.4407582938);text-decoration:underline}.version-badge[data-v-95b93420]{display:inline-block;background-color:#4f46e5;color:#fff;padding:.3em .8em;border-radius:1em;font-size:1rem;font-weight:700;letter-spacing:.5px}.notes-list[data-v-95b93420],.changes-list[data-v-95b93420]{list-style-type:disc;padding-left:20px;font-size:.9rem;color:#64748b}.notes-list li[data-v-95b93420],.changes-list li[data-v-95b93420]{margin-bottom:.5rem}.history-list[data-v-95b93420]{display:flex;flex-direction:column;gap:1.5rem}.history-item[data-v-95b93420]{background:#f8fafc;border:1px solid #e2e8f0;border-radius:12px;padding:1rem 1.5rem;transition:transform .2s ease,box-shadow .2s ease}.history-item[data-v-95b93420]:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.05)}.history-header[data-v-95b93420]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem}.version-number[data-v-95b93420]{font-size:1.1rem;font-weight:600;color:#4f46e5}.version-date[data-v-95b93420]{font-size:.8rem;color:#64748b;font-style:italic}.changes-list[data-v-95b93420]{color:#475569}','']);const i=l},5894:(e,t,a)=>{var o=a(8322);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('7195b37e',o,!1,{ssrId:!0})},5929:(e,t,a)=>{var o=a(7005);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('246b93da',o,!1,{ssrId:!0})},6104:(e,t,a)=>{var o=a(4308);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('74adbbea',o,!1,{ssrId:!0})},6328:(e,t,a)=>{a.d(t,{a:()=>n});const o=e=>{const t=getChatMessages(e);return t&&0!==t.length?String(t[0].message):''},n={getMessageById:o,getCurrentMessage:()=>o(getCurrentMessageId()),getMessagesByRange:(e,t)=>{const a=getChatMessages(`${e-t>=0?e-t:0}-${e}`);let o='';return a.forEach(e=>{o+=e.message}),o},mergeContentToMessage:async(e,t)=>{console.log('正在合并消息{message_id}到正文: ',t);let a=getChatMessages(e)[0].message;a=a.replace(/$/,t),await setChatMessages([{message_id:e,message:a}])},removeContentByRegex:async(e,t)=>{console.log('正在清除正文中的内容: ',t);let a=getChatMessages(e)[0].message;for(const e of t)a=a.replace(e,'');await setChatMessages([{message_id:e,message:a}])}}},6331:(e,t,a)=>{var o=a(487);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('23895b38',o,!1,{ssrId:!0})},6340:(e,t,a)=>{a.d(t,{A:()=>d});var o=a(4061);const n={class:'modal-content'},r={class:'modal-header'},l={class:'modal-body'},i={class:'modal-footer'},s=(0,o.defineComponent)({__name:'EraConfirmModal',props:{visible:{type:Boolean},title:{default:'提示'},content:{default:''},type:{default:'confirm'},confirmText:{default:'确认'},cancelText:{default:'取消'},showClose:{type:Boolean,default:!0}},emits:['confirm','cancel','update:visible'],setup(e,{emit:t}){const a=e,s=t,d=()=>{s('confirm'),s('update:visible',!1)},c=()=>{s('cancel'),s('update:visible',!1)};return(0,o.watch)(()=>a.visible,e=>{document.body.style.overflow=e?'hidden':''}),(t,a)=>((0,o.openBlock)(),(0,o.createBlock)(o.Transition,{name:'modal'},{default:(0,o.withCtx)(()=>[e.visible?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:0,class:'modal-overlay',onClick:(0,o.withModifiers)(c,['self'])},[(0,o.createElementVNode)('div',n,[(0,o.createElementVNode)('div',r,[(0,o.createElementVNode)('h3',null,(0,o.toDisplayString)(e.title),1),e.showClose?((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:0,class:'modal-close',onClick:c},' × ')):(0,o.createCommentVNode)('v-if',!0)]),(0,o.createElementVNode)('div',l,[(0,o.renderSlot)(t.$slots,'default',{},()=>[(0,o.createElementVNode)('p',null,(0,o.toDisplayString)(e.content),1)])]),(0,o.createElementVNode)('div',i,[(0,o.renderSlot)(t.$slots,'footer',{},()=>['confirm'===e.type?((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:0},[(0,o.createElementVNode)('button',{class:'btn primary',onClick:d},(0,o.toDisplayString)(e.confirmText),1),(0,o.createElementVNode)('button',{class:'btn',onClick:c},(0,o.toDisplayString)(e.cancelText),1)],64)):'alert'===e.type?((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:1,class:'btn primary',onClick:d},(0,o.toDisplayString)(e.confirmText),1)):(0,o.createCommentVNode)('v-if',!0)])])])])):(0,o.createCommentVNode)('v-if',!0)]),_:3}))}});a(4604);const d=(0,a(1400).A)(s,[['__scopeId','data-v-88525b64']])},6584:(e,t,a)=>{a.d(t,{D:()=>l});var o=a(3035),n=a(9761),r=a(4061);const l=(0,o.defineStore)('KatEraData',()=>{const e=(0,r.ref)({}),t=async()=>{const t=e.value,a=JSON.parse(JSON.stringify(t));await updateVariablesWith(e=>({...e,era_data_rule:a}),{type:'script',script_id:getScriptId()})};return{eraDataRule:e,getEraDataRules:async()=>{const t=getVariables({type:'script',script_id:getScriptId()}).era_data_rule;e.value=t||{},n.j.log('获取更新规则设置: ',e.value)},saveEraDataRules:t,clearEraDataRules:async()=>{e.value={},await t()}}})},7005:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var o=a(9433),n=a.n(o),r=a(5378),l=a.n(r)()(n());l.push([e.id,'.file-import-export[data-v-7475ba07]{display:inline-block}.button-group[data-v-7475ba07]{display:flex;gap:8px;align-items:center}.btn[data-v-7475ba07]{padding:5px 12px;border:none;border-radius:6px;font-size:12px;cursor:pointer;transition:all .2s;background:#f3f4f6;color:#111827;box-shadow:0 1px 2px 0 rgba(0,0,0,.05);font-weight:500;display:inline-flex;align-items:center;gap:4px}.btn[data-v-7475ba07]:hover:not(.disabled){background:#e5e7eb;color:#000}.btn.primary[data-v-7475ba07]{background:#4f46e5;color:#fff;font-weight:500}.btn.primary[data-v-7475ba07]:hover:not(.disabled){background:#4338ca;color:#fff}.btn.disabled[data-v-7475ba07]{opacity:.6;cursor:not-allowed}.loading-spinner[data-v-7475ba07]{display:inline-block;width:12px;height:12px;border:2px solid #f3f4f6;border-top:2px solid #6366f1;border-radius:50%;animation:spin-7475ba07 1s linear infinite}@keyframes spin-7475ba07{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.status-message[data-v-7475ba07]{padding:6px 10px;border-radius:4px;font-size:11px;margin-top:8px}.status-message.success[data-v-7475ba07]{background:#d1fae5;color:#065f46;border:1px solid #a7f3d0}.status-message.error[data-v-7475ba07]{background:#fee2e2;color:#991b1b;border:1px solid #fecaca}.status-message.warning[data-v-7475ba07]{background:#fef3c7;color:#92400e;border:1px solid #fde68a}','']);const i=l},7021:(e,t,a)=>{a.d(t,{$:()=>p});var o=a(2393),n=a(9761),r=a(8840);const l=10;class i{logs=[];add(e){this.logs.push(e)}getLogs(){return this.logs}toString(){return 0===this.logs.length?'没有执行任何操作':this.logs.map(e=>{const t=e.success?'✅':'❌',a=e.changes?` (${e.changes.from} -> ${e.changes.to})`:'';return`[${e.ruleName}] ${t} [${e.action}] ${e.path}: ${e.message}${a}`}).join('\n')}clear(){this.logs=[]}}const s=e=>{const t=[];for(let a=1;a<=e.size;a++)t.push(e.get(a)||'');return t};function d(e,t){if(e===t||Number.isNaN(e)&&Number.isNaN(t))return{};if('object'!=typeof t||null===t)return'object'==typeof e&&null!==e?(n.j.warn('[diffObjects] 已忽略结构变化: 原始值不是对象，但当前值是对象。'),{}):e;if('object'!=typeof e||null===e)return n.j.warn('[diffObjects] 已忽略结构变化: 原始值是对象，但当前值不是对象。'),{};if(Array.isArray(t))return Array.isArray(e)&&JSON.stringify(e)===JSON.stringify(t)?{}:e;const a={};for(const o in t){if(!Object.prototype.hasOwnProperty.call(e,o)){n.j.warn(`[diffObjects] 已忽略结构变化: 键 '${o}' 在当前对象中已被移除。`);continue}const r=e[o],l=t[o];if('number'==typeof r&&Number.isNaN(r)){n.j.warn(`[diffObjects] 已忽略键 '${o}' 的 NaN 值。`);continue}if(r===l||Number.isNaN(r)&&Number.isNaN(l))continue;const i=e=>null===e?'null':typeof e;if(i(r)===i(l))if('object'!=typeof r||null===r||Array.isArray(r))a[o]=r;else{const e=d(r,l);e&&Object.keys(e).length>0&&(a[o]=e)}else n.j.warn(`[diffObjects] 已忽略键 '${o}' 的类型不匹配。原始值: ${i(l)}, 当前值: ${i(r)}。`)}return a}const c=(e,t)=>t.length?e.replace(/\$\[(.*?)\]/g,(e,a)=>{const o=a.split('.');let n=0;return`$[${o.map(e=>'*'===e&&n<t.length?t[n++]:e).join('.')}]`}):e,p={async applyRule(e,t,a){try{const o=new i,r=((e,t)=>{const a=JSON.parse(JSON.stringify(t)),o=(e,t)=>{for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&Object.prototype.hasOwnProperty.call(e,a)&&typeof e[a]==typeof t[a]&&('object'!=typeof t[a]||null===t[a]||Array.isArray(t[a])?Array.isArray(e[a])===Array.isArray(t[a])&&(e[a]=t[a]):o(e[a],t[a]))};return o(a,e),a})(e,t),l=Object.entries(a).sort(([,e],[,t])=>(e.order??0)-(t.order??0)),s=new Map;n.j.log('[EraDataHandler] 获取到原始数据',e),n.j.log('[EraDataHandler] 获取到快照',t),n.j.log('[EraDataHandler] 处理原始数据为全量',r),n.j.log('[EraDataHandler] 正在处理规则',l);for(const[e,a]of l)if(a.enable)try{await this._processRule(r,t,e,a,o,s)}catch(t){n.j.error(`[EraDataHandler] 运行规则'${e}'时出现错误 :`,t),o.add({ruleName:e,path:a.path,action:'error',success:!1,message:t.message||'未知错误'})}n.j.log('[EraDataHandler] 已完成数据的更新',r),n.j.log('[EraDataHandler] 处理过程日志',o.getLogs());const c=d(r,t);return n.j.log('[EraDataHandler] 合并数据变化',c),{data:c,log:o.toString(),rawLogs:o.getLogs()}}finally{o.w.clearCache()}},async _processRule(e,t,a,n,i,d){const p=new Map,u=Math.max(1,Math.min(n.loop??1,1e4)),f=new r.G(e);let b=[];if('*'===n.path)b=n.if?f.getContexts(n.if):[new Map];else{const e=`$[${n.path}]`;b=f.getContexts(e)}if(0!==b.length)for(const r of b){const f=s(r);let b='';if('*'!==n.path){const e=`$[${n.path}]`,t=c(e,f);b=t.slice(2,-1)}const m=n.if?c(n.if,f):null,v=[];if(n.handle){const e=Object.entries(n.handle).sort(([,e],[,t])=>(e.order??0)-(t.order??0));for(const[t,a]of e)v.push({key:t,cfg:a,concreteIf:a.if?c(a.if,f):null,concreteOp:c(a.op,f)})}for(let r=0;r<u;r++){const s=u<=20||r<l||r>=u-l;u>20&&r===l&&i.add({ruleName:a,path:b||'Global',action:'skip',success:!0,message:`正在跳过循环 11 到 ${u-l} 的日志...`});let c=!0;if(m){const t=o.w.execute(m,e,d,p);t.success?c=Array.isArray(t.value)?t.value.every(e=>!0===e.value):!!t.value:(c=!1,s&&i.add({ruleName:a,path:b||'Global',action:'error',success:!1,message:`规则 'if' 条件执行失败: ${t.error}`}))}if(!c&&('*'===n.path||r>0))break;if(c&&v.length>0)for(const t of v){const n=Math.max(1,Math.min(t.cfg.loop??1,1e4));for(let r=0;r<n;r++){const s=n<=20||r<l||r>=n-l;if(n>20&&r===l&&i.add({ruleName:a,path:b||'Global',action:'skip',success:!0,message:`Loop ${r+1}/${n} [${t.key}] 正在跳过循环 11 到 ${n-l} 的日志...`}),t.concreteIf){const l=o.w.execute(t.concreteIf,e,d,p);if(!l.success){s&&i.add({ruleName:a,path:b||'Global',action:'error',success:!1,message:`Loop ${r+1}/${n} 处理 [${t.key}] 'if' 条件执行失败: ${l.error}`});break}if(!(Array.isArray(l.value)?l.value.every(e=>!0===e.value):!!l.value))break}const c=o.w.execute(t.concreteOp,e,d,p);c.success&&Array.isArray(c.value)?c.value.forEach(l=>{if('data'===l.targetType&&l.path){const d=o.w.getValue(e,l.path);o.w.setValue(e,l.path,l.value),s&&i.add({ruleName:a,path:l.path,action:'handle',success:!0,message:`Loop ${r+1}/${n} [${t.key}] (Ctx: ${f.join('.')})`,changes:{from:d,to:l.value}})}else s&&('temp'===l.targetType&&l.path?i.add({ruleName:a,path:l.path,action:'handle',success:!0,message:`Loop ${r+1}/${n} [${t.key}] 赋值给临时变量, 值为: ${JSON.stringify(l.value)}`}):i.add({ruleName:a,path:b||'Global',action:'handle',success:!0,message:`Loop ${r+1}/${n} [${t.key}] 计算值: ${JSON.stringify(l.value)} (无赋值操作)`}))}):c.success||s&&i.add({ruleName:a,path:b||'Global',action:'handle',success:!1,message:`Loop ${r+1}/${n} [${t.key}] 错误: ${c.error}`})}}if(b&&(c||0===r)&&this._applyLimitAndRange(e,t,n,b,i,a,s),!c)break}}},_applyLimitAndRange(e,t,a,n,r,l,i){const s=o.w.getValue(e,n),d=o.w.getValue(t,n);if(a.limit&&2===a.limit.length&&'number'==typeof s&&'number'==typeof d){const[t,c]=a.limit,p=s-d;let u=p;if(p>c&&(u=c),p<t&&(u=t),u!==p){const a=d+u;o.w.setValue(e,n,a),i&&r.add({ruleName:l,path:n,action:'limit',success:!0,message:`增量 ${p} 已限制在 [${t}, ${c}] 范围内`,changes:{from:s,to:a}})}}if(a.range&&2===a.range.length){const t=o.w.getValue(e,n);if('number'==typeof t){const[s,d]=a.range,c=Math.max(s,Math.min(t,d));c!==t&&(o.w.setValue(e,n,c),i&&r.add({ruleName:l,path:n,action:'range',success:!0,message:`值已限制在 [${s}, ${d}] 范围内`,changes:{from:t,to:c}}))}}}}},7389:(e,t,a)=>{var o=a(1857);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('cfb5719a',o,!1,{ssrId:!0})},7507:(e,t,a)=>{var o=a(8119);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('7d9a065a',o,!1,{ssrId:!0})},7577:(e,t,a)=>{var o=a(5821);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('d5854890',o,!1,{ssrId:!0})},7664:(e,t,a)=>{a.d(t,{l:()=>c});var o=a(3035),n=(a(6328),a(8521));const r=async e=>{await eventEmit(n.e.DELETE_BY_OBJECT,e)},l=async e=>{await eventEmit(n.e.UPDATE_BY_OBJECT,e)},i=async e=>{await eventEmit(n.e.INSERT_BY_OBJECT,e)},s=async e=>{await eventEmit(n.e.FORCE_SYNC,{mode:e})};var d=a(9761);const c=(0,o.defineStore)('KatEraEdit',()=>{const e=async()=>{const{stat_data:e}=getVariables({type:'chat'});return d.j.log('获取stat_data内容: ',e),e||{}},t=(e,t,a,o)=>{let n=e;for(const e of t)n[e]||(n[e]={}),n=n[e];n[a]=o};return{getStatData:e,saveEraEdit:async a=>{if(!a||'object'!=typeof a)return;const o=await e(),d={},c={},p={},u=(e,a,o=[])=>{const n=new Set(e&&'object'==typeof e&&!Array.isArray(e)?Object.keys(e):[]),r=new Set(a&&'object'==typeof a&&!Array.isArray(a)?Object.keys(a):[]);n.forEach(a=>{if(!r.has(a)){const n=e[a],r=n&&'object'==typeof n&&!Array.isArray(n)&&Object.keys(n).length>0;t(d,o,a,r?{}:null)}}),r.forEach(e=>{n.has(e)||t(p,o,e,a[e])}),r.forEach(r=>{if(n.has(r)){const n=e[r],l=a[r];n&&l&&'object'==typeof n&&'object'==typeof l&&!Array.isArray(n)&&!Array.isArray(l)?u(n,l,[...o,r]):JSON.stringify(n)!==JSON.stringify(l)&&t(c,o,r,l)}})};u(o,a,[]),Object.keys(d).length>0&&await r(d),Object.keys(c).length>0&&await l(c),Object.keys(p).length>0&&await i(p),await s(n.e.SYNC_MODE.LATEST)}}})},7671:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var o=a(9433),n=a.n(o),r=a(5378),l=a.n(r)()(n());l.push([e.id,'.path-collection-box[data-v-57295b1b]{border:1px solid #e5e7eb;border-radius:6px;margin:8px 0;background:#fff}.path-collection-header[data-v-57295b1b]{padding:8px 12px;background:#f9fafb;border-bottom:1px solid #e5e7eb;display:flex;justify-content:space-between;align-items:center;cursor:pointer;font-weight:500;font-size:12px}.path-collection-content[data-v-57295b1b]{max-height:200px;overflow-y:auto}.path-item[data-v-57295b1b]{display:flex;justify-content:space-between;align-items:center;padding:6px 12px;border-bottom:1px solid #f1f5f9;font-size:11px}.path-text[data-v-57295b1b]{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-right:8px}.remove-path-btn[data-v-57295b1b]{min-width:auto;padding:2px 6px}.path-collection-actions[data-v-57295b1b]{padding:8px 12px;display:flex;justify-content:flex-end}.btn[data-v-57295b1b]{padding:5px 12px;border:none;border-radius:6px;font-size:12px;cursor:pointer;transition:background .2s,color .2s,transform .15s;background:#f3f4f6;color:#111827;box-shadow:0 1px 2px 0 rgba(0,0,0,.05);font-weight:500}.btn[data-v-57295b1b]:hover{background:#e5e7eb;color:#000}.btn.small[data-v-57295b1b]{padding:3px 8px;font-size:11px}.btn.danger[data-v-57295b1b]{background:#dc2626;color:#fff;font-weight:500}.btn.danger[data-v-57295b1b]:hover{background:#b91c1c;color:#fff}','']);const i=l},7691:(e,t,a)=>{var o=a(5023);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('d7d34d4c',o,!1,{ssrId:!0})},8119:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var o=a(9433),n=a.n(o),r=a(5378),l=a.n(r)()(n());l.push([e.id,'.dsl-tester-modal[data-v-db47b546]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(15,23,42,.65);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:1000}.dsl-tester-content[data-v-db47b546]{background:#fff;width:90%;max-width:1000px;height:85vh;border-radius:12px;display:flex;flex-direction:column;box-shadow:0 25px 50px -12px rgba(0,0,0,.25);overflow:hidden;border:1px solid hsla(0,0%,100%,.1)}.tester-header[data-v-db47b546]{height:60px;display:flex;justify-content:space-between;align-items:center;padding:0 20px;background:#fff;border-bottom:1px solid #e2e8f0;flex-shrink:0}.tester-header .header-left[data-v-db47b546]{display:flex;align-items:center;gap:12px}.tester-header .header-left h3[data-v-db47b546]{margin:0;font-size:16px;font-weight:700;color:#1e293b;letter-spacing:-0.02em}.tester-header .header-left .data-badge[data-v-db47b546]{background:#ecfdf5;color:#059669;font-size:11px;font-weight:600;padding:2px 8px;border-radius:99px;border:1px solid #a7f3d0}.tester-header .header-actions[data-v-db47b546]{display:flex;align-items:center;gap:10px}.tester-header .header-actions .divider[data-v-db47b546]{width:1px;height:24px;background:#e2e8f0;margin:0 4px}.tester-body[data-v-db47b546]{flex:1;display:flex;min-height:0;background:#f8fafc}.panel-left[data-v-db47b546]{flex:0 0 320px;display:flex;flex-direction:column;border-right:1px solid #e2e8f0;background:#fcfcfc}.panel-right[data-v-db47b546]{flex:1;display:flex;flex-direction:column;background:#1e1e1e;min-width:0}.panel-header[data-v-db47b546]{height:40px;padding:0 16px;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.05em;color:#64748b;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center;background:#fff;flex-shrink:0}.panel-header .count-badge[data-v-db47b546]{background:#f1f5f9;color:#64748b;padding:1px 6px;border-radius:4px;font-size:10px}.panel-header .clear-btn[data-v-db47b546]{background:none;border:none;color:#666;font-size:11px;cursor:pointer}.panel-header .clear-btn[data-v-db47b546]:hover{color:#fff}.panel-right .panel-header[data-v-db47b546]{background:#252526;border-bottom:1px solid #333;color:#858585}.rules-container[data-v-db47b546]{flex:1;overflow-y:auto;padding:12px}.rule-card[data-v-db47b546]{background:#fff;border:1px solid #e2e8f0;border-radius:6px;padding:10px;margin-bottom:8px;transition:all .2s;cursor:default}.rule-card[data-v-db47b546]:hover{border-color:#cbd5e1;box-shadow:0 2px 4px rgba(0,0,0,.02)}.rule-card .rule-header[data-v-db47b546]{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}.rule-card .rule-header .rule-name[data-v-db47b546]{font-weight:600;font-size:13px;color:#1e293b;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:200px}.rule-card .rule-header .status-dot[data-v-db47b546]{width:6px;height:6px;border-radius:50%;background:#cbd5e1;flex-shrink:0}.rule-card .rule-header .status-dot.active[data-v-db47b546]{background:#10b981;box-shadow:0 0 0 2px rgba(16,185,129,.15)}.rule-card .rule-detail .path-code[data-v-db47b546]{display:block;font-family:"Menlo",monospace;font-size:10px;background:#f1f5f9;padding:3px 6px;border-radius:3px;color:#64748b;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.output-container[data-v-db47b546]{flex:1;overflow-y:auto;padding:0;position:relative}.output-container[data-v-db47b546]::-webkit-scrollbar{width:10px;height:10px}.output-container[data-v-db47b546]::-webkit-scrollbar-track{background:#1e1e1e}.output-container[data-v-db47b546]::-webkit-scrollbar-thumb{background:#424242;border-radius:5px;border:2px solid #1e1e1e}.output-container[data-v-db47b546]::-webkit-scrollbar-thumb:hover{background:#4f4f4f}.console-output[data-v-db47b546]{margin:0;padding:16px;font-family:"JetBrains Mono","Consolas",monospace;font-size:13px;line-height:1.6;color:#d4d4d4;white-space:pre-wrap;word-wrap:break-word}.empty-state[data-v-db47b546],.empty-result[data-v-db47b546]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:#64748b;font-size:13px;gap:8px;-webkit-user-select:none;user-select:none}.empty-result[data-v-db47b546]{color:#52525b}.empty-result .icon-placeholder[data-v-db47b546]{font-size:24px;opacity:.5}.btn[data-v-db47b546]{height:32px;padding:0 14px;border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s;border:1px solid rgba(0,0,0,0);display:inline-flex;align-items:center;gap:6px;white-space:nowrap}.btn.primary[data-v-db47b546]{background:#6366f1;color:#fff}.btn.primary[data-v-db47b546]:hover{background:#5558e0}.btn.primary[data-v-db47b546]:disabled{background:#94a3b8;cursor:not-allowed;opacity:.7}.close-btn[data-v-db47b546]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0);border:none;color:#64748b;cursor:pointer;border-radius:6px;transition:all .2s}.close-btn[data-v-db47b546]:hover{background:#f1f5f9;color:#ef4444}[data-v-db47b546] .file-import-export{display:inline-block}[data-v-db47b546] .file-import-export button{height:32px;padding:0 14px;border-radius:6px;font-size:13px;background:#fff;border:1px solid #e2e8f0;color:#1e293b;cursor:pointer;transition:all .2s}[data-v-db47b546] .file-import-export button:hover{background:#f8fafc;border-color:#cbd5e1}@media (max-width:768px){.tester-body[data-v-db47b546]{flex-direction:column}.panel-left[data-v-db47b546]{flex:0 0 40%;border-right:none;border-bottom:1px solid #e2e8f0}.panel-right[data-v-db47b546]{flex:1}.tester-header[data-v-db47b546]{padding:0 12px}.header-left h3[data-v-db47b546]{font-size:14px}.btn[data-v-db47b546]{padding:0 10px;font-size:12px}}','']);const i=l},8322:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var o=a(9433),n=a.n(o),r=a(5378),l=a.n(r)()(n());l.push([e.id,'[data-v-51c0384a]{box-sizing:border-box}.title[data-v-51c0384a]{margin:8px 0 16px;font-size:18px;font-weight:600;color:#111827;padding-top:4px}.switch-row[data-v-51c0384a]{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;cursor:pointer;-webkit-user-select:none;user-select:none}.switch-row input[type=checkbox][data-v-51c0384a]{display:none}.switch[data-v-51c0384a]{position:relative;width:40px;height:22px;background:#d1d5db;border-radius:11px;transition:background .3s}.switch[data-v-51c0384a]::after{content:"";position:absolute;top:2px;left:2px;width:18px;height:18px;background:#fff;border-radius:50%;transition:left .3s}.switch-row input:checked+.switch[data-v-51c0384a]{background:#6366f1}.switch-row input:checked+.switch[data-v-51c0384a]::after{left:20px}.tip-card[data-v-51c0384a]{display:block;background:#fffbeb;border:1px solid #fde68a;color:#b45309;padding:8px 12px;border-radius:8px;font-size:13px;margin-bottom:16px}.row[data-v-51c0384a]{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px}.row span[data-v-51c0384a]:first-child{width:130px;font-size:14px;color:#4b5563;flex-shrink:0}.row input[data-v-51c0384a],.row select[data-v-51c0384a]{flex:1;padding:6px 10px;border:1px solid #e5e7eb;border-radius:8px;font-size:14px;color:#111827;background:#dcd8d8;box-shadow:inset 0 1px 2px rgba(0,0,0,.03);transition:border-color .2s,box-shadow .2s}.row input[data-v-51c0384a]:focus,.row select[data-v-51c0384a]:focus{outline:none;border-color:#6366f1;box-shadow:0 0 0 3px rgba(99,102,241,.15),inset 0 1px 2px rgba(0,0,0,.03)}.row select[data-v-51c0384a],.row select option[data-v-51c0384a]{background:#dcd8d8 !important;color:#111827 !important}@media (prefers-color-scheme:dark){.row select[data-v-51c0384a],.row select option[data-v-51c0384a]{background:#dcd8d8 !important;color:#111827 !important}.content[data-v-51c0384a]{background:#dcd8d8;color:#111827}}.btn[data-v-51c0384a]{padding:6px 16px;border:none;border-radius:8px;font-size:14px;cursor:pointer;transition:background .2s,color .2s,transform .15s;background:#f3f4f6;color:#111827;box-shadow:0 1px 2px 0 rgba(0,0,0,.05)}.btn[data-v-51c0384a]:hover{background:#e5e7eb}.btn.small[data-v-51c0384a]{padding:4px 12px;font-size:13px}.btn.primary[data-v-51c0384a]{background:#6366f1;color:#fff}.btn.primary[data-v-51c0384a]:hover{background:#4f46e5}.btn.danger[data-v-51c0384a]{background:#ef4444;color:#fff}.btn.danger[data-v-51c0384a]:hover{background:#dc2626}.footer[data-v-51c0384a]{display:flex;justify-content:flex-end;gap:8px;margin-top:16px}.list-item[data-v-51c0384a]{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;background:#f9fafb;border-radius:6px;margin-bottom:8px;border:1px solid #e5e7eb}.list-item[data-v-51c0384a]:last-child{margin-bottom:0}.tag[data-v-51c0384a]{display:inline-block;padding:2px 8px;background:#e0e7ff;color:#3730a3;border-radius:4px;font-size:12px;margin-right:6px;margin-bottom:4px}.message[data-v-51c0384a]{padding:8px 12px;border-radius:6px;margin-bottom:12px;font-size:13px}.message.success[data-v-51c0384a]{background:#d1fae5;color:#065f46;border:1px solid #a7f3d0}.message.error[data-v-51c0384a]{background:#fee2e2;color:#991b1b;border:1px solid #fecaca}.message.warning[data-v-51c0384a]{background:#fef3c7;color:#92400e;border:1px solid #fde68a}.message.info[data-v-51c0384a]{background:#e0f2fe;color:#1e40af;border:1px solid #bae6fd}.form-group[data-v-51c0384a]{margin-bottom:16px}.form-group label[data-v-51c0384a]{display:block;margin-bottom:6px;font-size:14px;color:#374151;font-weight:500}.divider[data-v-51c0384a]{height:1px;background:#e5e7eb;margin:16px 0;border:none}.card-container[data-v-51c0384a]{background:#dcd8d8;border:1px solid #e5e7eb;border-radius:8px;padding:16px;margin-bottom:16px;box-shadow:0 1px 3px 0 rgba(0,0,0,.1)}.loading[data-v-51c0384a]{display:inline-block;width:20px;height:20px;border:2px solid #f3f4f6;border-top:2px solid #6366f1;border-radius:50%;animation:spin-51c0384a 1s linear infinite}@keyframes spin-51c0384a{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.tooltip[data-v-51c0384a]{position:relative;display:inline-block;cursor:help;margin-left:4px}.tooltip[data-v-51c0384a]::after{content:attr(data-tooltip);position:absolute;bottom:100%;left:50%;transform:translateX(-50%);background:#111827;color:#fff;padding:6px 10px;border-radius:4px;font-size:12px;white-space:nowrap;opacity:0;visibility:hidden;transition:opacity .2s}.tooltip[data-v-51c0384a]:hover::after{opacity:1;visibility:visible}.page-tabs[data-v-51c0384a]{display:flex;margin-bottom:20px;border-bottom:1px solid #e5e7eb}.tab-button[data-v-51c0384a]{padding:10px 20px;border:none;background:rgba(0,0,0,0);cursor:pointer;font-size:14px;color:#6b7280;border-bottom:2px solid rgba(0,0,0,0)}.tab-button.active[data-v-51c0384a]{color:#6366f1;border-bottom:2px solid #6366f1}.tab-button[data-v-51c0384a]:hover:not(.active){color:#111827}','']);const i=l},8521:(e,t,a)=>{a.d(t,{e:()=>o});const o={INSERT_BY_OBJECT:'era:insertByObject',UPDATE_BY_OBJECT:'era:updateByObject',DELETE_BY_OBJECT:'era:deleteByObject',GET_SNAPSHOT_AT_MK:'era:getSnapshotAtMk',FORCE_SYNC:'era:forceSync',SYNC_MODE:{AUTO:'auto',FULL:'full',LATEST:'latest',ROLLBACK_TO:'rollbackTo'}}},8726:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var o=a(9433),n=a.n(o),r=a(5378),l=a.n(r)()(n());l.push([e.id,'.json-node[data-v-2a743db4]{font-family:"SF Mono",Monaco,"Cascadia Code","JetBrains Mono",monospace;font-size:11px;line-height:1.5;position:relative}.json-node[data-v-2a743db4]::before{content:"";position:absolute;left:12px;top:0;bottom:0;width:1px;background:linear-gradient(to bottom,transparent 0%,#e5e7eb 10%,#e5e7eb 90%,transparent 100%);z-index:0}.json-node .line[data-v-2a743db4]{display:flex;align-items:center;min-height:28px;padding:4px 0;position:relative;z-index:1;transition:background-color .15s ease}.json-node .line[data-v-2a743db4]:hover{background-color:rgba(99,102,241,.05);border-radius:4px}.json-node .line:hover .arrow[data-v-2a743db4]{opacity:1}.json-node .line.line-leaf .key[data-v-2a743db4]{color:#111827}.json-node .line.line-parent .key[data-v-2a743db4]{font-weight:600;color:#111827}.json-node .arrow[data-v-2a743db4]{display:flex;align-items:center;justify-content:center;width:16px;height:16px;margin-right:4px;cursor:pointer;opacity:.6;transition:all .2s ease;border-radius:3px;flex-shrink:0}.json-node .arrow[data-v-2a743db4]:hover{opacity:1;background-color:rgba(99,102,241,.1);transform:scale(1.1)}.json-node .arrow .arrow-icon[data-v-2a743db4]{width:15px;height:15px;color:#6b7280;transition:transform .2s ease}.json-node .arrow.expanded .arrow-icon[data-v-2a743db4]{color:#6366f1}.json-node .space[data-v-2a743db4]{width:16px;height:16px;flex-shrink:0}.json-node .key[data-v-2a743db4]{color:#4b5563;margin-right:8px;font-weight:500;-webkit-user-select:none;user-select:none;flex-shrink:0}.json-node .value-area[data-v-2a743db4]{display:flex;align-items:center;gap:8px;flex:1;min-width:0}.json-node .val[data-v-2a743db4]{color:#111827;font-weight:400;padding:2px 6px;background-color:#f9fafb;border-radius:4px;border:1px solid #f3f4f6;line-height:1.3;flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;max-width:400px;white-space:normal;word-break:break-all;word-wrap:break-word}.json-node .val.type-string[data-v-2a743db4]{color:#059669;background-color:#f0fdf4;border-color:#bbf7d0}.json-node .val.type-number[data-v-2a743db4]{color:#dc2626;background-color:#fef2f2;border-color:#fecaca}.json-node .val.type-boolean[data-v-2a743db4]{color:#7c3aed;background-color:#f5f3ff;border-color:#ddd6fe}.json-node .val.type-null[data-v-2a743db4]{color:#6b7280;background-color:#f9fafb;border-color:#e5e7eb;font-style:italic}.json-node .val.type-object[data-v-2a743db4]{color:#0ea5e9;background-color:#f0f9ff;border-color:#bae6fd}.json-node .val.type-array[data-v-2a743db4]{color:#f59e0b;background-color:#fffbeb;border-color:#fde68a}.json-node .val[data-v-2a743db4]:empty{display:none}.json-node .add-btn[data-v-2a743db4]{display:flex;align-items:center;justify-content:center;width:15px;height:15px;padding:0;border:none;border-radius:6px;color:#fffbfb;cursor:pointer;opacity:0;transition:all .2s ease;flex-shrink:0;background-color:#b6ffbb;box-shadow:0 1px 2px rgba(99,102,241,.2)}.json-node .add-btn[data-v-2a743db4]:not(:hover){opacity:.8}.json-node .add-btn[data-v-2a743db4]:hover{background:#75b8f1;border-color:#75b8f1}.json-node .add-btn[data-v-2a743db4]:active{transform:translateY(0)}.json-node .add-btn .add-icon[data-v-2a743db4]{width:14px;height:14px;stroke-width:2}.json-node .collapse-preview[data-v-2a743db4]{color:#6b7280;font-size:11px;font-style:italic;padding:2px 6px;background-color:#f9fafb;border-radius:4px;border:1px dashed #e5e7eb;line-height:1.3;flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;max-width:400px;white-space:normal;word-break:break-all;word-wrap:break-word}.json-node .collapse-preview .ellipsis[data-v-2a743db4]{display:inline-block;max-width:100%;overflow:hidden;text-overflow:ellipsis}.json-node[data-v-2a743db4]:last-child::before{bottom:50%}.json-node[data-v-2a743db4]:first-child::before{top:50%}@media (prefers-color-scheme:dark){.json-node[data-v-2a743db4]::before{background:linear-gradient(to bottom,transparent 0%,#374151 10%,#374151 90%,transparent 100%)}.json-node .line[data-v-2a743db4]:hover{background-color:rgba(99,102,241,.1)}.json-node .key[data-v-2a743db4]{color:#9ca3af}.json-node .val[data-v-2a743db4]{color:#f3f4f6;background-color:#1f2937;border-color:#374151}.json-node .val.type-string[data-v-2a743db4]{color:#34d399;background-color:#064e3b;border-color:#047857}.json-node .val.type-number[data-v-2a743db4]{color:#f87171;background-color:#7f1d1d;border-color:#991b1b}.json-node .val.type-boolean[data-v-2a743db4]{color:#a78bfa;background-color:#4c1d95;border-color:#5b21b6}.json-node .val.type-null[data-v-2a743db4]{color:#9ca3af;background-color:#374151;border-color:#4b5563}.json-node .val.type-object[data-v-2a743db4]{color:#38bdf8;background-color:#0c4a6e;border-color:#0369a1}.json-node .val.type-array[data-v-2a743db4]{color:#fbbf24;background-color:#78350f;border-color:#d97706}.json-node .collapse-preview[data-v-2a743db4]{color:#9ca3af;background-color:#1f2937;border-color:#374151}.json-node .arrow .arrow-icon[data-v-2a743db4]{color:#9ca3af}.json-node .arrow[data-v-2a743db4]:hover{background-color:rgba(99,102,241,.2)}}','']);const i=l},8840:(e,t,a)=>{a.d(t,{G:()=>n});var o=a(5241);class n{data;pathInfos=[];foundContexts=[];maxWildcardOrdinal=0;constructor(e){this.data=e}getContexts(e){return this.parseExpressionStructure(e),0===this.maxWildcardOrdinal?[new Map]:(this.resolveWildcards(1,new Map),this.foundContexts)}expand(e){return this.getContexts(e).map(t=>{let a=e;return this.pathInfos.forEach(e=>{a=a.replace(e.originalPath,this.reconstructPath(e,t))}),a})}parseExpressionStructure(e){this.pathInfos=[],this.foundContexts=[],this.maxWildcardOrdinal=0;e.match(/\$\[([^\]]+)\]/g)?.forEach(e=>{const t=e.slice(2,-1).split('.'),a=new Map;let o=0;t.forEach((e,t)=>{'*'===e&&(o++,a.set(t,o))}),this.pathInfos.push({originalPath:e,segments:t,wildcardOrdinalMap:a}),o>this.maxWildcardOrdinal&&(this.maxWildcardOrdinal=o)})}resolveWildcards(e,t){if(e>this.maxWildcardOrdinal)return void this.foundContexts.push(new Map(t));const a=this.pathInfos.filter(t=>t.wildcardOrdinalMap.size>=e);if(0===a.length)return void this.resolveWildcards(e+1,t);const n=a[0],r=this.getPathPrefixSegments(n,e,t),l=(0,o.Em)(this.data,r);if('object'!=typeof l||null===l)return;const i=Object.keys(l).filter(n=>a.every(a=>{const r=this.getPathPrefixSegments(a,e,t),l=(0,o.Em)(this.data,r);if(!l||'object'!=typeof l||!Object.prototype.hasOwnProperty.call(l,n))return!1;let i=-1;for(const[t,o]of a.wildcardOrdinalMap)if(o===e){i=t;break}let s=a.segments.length;for(const[t,o]of a.wildcardOrdinalMap)o>e&&t<s&&(s=t);const d=[...r,n];for(let e=i+1;e<s;e++)d.push(a.segments[e]);return void 0!==(0,o.Em)(this.data,d)}));for(const a of i){const o=new Map(t);o.set(e,a),this.resolveWildcards(e+1,o)}}getPathPrefixSegments(e,t,a){let o=-1;for(const[a,n]of e.wildcardOrdinalMap.entries())if(n===t){o=a;break}if(-1===o)return[];const n=[];for(let t=0;t<o;t++){const o=e.segments[t];if('*'===o){const o=e.wildcardOrdinalMap.get(t);n.push(a.get(o))}else n.push(o)}return n}reconstructPath(e,t){return`$[${e.segments.map((a,o)=>{if('*'===a){const a=e.wildcardOrdinalMap.get(o);return t.get(a)}return a}).join('.')}]`}}},9318:(e,t,a)=>{a.d(t,{default:()=>h}),a.r(t);var o=a(4061);const n={class:'version-container'},r={class:'section'},l={class:'author-info'},i=['href'],s={class:'section'},d={class:'version-badge'},c={class:'section'},p={class:'history-list'},u={class:'history-header'},f={class:'version-number'},b={class:'version-date'},m={class:'changes-list'},v=(0,o.defineComponent)({__name:'VersionInformation',setup(e){const t=(0,o.ref)('v1.0.0'),a=(0,o.ref)({name:'cat987',github:'https://github.com/Malkuku/EraHelper-all-in-one-solution-for-ERA-scripts'}),v=(0,o.ref)([{version:'v1.0.0',date:'2025-12-13',changes:['发布首个版本。']}]);return(e,h)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',n,[(0,o.createElementVNode)('div',r,[h[3]||(h[3]=(0,o.createElementVNode)('h2',{class:'section-title'},'作者信息',-1)),(0,o.createElementVNode)('p',l,[h[0]||(h[0]=(0,o.createTextVNode)(' 开发者: ',-1)),(0,o.createElementVNode)('strong',null,(0,o.toDisplayString)(a.value.name),1),h[1]||(h[1]=(0,o.createElementVNode)('br',null,null,-1)),h[2]||(h[2]=(0,o.createTextVNode)(' Github: ',-1)),(0,o.createElementVNode)('a',{href:a.value.github,target:'_blank',rel:'noopener noreferrer'},(0,o.toDisplayString)(a.value.github),9,i)])]),(0,o.createElementVNode)('div',s,[h[4]||(h[4]=(0,o.createElementVNode)('h2',{class:'section-title'},'当前版本',-1)),(0,o.createElementVNode)('p',null,[(0,o.createElementVNode)('span',d,(0,o.toDisplayString)(t.value),1)])]),h[6]||(h[6]=(0,o.createStaticVNode)('<div class="section" data-v-95b93420><h2 class="section-title" data-v-95b93420>免责声明</h2><ul class="notes-list" data-v-95b93420><li data-v-95b93420>本插件仅供个人学习与技术交流使用，严禁用于任何商业目的或非法活动。使用者需自行承担因使用本插件而产生的一切风险与法律责任，开发者对此不承担任何责任。</li></ul><h2 class="section-title" data-v-95b93420>注意事项</h2><ul class="notes-list" data-v-95b93420><li data-v-95b93420>目前版本仍处于早期测试阶段,可能会存在较多bug,请注意保存好自己的数据</li><li data-v-95b93420>在使用[文件导入导出]功能时,请确认好文件的来源,以避免受到恶意攻击</li><li data-v-95b93420>当前移动端的适配还尚不完善,请尽量使用PC端进行开发</li></ul></div>',1)),(0,o.createElementVNode)('div',c,[h[5]||(h[5]=(0,o.createElementVNode)('h2',{class:'section-title'},'更新日志',-1)),(0,o.createElementVNode)('div',p,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(v.value,e=>((0,o.openBlock)(),(0,o.createElementBlock)('article',{key:e.version,class:'history-item'},[(0,o.createElementVNode)('header',u,[(0,o.createElementVNode)('h3',f,(0,o.toDisplayString)(e.version),1),(0,o.createElementVNode)('time',b,(0,o.toDisplayString)(e.date),1)]),(0,o.createElementVNode)('ul',m,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(e.changes,(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('li',{key:t},(0,o.toDisplayString)(e),1))),128))])]))),128))])])]))}});a(7577);const h=(0,a(1400).A)(v,[['__scopeId','data-v-95b93420']])},9433:e=>{e.exports=function(e){return e[1]}},9761:(e,t,a)=>{a.d(t,{j:()=>o});const o=new class{prefix;constructor(e='[app] '){this.prefix=e}log(...e){console.log(`%c🗒️ ${this.prefix}`,'color: green; font-weight: bold;',...e)}debug(...e){console.debug(`%c⚙️ ${this.prefix}`,'color: orange; font-weight: bold;',...e)}info(...e){console.info(`%cℹ️ ${this.prefix}`,'color: blue; font-weight: bold;',...e)}warn(...e){console.warn(`%c⚠️ ${this.prefix}`,'color: orange; font-weight: bold;',...e)}error(...e){console.error(`%c❌ ${this.prefix}`,'color: red; font-weight: bold;',...e)}}('[EraHelperLog]: ')},9867:(e,t,a)=>{var o=a(7671);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,a(4424).A)('ef8e1878',o,!1,{ssrId:!0})}},a={};function o(e){var n=a[e];if(void 0!==n)return n.exports;var r=a[e]={id:e,exports:{}};return t[e](r,r.exports,o),r.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};var n=o(3035),r=o(4061);var l=o(1400);const i={},s=(0,l.A)(i,[['render',function(e,t){const a=(0,r.resolveComponent)('RouterView');return(0,r.openBlock)(),(0,r.createBlock)(a)}]]);var d=o(688);function c(){const e=getScriptId();$(`head > div[script_id="${e}"]`).remove();const t=$('<div>').attr('script_id',e).append($(document).find('head > style').clone());$('head').append(t)}var p=o(4167);const u=async(e,t,a,o,n,r)=>{let l;console.log('Before RegisterMacro'),SillyTavern.registerMacro('lastUserMessage',()=>e),console.log('After RegisterMacro');try{r&&(console.log('切换预设',r),l=(await window.SillyTavern.executeSlashCommands('/profile')).pipe,await window.SillyTavern.executeSlashCommands(`/profile ${r}`),window.EjsTemplate.refreshWorldInfo());return await generate({user_input:e,injects:t,max_chat_history:a,should_stream:o,...n&&{custom_api:{apiurl:n.baseURL,key:n.apiKey,model:n.modelName,temperature:Number(n.temperature),frequency_penalty:Number(n.frequencyPenalty),presence_penalty:Number(n.presencePenalty),max_tokens:Number(n.maxTokens)}}})}finally{r&&await window.SillyTavern.executeSlashCommands(`/profile ${l}`)}};var f=o(6328);var b=o(8521),m=o(9761),v=o(7021);const h=()=>window.AsyncAnalyzeStore,g=(0,r.computed)(()=>!!h()?.isAsync),x=(0,r.computed)(()=>!!h()?.isUpdateEra),y=(0,r.computed)(()=>g.value?g.value&&!x.value?[...h()?.updateRores||[],...h()?.analyzeRores||[]]:h()?.ignoreRores:h()?.analyzeRores),k=(0,r.computed)(()=>h()?.regexList),w=(0,r.ref)(!1),E=(0,r.computed)(()=>h()?.modelSource),N=(0,r.computed)(()=>h()?.customModelSettings),V=(0,r.computed)(()=>h()?.profileSetting),C=async e=>{if(0!=getLastMessageId()&&0!=e&&g.value)if(x.value)toastr.warning('已有正在处理的分步分析');else{if(f.a.getMessageById(e).length<200)throw toastr.error('空回了喵~请重roll喵~'),new Error('空回了喵~请重roll喵~');toastr.info('开始分步分析，等待era事件完成'),m.j.info('开始分步分析，等待era事件完成'),h().isUpdateEra=!0,window.EjsTemplate.refreshWorldInfo(),await j()}},S=async e=>{if(g.value)return void m.j.info('处于分步分析模式,跳过接收消息时的处理');const t=getChatMessages(e)[0].message,a=await B(t);await setChatMessages([{message_id:e,message:a}])};async function B(e){const t=e.match(/<VariableEdit>((?:(?!<VariableEdit>)[\s\S])*?)<\/VariableEdit>(?![\s\S]*<VariableEdit>[\s\S]*<\/VariableEdit>)/);if(t&&t[1])try{const a=JSON.parse(t[1]),o=await window.EraEditStore.getStatData();if(null==o)return toastr.error('快照数据为空,跳过处理'),e;const n=window.EraDataStore.eraDataRule,{data:r}=await v.$.applyRule(a,o,n),l=JSON.stringify(r);e=e.replace(/<VariableEdit>[\s\S]*?<\/VariableEdit>/,`<VariableEdit>\n${l}\n</VariableEdit>`)}catch(e){m.j.error('变量更新失败：',e),toastr.error('变量更新失败')}return e}const j=async()=>{if(!x.value)return toastr.warning('[isUpdateEra]标识异常'),void m.j.error('[isUpdateEra]标识异常');var e;await(e=1e3,Promise.race([new Promise(t=>setTimeout(t,e))]));try{toastr.info('正在构建提示词并请求AI分析'),m.j.info('正在构建提示词并请求AI分析');const e='本次不生成故事，处理Era变量',t=2,a=!1,o=[{id:'1145141919',position:'in_chat',depth:0,should_scan:!1,role:'user',content:e}];m.j.log('模型来源: ',E.value);const n='sample'==E.value?await u(e,o,t,a,null,null):'profile'==E.value?await u(e,o,t,a,null,V.value):await u(e,o,t,a,N.value,null);m.j.log('接收到的分析结果原文: ',n),await async function(e){if(e.length<200)throw toastr.error('接收的分析结果为空，哈！'),new Error('接收的分析结果为空，哈！');const t=[];k.value.forEach(a=>{const o=new RegExp(a,'gi');e.match(o)&&t.push(o)}),await f.a.removeContentByRegex(getLastMessageId(),t),e=await B(e);let a='';t.map(t=>{a+=e.match(t)?.join('')??''}),await f.a.mergeContentToMessage(getLastMessageId(),a)}(n),toastr.success('分步分析处理完成')}catch(e){toastr.error('分步分析处理失败'),m.j.error('分步分析处理失败: ',e)}finally{await eventEmit(b.e.FORCE_SYNC),h().isUpdateEra=!1}},A=async e=>{m.j.log('WORLDINFO_ENTRIES_LOADED: ',e),await p.X.removeLoresByArray(e,y.value,w.value)};var D=o(5114);const O=VueRouter,T={key:0,class:'mask'},M={class:'card'},L={class:'top-button-group'},I={class:'router-view-container'},R={class:'content'},U=(0,r.defineComponent)({__name:'Layout',setup(e){const t=(0,d.n)(),a=(0,r.computed)(()=>t.showUI),o=(0,O.useRouter)(),n=(0,O.useRoute)(),l=(0,r.ref)(n.path);(0,r.watch)(()=>n.path,e=>{l.value=e});const i=()=>{t.showUI=!1},s=e=>{o.push(e)};return(e,t)=>{const o=(0,r.resolveComponent)('router-view');return a.value?((0,r.openBlock)(),(0,r.createElementBlock)('div',T,[(0,r.createElementVNode)('div',M,[(0,r.createCommentVNode)(' 顶部按钮组 '),(0,r.createElementVNode)('div',L,[(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['btn',{active:'/AsyncAnalyze'===l.value}]),onClick:t[0]||(t[0]=e=>s('/AsyncAnalyze'))},[...t[4]||(t[4]=[(0,r.createElementVNode)('span',{class:'btn-text'},'📊分步分析配置',-1)])],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['btn',{active:'/EraDataHandle'===l.value}]),onClick:t[1]||(t[1]=e=>s('/EraDataHandle'))},[...t[5]||(t[5]=[(0,r.createElementVNode)('span',{class:'btn-text'},'⚙️Era规则配置',-1)])],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['btn',{active:'/EraDataEdit'===l.value}]),onClick:t[2]||(t[2]=e=>s('/EraDataEdit'))},[...t[6]||(t[6]=[(0,r.createElementVNode)('span',{class:'btn-text'},'📝Era变量编辑',-1)])],2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['btn',{active:'/Version'===l.value}]),onClick:t[3]||(t[3]=e=>s('/Version'))},[...t[7]||(t[7]=[(0,r.createElementVNode)('span',{class:'btn-text'},'🍎版本信息',-1)])],2),(0,r.createCommentVNode)('        <button'),(0,r.createCommentVNode)('          v-if="true"'),(0,r.createCommentVNode)('          class="btn"'),(0,r.createCommentVNode)('          :class="{ active: currentRoute === \'/tempTest\' }"'),(0,r.createCommentVNode)('          @click="goToRoute(\'/tempTest\')"'),(0,r.createCommentVNode)('        >'),(0,r.createCommentVNode)('          <span class="btn-text">临时测试</span>'),(0,r.createCommentVNode)('        </button>')]),(0,r.createCommentVNode)(' 关闭按钮 '),(0,r.createElementVNode)('button',{class:'close-x',title:'关闭',onClick:i},'×'),(0,r.createCommentVNode)(' 新增：专门的 router-view 容器区域 '),(0,r.createElementVNode)('div',I,[(0,r.createCommentVNode)(' 内容区 '),(0,r.createElementVNode)('div',R,[(0,r.createVNode)(o)])])])])):(0,r.createCommentVNode)('v-if',!0)}}});o(6331);const J=(0,l.A)(U,[['__scopeId','data-v-7fa11198']]),P=(0,O.createRouter)({history:(0,O.createMemoryHistory)(),routes:[{path:'/',component:J,redirect:'/AsyncAnalyze',children:[{path:'/AsyncAnalyze',name:'AsyncAnalyze',component:()=>Promise.resolve().then(o.bind(o,2344))},{path:'/EraDataHandle',name:'EraDataHandle',component:()=>Promise.resolve().then(o.bind(o,1684))},{path:'/EraDataEdit',name:'EraDataEdit',component:()=>Promise.resolve().then(o.bind(o,4203))},{path:'/tempTest',name:'tempTest',component:()=>Promise.resolve().then(o.bind(o,4208))},{path:'/Version',name:'Version',component:()=>Promise.resolve().then(o.bind(o,9318))}]}]});var F=o(6584),H=o(7664);let W=null,K=null;function G(){m.j.log('unloadUI','UI 脚本开始卸载'),W&&(m.j.debug('unmountVueApp','卸载 Vue 实例'),W.unmount(),W=null),$(`head > div[script_id="${getScriptId()}"]`).remove(),K&&(m.j.debug('unloadUI','销毁挂载点'),$(`div#era-ui-mount-point-${getScriptId()}`).remove(),K=null),window.removeEventListener('pagehide',G),m.j.log('unloadUI','UI 脚本卸载完成'),eventClearAll()}$(()=>{m.j.log('initialize','UI 脚本开始初始化'),K=$('<div>').attr('id',`era-ui-mount-point-${getScriptId()}`).css({position:'fixed',bottom:'20px',left:'20px','z-index':1e4}),m.j.debug('$(document).ready','创建挂载点',K),$('body').append(K),m.j.debug('$(document).ready','挂载点已添加到 body'),W=(0,r.createApp)(s);const e=(0,n.createPinia)();W.use(e),W.use(P),W.mount(K[0]),m.j.debug('initialize','正在初始化 store 实例'),window.UiStore=(0,d.n)(e),window.AsyncAnalyzeStore=(0,D.$)(e),(0,D.$)().getModelSettings(),(0,D.$)().getWorldInfoFilterConfig(),(0,D.$)().getRegexConfig(),window.EraDataStore=(0,F.D)(e),(0,F.D)().getEraDataRules(),window.EraEditStore=(0,H.l)(e),c(),m.j.debug('initialize','Vue App 已挂载，样式已传送'),P.afterEach(()=>{setTimeout(()=>{c()},50)}),window.removeEventListener('pagehide',G),window.addEventListener('pagehide',G),eventOn(tavern_events.WORLDINFO_ENTRIES_LOADED,A),eventOn(tavern_events.MESSAGE_RECEIVED,C),eventOn(tavern_events.MESSAGE_RECEIVED,S)}),$(()=>{replaceScriptButtons([{name:'🐱ERA助手',visible:!0},{name:'🍬重新分析变量',visible:!0}]),eventOn(getButtonEvent('🐱ERA助手'),()=>{(0,d.n)().showUI=!(0,d.n)().showUI}),eventOn(getButtonEvent('🍬重新分析变量'),async()=>{await(async()=>{if(0==getLastMessageId())return void toastr.warning('请不要重算0层变量','你在干嘛😡');toastr.info('开始变量重算，等待era事件完成');const e=h().isAsync;try{toastr.info('正在将era回滚到上次更新'),await eventEmit('era:forceSync',{mode:'rollbackTo',message_id:getLastMessageId()-1}),h().isUpdateEra=!0,g.value||(toastr.info('临时开启分步分析模式'),h().isAsync=!0),await j()}catch(e){toastr.error('分步分析处理失败'),m.j.error('分步分析处理失败: ',e),await eventEmit('era:forceSync')}finally{h().isAsync=e,h().isUpdateEra=!1}})()})});